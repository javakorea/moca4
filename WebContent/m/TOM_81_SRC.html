<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" /> 
<meta http-equiv="Pragma" content="no-cache" /> 
<meta http-equiv="Expires" content="Mon, 06 Jan 1990 00:00:01 GMT">
<meta http-equiv="Expires" content="-1" />
<meta name="viewport"
	content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>출금이체요청_온라인소유권이전</title>
<script>
	moca.TOM_81_SRC.___ready = function(args){
		if(moca.getSs("loginInfo") == null || window.history.length < 3){
			location.href = '/to';
		};
		moca.setHistory('TOM_81',{'title':'결제계좌선택','time':(new Date()).getTime()});
		
		
		moca.TOM_81_SRC.session = {};
    	moca.TOM_81_SRC.exe({
    		url : moca._domain+moca._contextRoot+"/TOM_81/mobile/AccountList.do",
    		loadingbar:true,
    		loadingInfo:{type:"mobile",className:"_modal",content:"<span>잠시만 기다려주세요!</span>"},
            data : {
            	"header" : moca.header,
            	"body" : {
            	}
            },			
    		callback : function(response){
    			$('#dl_account')[0].list = response.accountList;
    			var fullStr = '';
    			for(var i=0;i < response.accountList.length; i++){
    				var account = response.accountList[i];
    				var row = '<dt onclick="go(this)" class="" index="'+i+'"><label>'+account.Bank_Name+'</label><span class="icon"></span></dt><dd onclick="go(this)"  index="'+i+'">'+account.Bank_Account+'</dd>';
    				fullStr += row;
    				$('#dl_account').html(fullStr);
    			};
    		}
    	});
	};
	function go(e){
		var index = $(event.srcElement).attr("index");
		
		
		var userPayInfo = {};
		var obj = $('#dl_account')[0].list[index];
		
		userPayInfo.trace_no  = obj.TraceNo;
		userPayInfo.phoneno = JSON.parse(sessionStorage.getItem("loginInfo")).mobilePhone;
		userPayInfo.birthday = obj.BirthDate;
		userPayInfo.custnm = obj.Bank_Owner;
		userPayInfo.bankOwner = obj.Bank_Owner;
		userPayInfo.BankNm = obj.Bank_Name;
		userPayInfo.BankCd = obj.Bank_Cd;
		userPayInfo.acct_no = obj.Bank_Account;
		
		
		
		
		
		
		
		var idx = e.getAttribute("index");
		var selectedRow = $('#dl_account')[0].list[idx];
		moca.TOM_81_SRC.session.selectedAccount = selectedRow;
		
		moca.setAs("userPayInfo",userPayInfo);
		moca.setAs("TOM_81",moca.TOM_81_SRC.session);
	  	location.href = 'TOM_82.html';
	}
	function goreg(){
	  	location.href = 'TOM_64.html';
	}
	
	moca.TOM_81_SRC.toCancel = function(){
		moca.mconfirm('소유권이전을 취소하시겠습니까?','',function(_result){
			if(_result == 'Y'){
				moca.TOM_81_SRC.exe({
					url : moca._domain+moca._contextRoot+"/TOM_60/mobile/cancelTransferOwner.do",
		            data : {
		            	"header" : moca.header,
		            	"body" : {
		            		Stage:"26",
		            		idx:moca.getSs("transferownerId")+""
		            	}
		            },		
					callback : function(response){
						
						if(response.error){
							moca.merror(response.error,'',function(){
								location.href='TOM_25.html?isCancel=true';
							});
						}else if(response.rePayResYn == 'N'){
			        	    moca.mresult('성공적으로 취소되었습니다!','',function(){
			        		   location.href='TOM_25.html?isCancel=true';
			        	   });	
						}else{
							//polling후
			        	    moca.mresult('성공적으로 취소되었습니다!','',function(){
			        	    	location.href='TOM_25.html?isCancel=true';
			        	    });	
						}

					}
				});
				
			}
		});
	};
	
	moca.TOM_81_SRC.back = function(){
		location.href = 'TOM_61.html';
	};
</script>
</head>
<body>
	<div class="wrap">
		<header class="titlebar">
			<button class="btn_back" type="button" onclick="moca.TOM_81_SRC.back()">이전페이지</button>
			<h2 class="tit"><a href="javascript:void(0)" onclick="moca.TOM_81_SRC.toCancel()">이전 취소</a></h2>
		</header>

		<div class="content fx2 btn_none">
			<div class="top_txt">
				<p><span>결제하실 계좌</span>를<br>선택하세요.</p>
			</div>
			<section class="rbox type1">
				<dl id='dl_account'>
				</dl>	
			</section>
			<button class="btn_cm" type="button" onclick="goreg();">+ 새로운 계좌 등록</button>
		</div>
	</div>
</body>
</html>