<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" /> 
<meta http-equiv="Pragma" content="no-cache" /> 
<meta http-equiv="Expires" content="Mon, 06 Jan 1990 00:00:01 GMT">
<meta http-equiv="Expires" content="-1" />
<script>
	var pass_num = '';
	
	moca.TOM_12_SRC.___ready = function(args){
		setTimeout(function(){
			$('#ipt_pass1').focus();
			if(window.BRIDGE != null){
				BRIDGE.showKeyPad();
			}
		},100);		
	};

	moca.TOM_12_SRC.logKey  = function(_obj) { 
		pass_num = _obj.value;
	  	for(var i=0; i < $('.pw_dot').length; i++){
	  		var ch = pass_num.charAt(i);
	  		var jq_o = $($('.pw_dot')[i]);
	  		if(ch != ''){
	  			if(!jq_o.hasClass('active')){
		  			jq_o.addClass('active');
	  			}
	  		}else{
	  			jq_o.removeClass('active');
	  		}
	  	}
	  	if(pass_num.length > 5){
	  		var pass_num1 = sessionStorage.getItem('pass_num1');
	  		sessionStorage.removeItem('pass_num1');
	  		var socialInfo = sessionStorage.getItem('loginTemp0');
	  		var signInfo = sessionStorage.getItem('loginTemp2');

	  		var socialSignObj = JSON.parse(socialInfo);
	  		var boninSignObj = JSON.parse(signInfo);
	  		if(pass_num == pass_num1 && boninSignObj != null){
	  			//회원가입시킴
				try{
					var mobileCarrierMajor_str = boninSignObj.mobileCarrierMajor;
					var mobileCarrierMajor = "0";
					if(mobileCarrierMajor_str == "SKT"){
						mobileCarrierMajor = "1";
					}else if(mobileCarrierMajor_str == "KT"){
						mobileCarrierMajor = "2";
					}else if(mobileCarrierMajor_str == "LG"){
						mobileCarrierMajor = "3";
					}else{
						mobileCarrierMajor = "0";
					}
					
					
					var sex_str = boninSignObj.sex;
					var sex = "1";
					if(sex_str == "M"){
						sex = "1";
					}else if(sex_str == "F"){
						sex = "2";
					}	
	    	    	moca.TOM_12_SRC.exe({
	    	    		url : moca._domain+moca._contextRoot+"/TOM_02/saveUserInfo.do",
	    	            data : {
	    	            	"header" : moca.header,
	    	            	"body" : {
	    	            		
	    	            		"id":socialSignObj.id+"",
	    	            		"loginType":sessionStorage.getItem('loginType')+"",
	    	            		"inqType":sessionStorage.getItem('inqType')+"",
	    	            		"Password":pass_num,
	    	            		"Email":socialSignObj.email,
	    	            		"Name":boninSignObj.name,
	    	            		"Sex":sex,
	    	            		"BirthDate":boninSignObj.birthDate,
	    	            		"Mobile_Phone":boninSignObj.mobilePhone,
	    	            		"Mobile_Carrier_Major":mobileCarrierMajor,
	    	            		"FCMToken":(sessionStorage.getItem('FCMToken') == null)? null:sessionStorage.getItem('FCMToken')+"",
	    	            		"DeviceID":(sessionStorage.getItem('DeviceID') == null)? null:sessionStorage.getItem('DeviceID')+"",
	    	            		"OsType":boninSignObj.osType,
	    	            		"SecretKey":pass_num
	    	            	}
	    	            },			
	    	    		callback : function(response){
			    	    	moca.TOM_12_SRC.exe({
			    	    		url : moca._domain+moca._contextRoot+"/TOM_02/userInfo.do",
			    	    		loadingbar:true,
			    	            data : {
			    	            	"header" : moca.header,
			    	            	"body" : {"id":JSON.parse(sessionStorage.getItem('loginTemp0')).id+"",
			    	            		"loginType":sessionStorage.getItem('loginType'),
			    	            		"Email":JSON.parse(sessionStorage.getItem('loginTemp0')).email,
			    	            		"Name":JSON.parse(sessionStorage.getItem('loginTemp2')).name
			    	            		}
			    	            },			
			    	    		callback : function(response){
			    	    			if(response.userInfo != null){
			    	    				//모바일 로그인용 id, type 정보 
			    	    				try{
				    	    				if(typeof(BRIDGE) != "undefined" ){
				    	    					BRIDGE.saveLoginInfo(JSON.parse(sessionStorage.getItem('loginTemp0')).id+"",sessionStorage.getItem('loginType')+"")
				    	    				}
				    	    				//곧바로 진행스텝으로
				    	    				sessionStorage.setItem('loginInfo', JSON.stringify(response.userInfo));
				    	    				location.href = 'TOM_15.html';
			    	    				}catch(e){
			    	    					alert(e);
			    	    				}
			    	    			}else{
			    	    				moca.merror("사용자정보가져오기오류",JSON.parse(sessionStorage.getItem('loginTemp0')).id+"/"+sessionStorage.getItem('loginType')+"/"+JSON.parse(sessionStorage.getItem('loginTemp0')).email+"/"+JSON.parse(sessionStorage.getItem('loginTemp2')).name);
			    	    			}
			    	    		}
			    	    	});
	    	    		}
	    	    	});
					
				}catch(e){
					
					alert('-------------error:'+e);
				}
	  		}else if(pass_num == pass_num1){
    	    	moca.TOM_12_SRC.exe({
    	    		url : moca._domain+moca._contextRoot+"/TOM_02/updatePassword.do",
    	    		loadingbar:true,
    	            data : {
    	            	"header" : moca.header,
    	            	"body" : {
    	            		"id":socialSignObj.id+"",
    	            		"loginType":sessionStorage.getItem('loginType')+"",
    	            		"SecretKey":pass_num,
    	            		"Password":pass_num,
    	            		"BirthDate": moca.getSs("BirthDate"),
    	            		"SecretKeyTemp":""
    	            	}
    	            },			
    	    		callback : function(response){
		    	    	moca.TOM_12_SRC.exe({
		    	    		url : moca._domain+moca._contextRoot+"/TOM_02/userInfo.do",
		    	    		loadingbar:true,
		    	            data : {
		    	            	"header" : moca.header,
		    	            	"body" : {"id":JSON.parse(sessionStorage.getItem('loginTemp0')).id+"",
		    	            		"loginType":sessionStorage.getItem('loginType')
		    	            		}
		    	            },			
		    	    		callback : function(response){
		    	    			if(response.userInfo != null){
		    	    				//모바일 로그인용 id, type 정보 
		    	    				try{
			    	    				if(typeof(BRIDGE) != "undefined" ){
			    	    					BRIDGE.saveLoginInfo(JSON.parse(sessionStorage.getItem('loginTemp0')).id+"",sessionStorage.getItem('loginType')+"")
			    	    				}
			    	    				//곧바로 진행스텝으로
			    	    				sessionStorage.setItem('loginInfo', JSON.stringify(response.userInfo));
			    	    				location.href = 'TOM_15.html';
		    	    				}catch(e){
		    	    					alert(e);
		    	    				}
		    	    			}else{
		    	    				moca.merror("사용자정보가져오기오류",JSON.parse(sessionStorage.getItem('loginTemp0')).id+"/"+sessionStorage.getItem('loginType')+"/"+JSON.parse(sessionStorage.getItem('loginTemp0')).email+"/"+JSON.parse(sessionStorage.getItem('loginTemp2')).name);
		    	    			}
		    	    		}
		    	    	});
    	    		}
    	    	});
	  		}else{
	  			location.href = 'TOM_13.html';
	  		}
	  	}
	};
	

	function focusMove(){
		$('#ipt_pass1').focus();
	};
</script>
</head>
<body>
	<!-- 제대로 입력되어 완료되었을때 TOM_15.html로 이동 -->

	<div class="wrap">
		<header class="titlebar">
			<!-- <button class="btn_back" type="button" onclick="window.history.back()">이전페이지</button> -->
		</header>
		<div class="inner">
			<div class="top_txt">
				<p>
					다시 한번<br>입력해주세요.
				</p>
			</div>
		</div>

		<div class="content fx2">
			<div class="inner">
				<div class="lo_form">
					<div class="pw_box">
						<div class="pw_dot">
							<input type="tel" pattern="\d*" placeholder="number" name="ipt_pass1" id="ipt_pass1" maxlength="6" onkeyup="moca.TOM_12_SRC.logKey(this)">
						</div>
						<div class="pw_dot">
							<input type="number" name="ipt_pass" id="ipt_pass" maxlength="1" onfocus="focusMove()">
						</div>
						<div class="pw_dot">
							<input type="number" name="ipt_pass" id="ipt_pass" maxlength="1" onfocus="focusMove()">
						</div>
						<div class="pw_dot">
							<input type="number" name="ipt_pass" id="ipt_pass" maxlength="1" onfocus="focusMove()">
						</div>
						<div class="pw_dot">
							<input type="number" name="ipt_pass" id="ipt_pass" maxlength="1" onfocus="focusMove()">
						</div>
						<div class="pw_dot">
							<input type="number" name="ipt_pass" id="ipt_pass" maxlength="1" onfocus="focusMove()">
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</body>
</html>