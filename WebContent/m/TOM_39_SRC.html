<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" /> 
<meta http-equiv="Pragma" content="no-cache" /> 
<meta http-equiv="Expires" content="Mon, 06 Jan 1990 00:00:01 GMT">
<meta http-equiv="Expires" content="-1" />
<meta name="viewport"
	content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>모바일 웹 온라인 소유권 이전</title>
<link rel="stylesheet" type="text/css" href="../css/mobile.css?after">
<script>
	var _carInfoDetail = '';
	var _seizeList = '';
	var _structCngList = '';
	var _mortgageList = '';
	var _useCngList = '';
	moca.TOM_39_SRC.___ready = function(args){
		
		$("._modal").hide();	
		
		var _idx = sessionStorage.getItem('coocon_data');
		$('#Mortgage').hide();
		$('#Seize').hide();
		$('#StructCng').hide();
		$('#NoticePhoneNum').hide();
		var response = moca.getSs("TOM_39_response");
		if(response.carDetailInfo == null){
			moca.malert('조회실패:데이터가 없습니다33.','',function(){
				location.href = 'TOM_25.html';
			});
			return;
		} 
		/*
		"Request_VehicleNumber":"", _carInfoDetail.RegNumber
		"RegistrationIndex":"",
		"carType":"", 	_carInfoDetail.CarType
		"carName":"", 	_carInfoDetail.Name
		"ChassisNumber":"",	_carInfoDetail.ChassisNumber
		*/
		moca.setSs("carDetailInfo",response.carDetailInfo.carInfoDetail);
		moca.setLs("carDetailInfo",response.carDetailInfo.carInfoDetail);
		//location.href = 'TOM_39.html';
		_carInfoDetail = response.carDetailInfo.carInfoDetail;
		_seizeList = response.carDetailInfo.seizeList;			//압류/촉탁내역
		_structCngList = response.carDetailInfo.structCngList;	//구조변경내역
		_mortgageList = response.carDetailInfo.mortgageList;		//근저당설정내역
		_useCngList = response.carDetailInfo.useCngList;		//용도변경내역
		
		$('#VehicleElapsedYear_Original').text(_carInfoDetail.VehicleElapsedYear_Original+"년 "); //차량경과년
		$('#VehicleElapsedMonth').text(_carInfoDetail.VehicleElapsedMonth+"개월"); 				//차량경과월
		$('#VehicleElapsedDay').text(_carInfoDetail.VehicleElapsedDay+"일"); 						//차량경과일
		$('#CarName').text(_carInfoDetail.Name+"");					//차명
		
		$('#UsedCarRemainingPrice').text(moca.comma(_carInfoDetail.UsedCarRemainingPrice)+" 원");//차량평균가
		$('#UpRate').text(moca.comma(_carInfoDetail.UpRate)+" 원");//차량시세상한가
		$('#MdlRate').text(moca.comma(_carInfoDetail.MdlRate)+" 원");//차량시세하한가
		
		$('#ModelYear').text(_carInfoDetail.ModelYear+"");			//모델연도
		$('#LastOwner').text(_carInfoDetail.LastOwner+"");			//소유자명
		$('#RegNumber').text(_carInfoDetail.RegNumber+"");			//자동차등록번호
		$('#TYPE').text(_carInfoDetail.TYPE+"");						//차종
		$('#Purpose').text(_carInfoDetail.Usage+"");				//용도
		$('#Color').text(_carInfoDetail.Color+"");					//색상
		$('#SourceDivision').text(_carInfoDetail.SourceDivision+"");	//출처구분
		$('#FirstRegDate').text(_carInfoDetail.FirstRegDate+"");		//최초등록일
		$('#ProductDate').text(_carInfoDetail.ProductDate+"");		//제작년월일
		$('#ChassisNumber').text(_carInfoDetail.ChassisNumber+"");	//차대번호
		if(_carInfoDetail.EcoFriendly == "Y"){						//환경친화적차량
			$('#EcoFriendly').text("유");
		}else{
			$('#EcoFriendly').text("무");
		}
		$('#CountryOrigin').text(_carInfoDetail.CountryOrigin+"");	//국산/수입
		
		
		$('#Displacement').text(moca.comma(_carInfoDetail.Displacement)+"cc");	//배기량
		
		
		$('#RidingCapacity').text(_carInfoDetail.RidingCapacity+"명");//승차정보
		$('#Fuel').text(_carInfoDetail.Fuel+"");						//사용연료명
		$('#Purpose2').text(_carInfoDetail.Purpose+"");				//차종유형명
		$('#FuelRatio').text(_carInfoDetail.FuelRatio+"ℓ");			//복합연비
		$('#MoverType').text(_carInfoDetail.MoverType+"");			//원동기형식
		
		if(moca.trim(_carInfoDetail.MaxLoad) != ''){
			$('#MaxLoad').text(_carInfoDetail.MaxLoad+"kg");				//최대적재량
		}
		
		
		$('#MortgageCnt').text(_carInfoDetail.MortgageCnt+"");		//저당 건수
		$('#SeizeCnt').text(_carInfoDetail.SeizeCnt+"");				//압류/촉탁 건수
		$('#StructCngCnt').text(_carInfoDetail.StructCngCnt+"");		//구조변경
		$('#UseCngCnt').text(_carInfoDetail.UseCngCnt+"");			//용도변경
		if(_mortgageList != ""){
			$('#MortgageCnt').closest('div').addClass('on');
			$('#Mortgage').show();
			$('#NoticePhoneNum').show();

			$('#MortgagorName').text(_mortgageList[0].MortgagorName+"");		//저당설정자
			$('#MortgagePhone').text(_mortgageList[0].MortgagePhone+"");		//연락처
			$('#MortgageName').text(_mortgageList[0].MortgageName+"");		//저당권자
			$('#MortgageRegDate').text(_mortgageList[0].MortgageRegDate+"");	//저당설정일
			$('#BondAmount').text(_mortgageList[0].BondAmount+"");//채권가액
		}
		if(_seizeList != ""){
			$('#SeizeCnt').closest('div').addClass('on');
			$('#Seize').show();
			$('#NoticePhoneNum').show();

			$('#SeizeOrg').text(_seizeList[0].seizeOrg+"");					//압류기관
			$('#SeizePhone').text(_seizeList[0].seizePhone+"");				//연락처
			$('#SeizeDate').text(_seizeList[0].seizeDate+"");				//압류일자
			$('#SeizeHis').text(_seizeList[0].seizeHis+"");					//압류내용	
		}
		if(_structCngList != ""){
			$('#StructCngCnt').closest('div').addClass('on');
			$('#StructCng').show();
			var _html = '<h4>구조변경</h4>';
			for(var i=0; i < _structCngList.length; i++){
				var a = _structCngList[i];
				_html +='<div class="co">';
					_html += '<ul class="lta">';
						_html += '<li><span>제목 :</span><span>' + _structCngList[i].structCngTitle + '</span></li>'; //제목             
						_html += '<li><span>일자 :</span><span id="StructCngDate">' + _structCngList[i].structCngDate + '</span></li>'; //일자
						_html += '<li><span>내용 :</span><span id="StructCngContents">' + _structCngList[i].structCngContents + '</span></li>'; //내용
					_html += '</ul>';
				_html += '</div>';	
			}
			$('#StructCng').html(_html);
					
		}
		if(_useCngList != ""){
			$('#UseCngCnt').closest('div').addClass('on');
			$('#UseCng').show();
			var _html = '<h4>용도변경</h4>';
			for(var i=0; i < _useCngList.length; i++){
				var a = _useCngList[i];
				_html +='<div class="co">';
					_html += '<ul class="lta">';
						//_html += '<li><span>제목 :</span><span>' + _useCngList[i].useCngTitle + '</span></li>';
						_html += '<li><span>일자 :</span><span id="UseCngDate">' + _useCngList[i].useCngDate + '</span></li>'; //일자
						_html += '<li><span>내용 :</span><span id="UseCngContents">' + _useCngList[i].useCngContents + '</span></li>'; //내용
					_html += '</ul>';
				_html += '</div>';	
			}
			$('#UseCng').html(_html);
		}
		
		
		
		// 주행거리계산을 위한 최초등록일에서 지난 일자 계산
 	 	// 최초등록일
	    var yyyyMMdd = String(_carInfoDetail.FirstRegDate);
	    var sYear = yyyyMMdd.substring(0,4);
	    var sMonth = yyyyMMdd.substring(5,7);
	    var sDay = yyyyMMdd.substring(8,10);
		    
 		// 오늘 
	    let today = new Date();
	    let year = today.getFullYear(); // 년도
	    let month = today.getMonth() + 1;  // 월
	    let day = today.getDate();  // 날짜

	    month = month >= 10 ? month : '0' + month;  //month 두자리로 저장
	    day = day >= 10 ? day : '0' + day;          //day 두자리로 저장
 		 
		
 	 	// 최초등록일
 		const date1 = new Date(sYear, sMonth, sDay);
 		// 오늘 
 		const date2 = new Date(year, month, day);

 		//지난 시간계산(밀리초)
 		const elapsedMSec = date2.getTime() - date1.getTime();
 		//일수로 변환
 		const elapsedDay = elapsedMSec / 1000 / 60 / 60 / 24;
		
		moca.setSs("elapsedDay",elapsedDay);
		moca.setLs("elapsedDay",elapsedDay);
				
	};
	function fnNext(thisObj){
  		//타임체크
    	moca.TOM_39_SRC.exe({
    		url : moca._domain+moca._contextRoot+"/TOM_39/selecIsTimeOnForTORequest.do",
    		//loadingbar:true,
    		//loadingInfo:{type:"mobile",className:"_modal",content:"<span>소유권이전가능시간체크중.. 잠시만 기다려주세요!</span>"},
            data : {
            	"header" : moca.header,
            	"body" : {
            	}
            },			
    		callback : function(response){
    			if(response.error != null){
    				moca.error(response.error,"",function(){
    					
    				});
    				return;
    			}
    			if(response.mapTimeCheck != null){
    				if(response.mapTimeCheck.IsTimeOn == '1'){
    					//ok
    					/*
    					 - 운영관리에서 설정된 의뢰시간 이후									
    						 																- 저당권 설정이 있는 차량						83부5895/배효성			
    						 																- 압류/촉탁이 있는 차량									
    						 - 차량등록원부상 출처구분이 전입차로 등록된 차량									
    						 																- 차량의 시세표준가격 책정이 불가능한 차량									
    						 																- 지역번호판						서울12자1630/이세영			
    						 																- 공동소유자 차량						49가2594/권태우(50%),『권기행(50%)』			
    						 - 법인차량									
    						 - 영업용 차량									
    						 - 사업자 차량									
						    						 										 - 경차						39구2891/양건희			
																    						 - 하이브리드차량						08버1513/김남규			
																    						 - 전기차량						06도6403/한지범			
    						 																- 승합차						73라7981/김영도			
    						 																- 화물차						97노1482/이승영	
    						 
     						moca.merrorBig('<span>중고차 분석</span>을<br>실패했습니다.','비과세/공채 감면 대상 차량','경차,하이브리드 및 전기차량 이전 불가','다시 분석하기',function(){
    							location.href='TOM_25.html';
    						});
    						return;
    						return;
    						
    					*/
    					
    					_html = "";
    					       				
    					        				
    					response.errorCodeList = [];
    					if(_carInfoDetail.LastOwner.includes(",")){
        					_html +='<li>';
        					_html +='<label>공동소유자 차량</label>';
    						_html += '<span class="error">오류</span>	';
        					_html +='</li>';
    					}
/*     					if(_carInfoDetail.CarType != "승용"){
    						response.errorCodeList.push('승합차/화물차/특수차 이전 불가');
    					} */
    					
    					if(!(_carInfoDetail.Usage.indexOf('자가용') > -1)) {
        					_html +='<li>';
        					_html +='<label>법인 또는 영업용, 사업자 차량</label>';
    						_html += '<span class="error">오류</span>	';
        					_html +='</li>';
    					}

    					if(_seizeList != ""){
        					_html +='<li>';
        					_html +='<label>압류, 촉탁 차량</label>';
    						_html += '<span class="error">오류</span>	';
        					_html +='</li>';
    					}
    					if(_mortgageList != ""){
        					_html +='<li>';
        					_html +='<label>저당 차량</label>';
    						_html += '<span class="error">오류</span>	';
        					_html +='</li>';
    					}
    					if(_useCngList != ""){
        					_html +='<li>';
        					_html +='<label>용도변경</label>';
    						_html += '<span class="error">오류</span>	';
        					_html +='</li>';
    					}
/*     					if(_carInfoDetail.TYPE.indexOf('경형') > -1 || _carInfoDetail.Fuel.indexOf('하이브리드') > -1  || _carInfoDetail.Fuel.indexOf('전기') > -1){
    						response.errorCodeList.push('비과세/공채 감면 대상 차량_경차,하이브리드 및 전기차량 이전 불가');
    					} */
    					if(isNaN(_carInfoDetail.RegNumber.charAt(0))){
        					_html +='<li>';
        					_html +='<label>지역번호판 차량</label>';
    						_html += '<span class="error">오류</span>	';
        					_html +='</li>';
    					}
    					if(_carInfoDetail.MdlRate == null || moca.trim(_carInfoDetail.MdlRate) == '' || _carInfoDetail.MdlRate < 1){
        					_html +='<li>';
        					_html +='<label>시세 책정불가 차량</label>';
    						_html += '<span class="error">오류</span>	';
        					_html +='</li>';
    					}
    					    					
						var fullErrorContent = '';
						for(var g=0; g< response.errorCodeList.length; g++){
							var txt = response.errorCodeList[g];
								fullErrorContent +='<li><span class="error_txt"><i class="fl check"></i>'+txt+'</span></li>';
						}
						if(_html.length > 0){
							//소유권이전불가 오류메세지표시
							
							$('#error_box').html(_html);							
							window.scrollTo(0,0)							
							$("._modal").show();											

/* 							return; */
						}else{
							moca.setSs('validOkStep39',true);
	    					location.href = 'TOM_40.html';
						}
    				}else{
						//timeout
						moca.merrorBig("이전신청시간마감","소유권이전신청 마감시간이 지났습니다.","익일 차량분석부터 재진행 해주세요.","확인",function(){
							location.href = "TOM_25.html?isCancel=true";
						});
    				}
    			}
    			
    		}
    	});
  		
	};
	
	function close_modal() {
		$("._modal").hide();
		location.href='TOM_25.html';
	};
	
	
	moca.TOM_39_SRC.back = function(){
		location.href = 'TOM_25.html';
	}
</script>
</head>
<body>
	<!-- 소유권 이전 받기 버튼 누르면 TOM_40_SRC.html로 이동 -->
	<!-- 오류 팝업 TOM_39_1.html -->
	<div class="wrap">
		<header class="titlebar">
			<button class="btn_back" type="button"  onclick="moca.TOM_39_SRC.back()">이전페이지</button>
		</header>

		<div class="content list">
			<section class="tit">
				<div class="inner">
					<h2 id="CarName"></h2>
					<em id="UsedCarRemainingPrice"></em>
					<span>신차 출고 이후 <i id="VehicleElapsedYear_Original"></i><i id="VehicleElapsedMonth"></i><i id="VehicleElapsedDay"></i> 지났습니다.</span>
					<div class="price-area">
						<dl>
							<dt>상한가</dt>
							<dd><span id="UpRate">-</span></dd>
						</dl>
						<dl>
							<dt>하한가</dt>
							<dd><span id="MdlRate">-</span></dd>
						</dl>
					</div>
					<p>기준일 : 2019.09.08</p>
				</div>
			</section>
			<section>
				<h3 class="ic1">제원정보</h3>
				<div class="inner">
					<ul class="l_bx">
						<li>
							<label>모델연도</label>		
							<span id="ModelYear"></span>	
						</li>
						<li>
							<label>소유자명</label>		
							<span id="LastOwner"></span>	
						</li>
						<li>
							<label>자동차등록번호</label>		
							<span id="RegNumber"></span>	
						</li>
						<li>
							<label>차종</label>		
							<span id="TYPE"></span>	
						</li>
						<li>
							<label>용도</label>		
							<span id="Purpose"></span>	
						</li>
						<li>
							<label>색상</label>		
							<span id="Color"></span>	
						</li>
						<li>
							<label>출처구분</label>		
							<span id="SourceDivision"></span>	
						</li>
						<li>
							<label>최초등록일</label>		
							<span id="FirstRegDate"></span>	
						</li>
						<li>
							<label>제작년월일</label>		
							<span id="ProductDate"></span>	
						</li>
						<li>
							<label>차대번호</label>		
							<span id="ChassisNumber"></span>	
						</li>
					</ul>
					<div class="carcheck-img">
                        <img src="../images/mobile/carchekc.png" alt="자동차 정비 이미지"></div>
                    <div class="price-area date">
                        <dl>
                            <dt>검사유효기간시작일</dt>
                            <dd><span>2019.06.29</span></dd>
                        </dl>
                        <dl>
                            <dt>검사유효기간종료일</dt>
                            <dd><span>2021.06.28</span></dd>
                        </dl>
                    </div>
				</div>
			</section>
			<section>
				<h3 class="ic2">성능정보</h3>
				<div class="inner">
					<ul class="l_bx">
						<li>
							<label>환경친화적차량</label>
							<span id="EcoFriendly"></span>
						</li>
						<li>
							<label>국산/수입</label>
							<span id="CountryOrigin"></span>
						</li>
						<li>
							<label>배기량</label>
							<span id="Displacement"></span>
						</li>
						<li>
							<label>승차정보</label>
							<span id="RidingCapacity"></span>
						</li>
						<li>
							<label>사용연료명</label>
							<span id="Fuel"></span>
						</li>
						<li>
							<label>차종유형명</label>
							<span id="Purpose2"></span>
						</li>
						<li>
							<label>복합연비</label>
							<span id="FuelRatio"></span>
						</li>
						<li>
							<label>원동기형식</label>
							<span id="MoverType"></span>
						</li>
						<li>
							<label>최대적재량</label>
							<span id="MaxLoad"></span>
						</li>
					</ul>
				</div>
			</section>
			<section>
				<h3 class="ic3">제한사항</h3>
				<div class="inner">
					<!-- <ul class="r_list">
						<li>
							<div class="radi c1">
								<span id="MortgageCnt"></span>
							</div>
							<span>저당</span>
						</li>
						<li>
							<div class="radi c2">
								<span id="SeizeCnt"></span>
							</div>
							<span>압류/촉탁</span>
						</li>
						<li>
							<div class="radi c3">
								<span id="StructCngCnt"></span>
							</div>
							<span>구조변경</span>
						</li>
						<li>
							<div class="radi c3">
								<span id="UseCngCnt"></span>
							</div>
							<span>용도변경</span>
						</li>
					</ul>
					<div id="Mortgage">
						<h4>저당</h4>
						<div class="co">
							<ul class="lta">
								<li><span>설정자 :</span><span id="MortgagorName"></span></li>
								<li><span>저당권자 :</span><span id="MortgageName"></span></li>
								<li><span> 설정일 :</span><span id="MortgageRegDate"></span></li>
								<li><span>채권가액 :</span><span id="BondAmount"></span></li>
							</ul>
							<div class="rta"><a class="tel" href="tel:02-2345-2345" id="MortgagePhone"></a></div>
						</div>
					</div>
					<div id="Seize">
						<h4>압류</h4>
						<div class="co">
							<ul class="lta">
								<li><span>압류기관 :</span><span id="SeizeOrg"></span></li>
								<li><span>압류일자 :</span><span id="SeizeDate"></span></li>
								<li><span> 압류내용 :</span><span id="SeizeHis"></span></li>
							</ul>
							<div class="rta"><a class="tel" href="tel:02-2345-2345" id="SeizePhone"></a></div>
						</div>
					</div>
					<div id="StructCng">	</div>
					<div id="UseCng"></div>
					<p id="NoticePhoneNum">위 전화 번호는 변경 등이 발생 할 수 있습니다.</p> -->
					<div class="car-desc">
						<div class="car-desc-detail">
							<ul>
								<li>
									<div class="bg01">
										<span id="MortgageCnt"></span>
									</div>
									<p>저당</p>
								</li>
								<li>
									<div class="bg02">
										<span id="SeizeCnt"></span>
									</div>
									<p>압류/촉탁</p>
								</li>
								<li>
									<div class="bg03">
										<span id="UseCngCnt"></span>
									</div>
									<p>용도변경</p>
								</li>
							</ul>
						</div>
						<div class="car-desc-info" id="Mortgage">
							<h4>저당</h4>
						<div class="co">
							<ul class="lta">
								<li><span>설정자 :</span><span id="MortgagorName"></span></li>
								<li><span>연락처 :</span><span id="MortgagePhone"></span></li>					
								<li><span>저당권자 :</span><span id="MortgageName"></span></li>
								<li><span> 설정일 :</span><span id="MortgageRegDate"></span></li>
								<li><span>채권가액 :</span><span id="BondAmount"></span></li>
							</ul>							
						</div>
						</div>
						<div class="car-desc-info" id="Seize">
							<h4>압류</h4>
						<div class="co">
							<ul class="lta">
								<li><span>압류기관 :</span><span id="SeizeOrg"></span></li>
								<li><span>연락처 :</span><span id="SeizePhone"></span></li>
								<li><span>압류일자 :</span><span id="SeizeDate"></span></li>
								<li><span> 압류내용 :</span><span id="SeizeHis"></span></li>
							</ul>							
						</div>
						</div>
						
<!-- 						<div class="car-desc-info last">
							<h4>용도변경</h4>
							<div class="con-wrap">
								<ul>
									<li>제목 : 연결 및 견인장치 구조변경</li>
									<li>일자 : 2017.12.27</li>
									<li>내용 : 분리형 연결장치(견인최대 1500kg), 에스디원, 전기커넥터</li>
								</ul>
								<ul>
									<li>제목 : 물품적재장치 구조변경</li>
									<li>일자 : 2017.12.27</li>
									<li>내용 : 사료탱크로리(S/0.50)</li>
								</ul>
							</div>
						</div> -->
						
						
						<div id="UseCng"></div>
						
						<p id="NoticePhoneNum" class="sub-txt">* 위 전화번호는 변경 등이 발생 할 수 있습니다.</p>
					</div>
				</div>
			</section>
			<section class="btn_btm nm">
				<button class="btn_go" type="button" onclick="fnNext(this)" style="padding-top: 15px;">소유권 이전 받기</button>
			</section>
		</div>
		
	</div>
	
	
	
	
	<div class="_modal">
		<div class="pop_msg type2 fm">
			<div class="dfbox">
				<h3>해당 정보로 인해 <span class="txt_red">이전</span>이 <span class="txt_red">불가</span>합니다.</h3>
			</div>
			<div class="">
				<ul class="if_bx" id="error_box">
					<!-- <li>
						<label>저당 차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>지역번호판 차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>압류/촉탁 차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>법인차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>영업용 차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>사업자 차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>전입차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>공동소유자 차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>시세 책정불가 차량</label>		
						<span class="error">오류</span>	
					</li>
					<li>
						<label>용도변경</label>		
						<span class="error">오류</span>	
					</li> -->
				</ul>
			</div>			
			<button class="btn_close" type="button" onclick="close_modal()">확인</button>
		</div>
	</div>
	
	
		
	
</body>
</html>