<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" /> 
<meta http-equiv="Pragma" content="no-cache" /> 
<meta http-equiv="Expires" content="Mon, 06 Jan 1990 00:00:01 GMT">
<meta http-equiv="Expires" content="-1" />
<script>
	moca.TOM_40_1_SRC.___ready = function(args){
 		if(moca.getSs("loginInfo") == null || window.history.length < 3){
			location.href = '/to';
		};

		$("._modal").hide();
		
		$($('[name=ys_insu]')[0]).attr('checked','checked');
		if(moca.getSs("carDetailInfo").InspectionExpireDate != null && moca.getSs("carDetailInfo").InspectionExpireDate.split(':').length > 1){
			var ys_km2 = moca.getSs("carDetailInfo").InspectionExpireDate.split(':')[1].replace(/\s/g,'');
			$('#ys_km').val(moca.comma(ys_km2));
		}
		else if(moca.getSs("ysInfo") != null){
			$('#ys_km').val(moca.getSs("ysInfo").ys_km);
		}			
		
		else if(moca.getSs("ys_km") != null){
			$('#ys_km').val(moca.getSs("ys_km"));
		}			
		
		
		if($('#ys_km').length !== 0) {
			$('.btn_go').attr('disabled',false);
		}
		
		showKeyPad();
	};
	
	
	function go(){		
		var ys_km = $('#ys_km').val();
		if(moca.trim(ys_km) == ""){
			moca.malert('주행거리를 입력하세요!',null,function(){
				$('#ys_km').focus();
			});
			return;
		}
		
		
		elapsedDay = moca.getSs("elapsedDay");
		MinDistance = 14*elapsedDay;
		MaxDistance = 82*elapsedDay+2000;
		
		if(moca.getSs("carDetailInfo").InspectionExpireDate != null && moca.getSs("carDetailInfo").InspectionExpireDate.split(':').length > 1){			
			var check_km = "";			
			var ys_km2 = moca.getSs("carDetailInfo").InspectionExpireDate.split(':')[1].replace(/\s/g,'');			
			if (ys_km2 < MinDistance) {
				check_km = MinDistance;
			}
			else {
				check_km = ys_km2;
			}						
			if(check_km > ys_km.replace(/,/g,'') || MaxDistance < ys_km.replace(/,/g,'')){				
				_html = "";
				_html +='<strong>주행거리 입력 오류</strong>';
				_html +='<span>자동차등록원부상 최종주행거리보다 적게 입력하실 수 없습니다.</span>';
				_html +='<span style="font-family:NanumSquareEB;">*입력가능 주행거리 : ' + moca.comma(check_km) + 'km ~ '+ moca.comma(MaxDistance) +'km</span>';
					
				$('#error_box').html(_html);
				$("._modal").show();		
			}
			else {				
		 		moca.setSs("ys_km",ys_km);
				moca.setLs("ys_km",ys_km);				
				location.href="TOM_42.html";
			}
		}

		else {
			var check_km = MinDistance; 						
			if(check_km > ys_km.replace(/,/g,'') || MaxDistance < ys_km.replace(/,/g,'')){				
				_html = "";
				_html +='<strong>주행거리 입력 오류</strong>';
				_html +='<span>자동차등록원부상 최종주행거리보다 적게 입력하실 수 없습니다.</span>';
				_html +='<span style="font-family:NanumSquareEB;">*입력가능 주행거리 : ' + moca.comma(check_km) + 'km ~ '+ moca.comma(MaxDistance) +'km</span>';
					
				$('#error_box').html(_html);
				$("._modal").show();				
				
			}
			else {				
		 		moca.setSs("ys_km",ys_km);
				moca.setLs("ys_km",ys_km);				
				location.href="TOM_42.html";
			}
		}
	};
	
	function showKeyPad() {
		setTimeout(function(){
			$('.input_frm3').focus()
			if(window.BRIDGE != null){
				BRIDGE.showKeyPad();
			}
		},500);
	};
	
	function length_check(x) {
		if(x.length === 0) {
			$('.btn_go').attr('disabled',true);
		}
		else {
			$('.btn_go').attr('disabled',false);
		}
			
	};
	
	
	function numberWithCommas(x) {
		  x = x.replace(/[^0-9]/g,'');   // 입력값이 숫자가 아니면 공백
		  x = x.replace(/,/g,'');          // ,값 공백처리
		  $("#ys_km").val(x.replace(/\B(?=(\d{3})+(?!\d))/g, ",")); // 정규식을 이용해서 3자리 마다 , 추가 
	};
	
	function close_modal() {
		$("._modal").hide();
	};
	
	moca.TOM_40_1_SRC.back = function(args){
		location.href = 'TOM_40.html';
	};
</script>
</head>
<body>
	<div class="wrap">
		<header class="titlebar">
			<button class="btn_back" type="button" onclick="moca.TOM_40_1_SRC.back()">이전페이지</button>
		</header>
		<div class="inner">
			<div class="top_txt">
				<p>현재의 주행거리를<br>입력해주세요.</p>
			</div>
		</div>
		<div class="content btn_cont fx2 jct">
			<div class="inner">
				<ul class="d_form">
					<li>
						<div class="gox">
							<input class="input_frm3" type="tel" id="ys_km" placeholder="주행 거리" onkeyup="numberWithCommas(this.value); length_check(this.value);">	
							<button class="btn_clear" type="button" onclick="moca.compClear(this)">삭제</button>	
						</div>	
					</li>
					<li class="km-tip">
						현재 시점의 차량 주행거리를 입력해주세요. <br>주행거리를 잘못 입력 시, <br>차량 소유권 이전 등록이 불가능합니다.
					</li>
				</ul>
				<div class="btn_btm">
					<button class="btn_go" type="button" onclick="go()" disabled>다음</button>
				</div>
			</div>
		</div>
	</div>
	
	<div class="_modal">
		<div class="pop_msg type1">
			<div class="pop_cont" id="error_box">
<!-- 				<strong>주행거리 입력 오류</strong>
				<span>자동차등록원부상 최종주행거리보다 적게 입력하실 수 없습니다.</span>
				<span style="font-family:'NanumSquareEB';">*입력가능 주행거리 4,256~26,928km</span> -->
			</div>
			<div class="btnbox">
				<div class="rta">
					<button class="btn_cm" type="button" onclick="close_modal()">확인</button>
				</div>
			</div>
		</div>
	</div>
	
</body>
</html>