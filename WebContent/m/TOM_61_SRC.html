<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" /> 
<meta http-equiv="Pragma" content="no-cache" /> 
<meta http-equiv="Expires" content="Mon, 06 Jan 1990 00:00:01 GMT">
<meta http-equiv="Expires" content="-1" />
<script>
	moca.TOM_61_SRC.___ready = function(args){
		if(moca.getSs("loginInfo") == null || window.history.length < 3){
			location.href = '/to';
		};
		moca.setHistory('TOM_61',{'title':'이전등록비용표시','time':(new Date()).getTime()});
		
		/*
		String District_Major = (String) paramMap.get("District_Major");						// 양수인 행정구역(시도)
		String District_Major_Gu = (String) paramMap.get("District_Major_Gu");					// 양수인 행정구역(구)
		String VehicleBasisPrice = (String) paramMap.get("VehicleBasisPrice");					// 매매가격 (경감율 적용된 매매가 또는 과세표준 금액)
		String toVehicleRegistrationIdx = (String) paramMap.get("toVehicleRegistrationIdx");	// 자동차 등록원부 idx
		String toTransferOwnerIdx = (String) paramMap.get("toTransferOwnerIdx");				// 소유권이전요청 IDX (/TOM_52/mobile/sendKakaoCert.do 결과값으로 화면에 RETURN하는값)
		*/
		var _area = moca.getSs("ysInfo").ys_addr1.split(' ')[0];
		$('#area').html(_area);
		moca.TOM_61_SRC.transferPrice();
	};
	
	
	moca.TOM_61_SRC.transferPrice = function(){
		moca.TOM_61_SRC.exe({
			url : moca._domain+moca._contextRoot+"/TOM_61/mobile/transferPrice.do",
			loadingbar:true,
			loadingInfo:{type:"mobile",className:"_modal",content:"<span>잠시만 기다려주세요!</span>"},
	        data : {
	        	"header" : moca.header,
	        	"body" : {
	        		District_Major:moca.getSs("ysInfo").ys_addr1.split(' ')[0],
	        		District_Major_Gu:moca.getSs("ysInfo").ys_addr1.split(' ')[1],
	        		VehicleBasisPrice:moca.getSs("won").replace(/,/g,''),
	        		toVehicleRegistrationIdx:moca.getSs("coocon_data"),
	        		toTransferOwnerIdx:moca.getSs("transferownerId")
	        	}
	        },			
			callback : function(response){
				if(response.error){
					moca.malert(response.error,'',function(){
						return;
					});
					return;
				};
				var o = response.transferCostMap;
				/*
				bondInfo_PurchasePrice_Result : 채권금액
				bondInfo_SellingSelPayfPrice : 채권비용 계	
				*/
				
				
				var keys = Object.keys(o);
				for(var i=0; i < keys.length; i++){
					var val = o[keys[i]];
					if(keys[i] == "total_TransferOwner_Price"){
						moca.setAs("total_TransferOwner_Price",val);
						$('#'+keys[i]).html(moca.comma(val)+"원"); 	
						$('#total_TransferOwner_Price2').html(moca.comma(val)+"원");
					}else if(keys[i] == "today"){
						$('#'+keys[i]).html(moca.comma(val)); 	
						$('#today2').html(moca.comma(val)+"기준입니다<br/>채권 금액의 변동으로 매일 달라집니다.");
					}else if(keys[i] == "Bank_Nm"){
						$('#'+keys[i]).html(moca.comma(val)); 					
					}else{
						$('#'+keys[i]).html(moca.comma(val)+"원");
					}
				}
				
				if(o.bondExemptionYn == 'N'){
					$('#채권면제여부').css('display','none');
				}
				/*
				if(response.accountList != null && response.accountList.length > 0){
					//출금이체요청
					location.href="TOM_81.html";
				}else{
					//결제계좌등록
					location.href="TOM_63.html";
				}
				*/
			}
		});
	};

	
	
	function go(){
		var total_TransferOwner_Price = moca.getLs("total_TransferOwner_Price");
		if(total_TransferOwner_Price > 1999999){
		//if(false){
			moca.mresult("온라인 결제 한도 초과","전자금융거래법 시행령 제 13조 1항에<br> 따라 최고한도는 200만원입니다.",function(){
				
			});
			return;
		}else{
			moca.TOM_61_SRC.transferPrice();
			$('#showConfirm').css('display','block');
		}
	};
	
	function goHide(){
		$('#showConfirm').css('display','none');
	};
	
	function go2(){
    	moca.TOM_61_SRC.exe({
    		url : moca._domain+moca._contextRoot+"/TOM_81/mobile/AccountList.do",
    		loadingbar:true,
    		loadingInfo:{type:"mobile",className:"_modal",content:"<span>잠시만 기다려주세요!</span>"},
            data : {
            	"header" : moca.header,
            	"body" : {
            	}
            },			
    		callback : function(response){
    			if(response.accountList != null && response.accountList.length > 0){
    				//출금이체요청
    				location.href="TOM_81.html";
    			}else{
    				//결제계좌등록
    				location.href="TOM_63.html";
    			}
    		}
    	});
	};	
	
	
	moca.TOM_61_SRC.toCancel = function(){
		moca.mconfirm('소유권이전을 취소하시겠습니까?','',function(_result){
			if(_result == 'Y'){
				moca.TOM_61_SRC.exe({
					url : moca._domain+moca._contextRoot+"/TOM_60/mobile/cancelTransferOwner.do",
		            data : {
		            	"header" : moca.header,
		            	"body" : {
		            		Stage:"26",
		            		idx:moca.getSs("transferownerId")+""
		            	}
		            },		
					callback : function(response){
						
						if(response.error){
							moca.merror(response.error,'',function(){
								location.href='TOM_25.html?isCancel=true';
							});
						}else if(response.rePayResYn == 'N'){
			        	    moca.mresult('성공적으로 취소되었습니다!','',function(){
			        		   location.href='TOM_25.html?isCancel=true';
			        	   });	
						}else{
							//polling후
			        	    moca.mresult('성공적으로 취소되었습니다!','',function(){
			        	    	location.href='TOM_25.html?isCancel=true';
			        	    });	
						}

					}
				});
			}
		});
	};
</script>

</head>
<body>
	<div class="wrap">
		<header class="titlebar">
			<h2 class="tit"><a href="javascript:void(0)" onclick="moca.TOM_61_SRC.toCancel()">이전 취소</a></h2>
		</header>

		<div class="content btn_cont fx2 jct2">
			<div class="top_txt">
				<p><span id="area"></span> 등록<br>이전비용 입니다.</p>
			</div>
			<section class="tit2">
				<em id="total_TransferOwner_Price">원</em>
				<span class="fs12" id="today"></span>
			</section>
			<section class="rbox">
				<dl>
					<dt>
						<label>취득세</label>
						<span id="taxPrice_Acquisition_RealCost">원</span>
					</dt>
					<dd>
						<ul>
							<li>
								<label>취, 등록세 7% 적용</label>		
								<span id="taxPrice_Acquisition">원</span>	
							</li>
							<li>
								<label>할인면제금액</label>		
								<span id="taxPrice_Acquisition_ReductionPrice">원</span>	
							</li>
						</ul>
					</dd>
				</dl>	
			</section>
			<section class="rbox">
				<dl>
					<dt>
						<label>채권</label>
						<span id="bondInfo_SellingSelPayfPrice">원</span>
					</dt>
					<dd>
						<ul>
							<li>
								<label>채권(공채) 매입은행</label>		
								<span id="Bank_Nm"></span>	
							</li>
							<li>
								<label>채권(공채) 매도단가</label>		
								<span id="bondInfo_SellingPrice_Today">원</span>	
							</li>
							<li>
								<label>채권(공채) 매입금액</label>		
								<span id="bondInfo_SellingPrice_Result">원</span>	
							</li>
							<li>
								<label>즉시할인매도 금액</label>		
								<span id="bondInfo_PurchasePrice_RealCost">원</span>	
							</li>
							<li>
								<label>은행 결제원 수수료 0.6%</label>		
								<span id="agencyFee_SellingBond_Bank">원</span>	
							</li>
							<li>
								<label>선급이자</label>		
								<span id="bondInfo_SellingProfit">원</span>	
							</li>
							<li>
								<label>소득세 10%</label>		
								<span id="taxPrice_Income">원</span>	
							</li>
							<li>
								<label>지방소득세 14%</label>		
								<span id="taxPrice_Local">원</span>	
							</li>
							<li>
								<label>채권(공채)매입 전산 이용료</label>		
								<span id="agencyFee_PurchaseBond_CarBang">원</span>	
							</li>
						</ul>
					</dd>					
				</dl>
				<div class="tip" id='채권면제여부'><p><strong id="RegNumber"></strong> 차량은 현재(2019.09.09) <strong id="District_Major"></strong>로 이전등록 시 채권(공채) <strong>면제대상</strong> 입니다.</p></div>
			</section>
			<section class="rbox">
				<dl>
					<dt>
						<label>인지세</label>
						<span id="officeCharge">원</span>
					</dt>
					<dd>
						<ul>
							<li>
								<label>전자수입인지</label>		
								<span id="Revenue_StampPrice">원</span>	
							</li>
							<li>
								<label>관공서 등록 수수료</label>		
								<span id="agencyFee_Office_Registration">원</span>	
							</li>
						</ul>
					</dd>
				</dl>	
			</section>
			<section class="rbox">
				<dl>
					<dt>
						<label>이전 등록 대행료</label>
						<span id="agencyFee_Transfer_CarBang">원</span>
					</dt>
				</dl>	
			</section>
		</div>
		
		
		
		
		<div class="_modal" style="display:none" id="showConfirm">
			<div class="pop_msg btm pb20 pop_show">
				<div class="dfbox">
					<h3><span>이전 비용</span>을 <br>결제해주세요.</h3>
				</div>
				<section class="tit2">
					<em  id="total_TransferOwner_Price2" value=''>원</em>
					<span class="fs12" id="today2"></span>
				</section>
<!-- 				<section class="nlist">
					<dl>
						<dt><span>내역</span><i></i></dt>
						<dd>
							<ul>
								<li>
									<label>취득세</label>
									<span id="">284,800원</span>
								</li>
								<li>
									<label>추가 금액</label>		
									<span id="">35,200원</span>	
								</li>
							</ul>
						</dd>
					</dl>	
				</section> -->
				<button class="btn_close" type="button" onclick="goHide()">닫기</button>
				<button class="btn_go" type="button" onclick="go2()">간편결제하기</button>
			</div>
		</div>
		<div class="btn_btm">
			<button class="btn_go" type="button" onclick="go()">간편결제하기</button>
		</div>
	</div>
	
</body>
</html>