<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Expires" content="Mon, 06 Jan 1990 00:00:01 GMT">
<meta http-equiv="Expires" content="-1" />
<meta name="viewport"
	content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>모바일 웹 온라인 소유권 이전</title>
<link rel="stylesheet" type="text/css" href="../css/mobile.css?after">
<script>
	moca.TOM_19_SRC.___ready = function(args){
		setTimeout(function(){
			$('#BirthDate').focus();
			if(window.BRIDGE != null){
				BRIDGE.showKeyPad();
			}
		},500);
	};
	
	moca.TOM_19_SRC.fn_sendCert = function(){
		if($('#BirthDate').val().length != 8){
			moca.malert('생년월일8자리를 입력해주세요!','',function(){
				$('#BirthDate').focus();
			});
			return;
		}
		
		var bd = $('#BirthDate').val().replace(/(\d{4})(\d{2})(\d{2})/g,'$1-$2-$3');
		
    	moca.TOM_19_SRC.exe({
    		url : moca._domain+moca._contextRoot+"/TOM_02/userInfo.do",
    		loadingbar:true,
            data : {
            	"header" : moca.header,
            	"body" : {"id":JSON.parse(sessionStorage.getItem('loginTemp0')).id+"",
            		"loginType":sessionStorage.getItem('loginType')
            		}
            },			
    		callback : function(response){
    			if(response.userInfo == null){
					moca.merror("가입된 정보가 없습니다.","다시 입력해주세요",function(){
					});	
					return;
    			}else if(response.userInfo.birthDate != bd){
					moca.merror("등록된 생년월일과 일치하지 않습니다.","",function(){
						$('#BirthDate').focus();
					});	
					return;
    			}else{
    				moca.setSs("BirthDate",bd);
    				moca.TOM_19_SRC.exe({
    					url : moca._domain+moca._contextRoot+"/TOM_19/recreatePassword.do",
    					loadingbar:true,
    					data : {
    						"header" : moca.header,
    						"body" : {
    							"BirthDate":moca.getSs("BirthDate"),
    							"id":JSON.parse(sessionStorage.getItem('loginTemp0')).id+"",
    		            		"loginType":sessionStorage.getItem('loginType')
    							}
    					},			
    					callback : function(response){
    						if(response.error != null){
    							moca.merror(response.error,'',function(){
    								
    							});
    							return;
    						}else if(response.Mobile_Phone != null){
    							
    							moca.mresult(moca.phoneWithDashFormatter(response.Mobile_Phone),"위번호카톡으로 임시보안번호를 발송합니다",function(){
    								location.href = "TOM_09.html";
    							});
    						}
    					}
    				});
    			}
    		}
    	});
		

	};
</script>
</head>
<body>
	<!-- 임시보안번호 발송 성공시 TOM_21.html
	발송오류 TOM_22.html -->
	<div class="wrap">
		<header class="titlebar">
			<button class="btn_back" type="button">이전페이지</button>
			<!-- <h2 class="tit"><a href="">회원가입</a></h2> -->
		</header>
		<div class="inner">
			<div class="top_txt">
				<p>
					보안번호를<br>잊으셨나요?
				</p>
			</div>
		</div>

		<div class="content fx2">
			<div class="inner">
				<ul class="d_form">
					<li class="grp_gox">
						<div class="gox">
							<input class="input_frm active" type="tel" placeholder="생년월일 8자리(19990101)" maxLength="8" id="BirthDate" value="1999-01-01">
							<button class="btn_clear r1" type="button">삭제</button>
						</div>
						<p class="tip">가입 시 등록하신 생년월일을 입력하시면,<br>SMS를 통해 임시 보안번호를 발송합니다.</p>
					</li>
				</ul>
				<div class="btn_btm">
					<button class="btn_go fix" type="button" onclick="moca.TOM_19_SRC.fn_sendCert(this)">임시 보안번호 보내기</button>
				</div>
			</div>
		</div>
	</div>
	
</body>
</html>