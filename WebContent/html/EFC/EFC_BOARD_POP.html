<!DOCTYPE html>
<html lang="ko">
<head meta_width="1300px" meta_height="550px">
<script>
$m.EFC_BOARD_POP.editor;
$m.EFC_BOARD_POP._boardIdx;
$m.EFC_BOARD_POP._boardPIdx;
$m.EFC_BOARD_POP._boardType;
$m.EFC_BOARD_POP._boardTitle;
$m.EFC_BOARD_POP._boardStatus;
$m.EFC_BOARD_POP._boardReplyStatus;
$m.EFC_BOARD_POP.___ready = function(args){

	if(window['viewMode'] != 'contentOnly'){
		$m.show($m.EFC_BOARD_POP.getObj('form_board'));
		$m.show($m.EFC_BOARD_POP.getObj('grd_file'));
		$m.show($m.EFC_BOARD_POP.getObj('grd_reply_list'));
		$m.show($m.EFC_BOARD_POP.getObj('contourBar'));
		$($m.EFC_BOARD_POP.getObj('edit_zoomBtn')).parent().addClass('mt5');
	}
	$m.EFC_BOARD_POP.code({
        "cmb_board":{code:'boardStatus'}
    },function(result){
    	if(($m.getSs("loginTemp0") == null || $m.getSs("loginTemp0") == '') && $m.getSs("USER_ID") == null){
    		$m.hide($m.EFC_BOARD_POP.getObj("btn_reply"));
			$($m.EFC_BOARD_POP.getObj("form_board")).removeClass("toolbar");
			$($m.EFC_BOARD_POP.getObj("form_board")).find(".moca_addtion_area").hide();
		}
    	$m.hide($m.EFC_BOARD_POP.getObj('grd_file_btn_delrow'));
    	$m.hide($m.EFC_BOARD_POP.getObj('grd_reply_file_btn_delrow'));
    	$m.hide($m.EFC_BOARD_POP.getObj('btn_add'));
    	$m.hide($m.EFC_BOARD_POP.getObj('btn_reply_add'));
    	$m.hide($m.EFC_BOARD_POP.getObj('btn_receipt'));
    	$m.hide($m.EFC_BOARD_POP.getObj('btn_update'));
    	$m.hide($m.EFC_BOARD_POP.getObj('btn_reply_update'));
    	
    	$m.hide($($m.EFC_BOARD_POP.getObj('grd_file_btn_fold')).siblings());
    	$m.hide($($m.EFC_BOARD_POP.getObj('grd_reply_file_btn_fold')).siblings());
    	$m.hide($($m.EFC_BOARD_POP.getObj('grd_reply_list_btn_fold')).siblings());
    	$m.hide($($m.EFC_BOARD_POP.getObj('grd_reply_list')).find('.moca_grid_list'));
    	$m.hide($($m.EFC_BOARD_POP.getObj('form_board')).find('.rta'));
    	$m.hide($($m.EFC_BOARD_POP.getObj('grd_file')).find('.moca_grid_list'));
    	$m.hide($($m.EFC_BOARD_POP.getObj('grd_reply_file')).find('.moca_grid_list'));
    	if(args != null){
    		$m.EFC_BOARD_POP.args = args;
    		$m.EFC_BOARD_POP._boardIdx = $m.EFC_BOARD_POP.args.parent.data.BOARD_IDX;
    		$m.EFC_BOARD_POP._boardPIdx = $m.EFC_BOARD_POP.args.parent.data.BOARD_PIDX;
    		$m.EFC_BOARD_POP._boardType = $m.EFC_BOARD_POP.args.parent.data.BOARD_TYPE;
    		$m.EFC_BOARD_POP._boardTitle = $m.EFC_BOARD_POP.args.parent.data.BOARD_TITLE;
    		$m.EFC_BOARD_POP._pageType = $m.EFC_BOARD_POP.args.parent.data.PAGE_TYPE;
    		if($m.getDevice() == 'mobile' && args.parent.data.popTitle != '게시물작성'){
    			$m.hide($($m.EFC_BOARD_POP.getObj("contents")).find('.mHide'));
    			$m.show($($m.EFC_BOARD_POP.getObj("contents")).find('.mShow'));
        		$m.hide($m.EFC_BOARD_POP.getObj('tr_phone'));
        		$m.hide($m.EFC_BOARD_POP.getObj('tr_email'));
        	}else if($m.getDevice() == 'mobile' && args.parent.data.popTitle == '게시물작성'){
        		$m.hide($($m.EFC_BOARD_POP.getObj("contents")).find('.mShow'));
        		$m.hide($($m.EFC_BOARD_POP.getObj("contents")).find('.writeHide'));
        	}else{
        		$m.hide($($m.EFC_BOARD_POP.getObj("contents")).find('.mShow'));
        	}
    		if(args.parent.obj != null){
        		$m.EFC_BOARD_POP.timeoutValue = args.parent.obj.timeoutValue;
        		if($m.EFC_BOARD_POP.timeoutValue != null){
        			console.log('parent clearInterval',$m.EFC_BOARD_POP);
        			clearInterval($m.EFC_BOARD_POP.timeoutValue);
        		}
    		}
    	}
    	if($m.EFC_BOARD_POP._boardType == "NOTICE" || $m.EFC_BOARD_POP._pageType == 'home'){
    		$m.hide($m.EFC_BOARD_POP.getObj('tr_status'));
    		$m.hide($m.EFC_BOARD_POP.getObj('tr_phone'));
    		$m.hide($m.EFC_BOARD_POP.getObj('tr_email'));
    		$m.hide($m.EFC_BOARD_POP.getObj('tr_completeid'));
    	}
    	
    	if(Object.keys(CKEDITOR.instances).length > 0){
    		if(CKEDITOR.instances.editor != null){CKEDITOR.instances.editor.destroy()};
    		if(CKEDITOR.instances.reply_editor != null){CKEDITOR.instances.reply_editor.destroy()};
    	}
    	 
    	CKEDITOR.replace( 'editor',{uiColor:'#fff9da',on:{
            'instanceReady':function(ev){
            	$m.EFC_BOARD_POP.editor = ev.editor;
            	$m.EFC_BOARD_POP._boardIdx = $m.EFC_BOARD_POP.args.parent.data.BOARD_IDX;
                if($m.EFC_BOARD_POP._boardIdx != null){
                	$m.EFC_BOARD_POP.editor.setReadOnly(true);
                }
                $('#contents').show();
                $m.EFC_BOARD_POP.fn_searchReply();
                $m.EFC_BOARD_POP.fn_search();
                $m.show($($m.EFC_BOARD_POP.getObj('form_board')).find('.rta'));
                $('.edit').find('iframe').contents().click(function(e) { 
                	if(typeof e.target.href != 'undefined'){
                		window.open(e.target.href, 'new'+ e.screenX);
                	}else if(e.target.parentElement != null && typeof e.target.parentElement.href != 'undefined'){
                		window.open(e.target.parentElement.href, 'new'+ e.screenX);
                	}
                });
                
        }}} );
    	CKEDITOR.replace( 'reply_editor',{uiColor:'#deecea',on:{
            'instanceReady':function(ev){
            	$('.edit').find('iframe').contents().click(function(e) { 
            		if(typeof e.target.href != 'undefined'){
            			window.open(e.target.href, 'new'+ e.screenX);
            		}
            	});
        }}} );
    
    });
};


$m.EFC_BOARD_POP._foldForm = function(_thisObj){
	var g_jq = $(_thisObj).closest('div[type="grid"]');
	g_jq = $(_thisObj).closest('div[type="form"]');
    var b_jq = $(_thisObj);
    var _childArr = $(_thisObj).closest('.ly_col_cont')[0].children;
    if(g_jq.find('.moca_table_cont').is(":visible")){
        for(var i=0;i<_childArr.length;i++){
            if(i>1){
                $(_childArr[i]).hide();
            }
        };
        $(_thisObj).closest('.moca_popup_body').prev().addClass('fold');
    }else{
    	for(var i=0;i<_childArr.length;i++){
            if(i>1){
                $(_childArr[i]).show();
            }
        };
        $(_thisObj).closest('.moca_popup_body').prev().removeClass('fold');
    }
    var _onFoldClick = g_jq.attr("onFoldClick");
    $m._foldGrid_common(b_jq,g_jq);
    if($m.trim(_onFoldClick) != ''){
   		eval(_onFoldClick)(b_jq,g_jq);
    };
    
    
    //$(_thisObj).closest('.moca_popup_header)
};

$m.EFC_BOARD_POP.fn_searchReply = function(_grd,_idx,tdObj,_thisObj){
	if($m.EFC_BOARD_POP._boardPIdx != null){
		$m.EFC_BOARD_POP.exe({
	        url : $m._domain+$m._contextRoot+"/EFC_BOARD/selectBoardReply.do",
	        loadingbar:true,
	        data : {
	            "header" : $m.header,
	            "body" : {
	            	"BOARD_PIDX":$m.EFC_BOARD_POP._boardPIdx,
	            	"BOARD_TYPE":$m.EFC_BOARD_POP._boardType
	            }
	        },          
	        callback : function(response){
	        	if(response.selectBoardReply != null ){
	        		$m.EFC_BOARD_POP.grdList = $m.getResList(response,"selectBoardReply");
		        	if($m.getResList(response,"selectBoardReply").length > 0){
		        		$m._foldGrid($m.EFC_BOARD_POP.getObj('grd_reply_list_btn_fold'));
				    }
		        	$m.EFC_BOARD_POP.drawGrid('grd_reply_list',$m.EFC_BOARD_POP.grdList);
	        	}
	        	
	        }
	    });
		
	}
};

$m.EFC_BOARD_POP.grd_1__onDblClick = function(_grd,rowIndex,colIndex,colId){
    ['게시글상세']
  //showhide처리
   $m.show($m.EFC_BOARD_POP.getObj("reply_edit_zoomBtn"));
    $m.hide($($m.EFC_BOARD_POP.getObj("cke_editor")).find("[id$='_top']"));
    $m.hide($($m.EFC_BOARD_POP.getObj("cke_reply_editor")).find("[id$='_top']"));
    $m.show($m.EFC_BOARD_POP.getObj("reply_area"));
    if($m.getDevice() != 'pc'){
    	
    	$m.hide($($m.EFC_BOARD_POP.getObj("form_board")).find(".moca_addtion_area"));
    	 $($m.EFC_BOARD_POP.getObj("form_board")).addClass('maxRow');
    }
    
    $m.hide($m.EFC_BOARD_POP.getObj("btn_update"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_reply"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_del"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_del_admin"));
    $m.show($m.EFC_BOARD_POP.getObj("btn_reply_del_admin"));

    $m.hide($m.EFC_BOARD_POP.getObj("btn_reply_save"));
    $m.hide($m.EFC_BOARD_POP.getObj('grd_reply_file_btn_fold'));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_receipt"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_success"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_reject"));

    //$($m.EFC_BOARD_POP.getObj('colPhone')).attr('style','display:none');
    //$($m.EFC_BOARD_POP.getObj('colEmail')).attr('style','display:none');	
    $m.EFC_BOARD_POP._boardIdx = $m.getCellData(_grd,rowIndex,'BOARD_IDX');
    $m.EFC_BOARD_POP.exe({
		url : $m._domain+$m._contextRoot+"/EFC_BOARD/selectBoardInfo.do",
		loadingbar:true,
		data : {
			"header" : $m.header,
			"body" : {
				"BOARD_IDX":$m.EFC_BOARD_POP._boardIdx,
				"BOARD_TYPE":$m.EFC_BOARD_POP._boardType
				}
		},
		callback : function(response){
				if(response.selectBoardInfo != null ){
				var data = response.selectBoardInfo;
				//CKEDITOR.instances.reply_editor.setData(data.BOARD_CONT);
				$('.edit').find('iframe').contents()[1].body.innerHTML = $m.resizeContsImg(data.BOARD_CONT); 
				
				$m.setValue($m.EFC_BOARD_POP.getObj("wreplytitle"),data.BOARD_TITLE);
				$m.setValue($m.EFC_BOARD_POP.getObj("wreplydate"),data.BOARD_DATE);
				$m.setValue($m.EFC_BOARD_POP.getObj("wreplyid"),data.BOARD_WRITER);
				$m.setValue($m.EFC_BOARD_POP.getObj("wreplyidx"),data.BOARD_IDX);
				$m.setValue($m.EFC_BOARD_POP.getObj("wboardreplyinfo"),data.BOARD_IDX+" / "+data.BOARD_DATE+" / "+data.BOARD_WRITER);
				
				$m.hide($m.EFC_BOARD_POP.getObj("btn_save"));
				$m.hide($m.EFC_BOARD_POP.getObj("btn_add"));
			    if($m.getValue($m.EFC_BOARD_POP.getObj("wid")) != $m.getSs("USER_ID") && $m.getSs("authorCode") != "ROLE_SUPER_ADMIN"){
			    	$m.hide($m.EFC_BOARD_POP.getObj("btn_update"));
			    	$m.hide($m.EFC_BOARD_POP.getObj("btn_del"));
			    }
			    if(($m.getValue($m.EFC_BOARD_POP.getObj("wreplyid")) == $m.getSs("USER_ID"))){
			    	$m.show($m.EFC_BOARD_POP.getObj("btn_reply_update"));
			    }else{
			    	$m.hide($m.EFC_BOARD_POP.getObj("btn_reply_update"));
			    }
			    $m.EFC_BOARD_POP.drawGrid('grd_reply_file',$m.getResList(response,"selectBoardFileList"));
			}else{
				$m.error(response.error);
			}
		}
	});
};
var aaa = function(e){
	if($(e).prev().prop('tagName') == 'IMG'){
		$(e).prev().remove();
	}
	$(e).removeClass("hide");
}
$m.EFC_BOARD_POP.fn_search = function(_grd,_idx,tdObj,_thisObj){
	debugger;
	if($m.EFC_BOARD_POP._boardIdx != null){
		$m.EFC_BOARD_POP._boardStatus = "R";
		$m.hide($($m.EFC_BOARD_POP.getObj("cke_editor")).find('.cke_top'));
		$m.EFC_BOARD_POP.exe({
				url : $m._domain+$m._contextRoot+"/EFC_BOARD/selectBoardInfo.do",
				loadingbar:true,
				data : {
					"header" : $m.header,
					"body" : {
						"BOARD_IDX":$m.EFC_BOARD_POP._boardIdx,
						"BOARD_TYPE":$m.EFC_BOARD_POP._boardType
						}
				},			
				callback : function(response){
						if(response.selectBoardInfo != null ){
						var data = response.selectBoardInfo;
						
						if(window['viewMode'] != 'contentOnly'){
							$m.show($m.EFC_BOARD_POP.getObj('edit_zoomBtn'));
						}
						//CKEDITOR.instances.editor.setData($m.resizeContsImg(data.BOARD_CONT));
						
var _ct = data.BOARD_CONT;
_ct = _ct.replace(/<img [^>]*?id=\"{0,1}imageLoadingBar\"{0,1}[^>]*?\/>/g,"");

/*
_ct = _ct.replace(/<img src=\/images\/mobile\/loading\.gif width=80 height=80 id=imageLoadingBar border=0  \/>/g,"");
_ct = _ct.replace(/(<img\s*[^>]*?)(onload="parent\.aaa\(this\);")([^>]*?\/>)/g,'$1$3');
//_ct = _ct.replace(/(<img\s*[^>]*?)(style="display:none")([^>]*?\/>)/g,'$1$3');
_ct = _ct.replace(/<img /g,'<img src=/images/mobile/loading.gif width=80 height=80 id=imageLoadingBar border=0  /><img class="hide" onload="parent.aaa(this);" ');
*/
_ct = _ct.replace(/<img /g,'<img src=/images/mobile/loading.gif width=80 height=80 id=imageLoadingBar border=0  /><img class="hide" onload="parent.aaa(this);" ');  
						$('.edit').find('iframe').contents()[0].body.innerHTML = $m.resizeContsImg(_ct); 
						
						
						/*
						var imgUrl = $('img[src^="https://drive.google.com"]',$('.edit').find('iframe').contents()[0]).attr('src');
						var img2 = new Image();
						img2.src = imgUrl;
						img2.onload = function() {
						    console.log("Image 1 ready to append");
						    alert('load');
						};
						*/
						/*
						$('img[src^="https://drive.google.com"]',$('.edit').find('iframe').contents()[0])[0].onload =function() {
						    console.log("Image2 ready to append");
						    alert('load2');
						};
						*/
						
						
						
						$m.show($($m.EFC_BOARD_POP.getObj('form_board')).find('.rta'));
						$m.hide($($m.EFC_BOARD_POP.getObj("cke_editor")).find("[id$='_top']"));
						
						if($m.getDevice() == 'mobile' && $m.trim(data.BOARD_PHONE) != ''){
							$m.show($m.EFC_BOARD_POP.getObj('tr_phone'));
						}
						if($m.getDevice() == 'mobile' && $m.trim(data.BOARD_PHONE) != ''){
							$m.show($m.EFC_BOARD_POP.getObj('tr_phone'));
						}
						if($m.getDevice() == 'mobile' && $m.trim(data.BOARD_COMPLETER) != ''){
							$m.show($m.EFC_BOARD_POP.getObj('tr_completeid'));
						}
						
						
						$m.setValue($m.EFC_BOARD_POP.getObj("wphone"),data.BOARD_PHONE);
						$m.setValue($m.EFC_BOARD_POP.getObj("cmb_board"),data.BOARD_SUPPORT);
						$m.setValue($m.EFC_BOARD_POP.getObj("wtitle"),data.BOARD_TITLE);
						$m.setValue($m.EFC_BOARD_POP.getObj("wdate"),data.BOARD_DATE);
						$m.setValue($m.EFC_BOARD_POP.getObj("wid"),data.BOARD_WRITER);
						$m.setValue($m.EFC_BOARD_POP.getObj("widx"),data.BOARD_IDX);
						$m.setValue($m.EFC_BOARD_POP.getObj("wemail"),data.BOARD_EMAIL);
						$m.setValue($m.EFC_BOARD_POP.getObj("wreceiptid"),data.BOARD_RECEIPTIONER);
						$m.setValue($m.EFC_BOARD_POP.getObj("wcompleteid"),data.BOARD_COMPLETER);
						$m.hide($m.EFC_BOARD_POP.getObj("btn_save"));
						$m.hide($m.EFC_BOARD_POP.getObj("btn_add"));
						$m.show($m.EFC_BOARD_POP.getObj('grd_file_btn_fold'));
						$m.setValue($m.EFC_BOARD_POP.getObj("wboardinfo"),"["+$m.getValue($m.EFC_BOARD_POP.getObj("cmb_board"))+"] "+data.BOARD_IDX+" / "+data.BOARD_DATE+" / "+data.BOARD_WRITER);
						
					    if($m.getSs("loginTemp0") != null && $m.getValue($m.EFC_BOARD_POP.getObj("wid")) != $m.getSs("loginTemp0").name || $m.getValue($m.EFC_BOARD_POP.getObj("wid")) != $m.getSs("USER_ID") && $m.getSs("authorCode") != "ROLE_SUPER_ADMIN"){
					    	$m.hide($m.EFC_BOARD_POP.getObj("btn_del"));
					    }
					    if($m.getValue($m.EFC_BOARD_POP.getObj("wid")) == $m.getSs("USER_ID")){
					    	$m.show($m.EFC_BOARD_POP.getObj('btn_update'));
					    }
				    	if($m.getSearchCombo('cmb_board').value == "N" && $m.getSs("authorCode") == "ROLE_SUPER_ADMIN"){
				    		$m.show($m.EFC_BOARD_POP.getObj("btn_receipt"));
					    }
					    if($m.EFC_BOARD_POP._pageType == 'home'){
					    	$m.hide($m.EFC_BOARD_POP.getObj("btn_update"));
				        	$m.hide($m.EFC_BOARD_POP.getObj("btn_del"));
				        	$m.hide($m.EFC_BOARD_POP.getObj("btn_save"));
				        	$m.hide($m.EFC_BOARD_POP.getObj("btn_del_admin"));
				        	//$m.hide($($m.EFC_BOARD_POP.getObj("form_board")).find(".moca_addtion_area"));
				        }
					    if($m.getResList(response,"selectBoardFileList").length > 0){
					    	$m._foldGrid($m.EFC_BOARD_POP.getObj('grd_file_btn_fold'));
					    }
					    $m.EFC_BOARD_POP.drawGrid('grd_file',$m.getResList(response,"selectBoardFileList"));
					}else{
						$m.error(response.error);
					}
				}
			});
	}else{
		$m.EFC_BOARD_POP._boardStatus = "C";
		$m.setValue($m.EFC_BOARD_POP.getObj("cmb_board"),"N");
		var _writter;
		if($m.getSs("loginTemp0") != null && $m.getSs("loginTemp0") != ''){
			_writter = $m.getSs("loginTemp0").name;
		}
		if($m.getSs("USER_ID") != null){
			_writter = $m.getSs("USER_ID");
		}
		$m.setValue($m.EFC_BOARD_POP.getObj("wid"),_writter);
		$m.setValue($m.EFC_BOARD_POP.getObj("wdate"),dateLib.getToday());
		$m.hide($m.EFC_BOARD_POP.getObj("btn_update"));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_del"));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_reply"));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_del_admin"));
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("cmb_board"),false);
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("wtitle"),false);
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("wphone"),false);
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("wemail"),false);
	}
	
	if($m.getSs("authorCode") != "ROLE_SUPER_ADMIN"){
    	$m.hide($m.EFC_BOARD_POP.getObj("btn_del_admin"));
    	$m.hide($m.EFC_BOARD_POP.getObj("btn_reply_del_admin"));
    }
};

$m.EFC_BOARD_POP.fn_update = function(_thisObj){
	$m.hide($m.EFC_BOARD_POP.getObj('edit_zoomBtn'));
	$m.hide($m.EFC_BOARD_POP.getObj("btn_del_admin"));
	$m.hide($m.EFC_BOARD_POP.getObj("btn_reply_del_admin"));
	if(_thisObj.id != 'btn_reply_update'){ //수정버튼
		$m.EFC_BOARD_POP._boardStatus = "U";
		$($m.EFC_BOARD_POP.getObj("cke_editor")).find("[id$='_top']").show();
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("wtitle"),false);
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("cmb_board"),false);
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("wphone"),false);
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("wemail"),false);
		$m.setValue($m.EFC_BOARD_POP.getObj("wid"),$m.getSs("USER_ID"));
		$m.EFC_BOARD_POP.editor.setReadOnly(false);
		$m.hide($m.EFC_BOARD_POP.getObj("btn_update"));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_del"));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_reply"));
		$m.show($m.EFC_BOARD_POP.getObj("btn_save"));

		//자동저장시작
		$m.EFC_BOARD_POP.timeoutValue = setInterval(function(){ 
    		//게시글수정
    		console.log('save start',new Date());
   		 	$m.EFC_BOARD_POP.exe({
                url : $m._domain+$m._contextRoot+"/EFC_BOARD/updateBoardAuto.do",
                loadingbar:false,
                data : {
                    "header" : $m.header,
                    "body" : {
                   	 "BOARD_TYPE":$m.EFC_BOARD_POP._boardType,
                   	 "BOARD_SUPPORT":$m.EFC_BOARD_POP.getSearchCombo('cmb_board').value,
                        "BOARD_IDX":$m.getValue($m.EFC_BOARD_POP.getObj('widx')),
                        "BOARD_PIDX":$m.EFC_BOARD_POP._boardPIdx,
                        "BOARD_TITLE":$m.getValue($m.EFC_BOARD_POP.getObj("wtitle")),
                        "BOARD_CONT":CKEDITOR.instances.editor.getData(),
                        "BOARD_WRITER":$m.getSs("USER_ID"),
                        "BOARD_PHONE":$m.getValue($m.EFC_BOARD_POP.getObj("wphone")),
                         "BOARD_EMAIL":$m.getValue($m.EFC_BOARD_POP.getObj("wemail")),
                        "fileList":$m.EFC_BOARD_POP.getFilteredList("grd_file","status","C")
                        }
                },          
                callback : function(response){
               	 	if(response.cnt > 0){
               			//console.log('autosave',new Date());
               			var autoDt = new Date();
               			var autoLog = autoDt.getHours()+':'+autoDt.getMinutes()+":"+autoDt.getSeconds()+" auto saved.";
               			var logArea = $($m.EFC_BOARD_POP.getObj("button_btn_save")).closest('.moca_addtion_area').find('.lta');
               			var logChk = logArea.html();
               			if(logChk == ''){
               				logArea.html(autoLog);
               			}else{
               				logArea.html('');
               			}
               			
                    }else{
                    	console.log('autosave',response);
                    }
                } 
            });
			
		},5000);

		$m.show($m.EFC_BOARD_POP.getObj('grd_file_btn_fold'));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_del_admin"));
		$m.show($m.EFC_BOARD_POP.getObj('tr_phone'));
		$m.show($m.EFC_BOARD_POP.getObj('tr_email'));
		$m.show($m.EFC_BOARD_POP.getObj('tr_completeid'));
	}else{ //답변수정
		$m.EFC_BOARD_POP._boardReplyStatus = "U";
		$m.setReadOnly($m.EFC_BOARD_POP.getObj("wreplytitle"),false);
		$($m.EFC_BOARD_POP.getObj("cke_reply_editor")).find("[id$='_top']").show();
		$m.setValue($m.EFC_BOARD_POP.getObj("wreplyid"),$m.getSs("USER_ID"));
		$m.EFC_BOARD_POP.editor.setReadOnly(false);
		$m.hide($m.EFC_BOARD_POP.getObj("btn_reply_update"));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_reply_del"));
		$m.hide($m.EFC_BOARD_POP.getObj("btn_reply_del_admin"));
		
		$m.hide($m.EFC_BOARD_POP.getObj("btn_reply"));
		$m.show($m.EFC_BOARD_POP.getObj("btn_reply_save"));
		$m.show($m.EFC_BOARD_POP.getObj('grd_reply_file_btn_fold'));
		//답변 작성자가 관리자본인이면서 담당자 배정이 되어있지 않을때
		if(	$m.getSs("authorCode") == "ROLE_SUPER_ADMIN" && ($m.getValue($m.EFC_BOARD_POP.getObj("wreceiptid")) == "" || $m.getValue($m.EFC_BOARD_POP.getObj("wreceiptid")) == $m.getSs("USER_ID"))    
		){
			if($m.getSearchCombo('cmb_board').value == "N" && $m.getSs("authorCode") == "ROLE_SUPER_ADMIN"){
		    	$m.show($m.EFC_BOARD_POP.getObj("btn_receipt"));
		    }
	    	$m.show($m.EFC_BOARD_POP.getObj("btn_success"));
	    	$m.show($m.EFC_BOARD_POP.getObj("btn_reject"));
		}
	}
}
$m.EFC_BOARD_POP.fn_replyCnt = function(_thisObj,_message){
	 $m.EFC_BOARD_POP.exe({
         url : $m._domain+$m._contextRoot+"/EFC_BOARD/updateReplyCnt.do",
         loadingbar:true,
         data : {
             "header" : $m.header,
             "body" : {
             	"BOARD_IDX":$m.EFC_BOARD_POP._boardPIdx,
             	"BOARD_REPLYSTATUS":$m.EFC_BOARD_POP._boardReplyStatus,
             	"BOARD_TYPE":$m.EFC_BOARD_POP._boardType
                 }
         },          
         callback : function(response){
             if(response.cnt > 0){
            	 $m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:_message});
             }
         }
     });
	
}

//자동저장
$m.EFC_BOARD_POP.fn_save = function(_thisObj){
	if(_thisObj.id == 'btn_save'){
		$m.confirm('저장하시겠습니까?',function(result){
	        if(result == 'Y'){
	        	
	        	if($m.EFC_BOARD_POP != null){
	        		console.log('clearInterval'); 
	        		clearInterval($m.EFC_BOARD_POP.timeoutValue);
	        	}
	        	
	            for(var i=0; i<$m.EFC_BOARD_POP.getObj("grd_file").list.length;i++){
	            	if($m.EFC_BOARD_POP.getObj("grd_file").list[i]._system.status != "D"){
	            		$m.EFC_BOARD_POP.getObj("grd_file").list[i]._system.status = "C";
	            	}
	            };
	            
	            if($m.EFC_BOARD_POP._boardIdx == null){
	            	
	            	var wtitle = $m.getValue($m.EFC_BOARD_POP.getObj("wtitle"));
	            	if(wtitle == ''){
	            		wtitle = $('#'+CKEDITOR.instances.editor.id+'_contents iframe').contents().find('body').text().substring(0,40);
	            	}
	            	
	                //게시물등록
	                $m.EFC_BOARD_POP.exe({
	                    url : $m._domain+$m._contextRoot+"/EFC_BOARD/insertBoard.do",
	                    loadingbar:true,
	                    data : {
	                        "header" : $m.header,
	                        "body" : {
	                        	"BOARD_TYPE":$m.EFC_BOARD_POP._boardType, 
	                        	"BOARD_DELYN":'N',
	                        	"BOARD_SUPPORT":$m.EFC_BOARD_POP.getSearchCombo('cmb_board').value,
	                        	"BOARD_TYPE":$m.EFC_BOARD_POP._boardType,
	                            "BOARD_TITLE":wtitle,
	                            "BOARD_CONT":CKEDITOR.instances.editor.getData(),
	                            "GET_CONT_TXT":CKEDITOR.instances.editor.document.getBody().getHtml(),
	                            "BOARD_WRITER":$m.getValue($m.EFC_BOARD_POP.getObj("wid")),
	                            "BOARD_PHONE":$m.getValue($m.EFC_BOARD_POP.getObj("wphone")),
	                            "BOARD_EMAIL":$m.getValue($m.EFC_BOARD_POP.getObj("wemail")),
	                            "fileList":$m.EFC_BOARD_POP.getFilteredList("grd_file","status","C"),
	                            "CORP_CD":$m.getSs("CORP_CD"),
	                            "CORP_NM":$m.getSs("CORP_NM"),
	                            }
	                    },          
	                    callback : function(response){
	                        if(response.cnt > 0){
	                            $m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:"성공적으로 저장하였습니다."});
	                        }
	                    }
	                });
	            }else{
            		//게시글수정
            		 $m.EFC_BOARD_POP.exe({
                         url : $m._domain+$m._contextRoot+"/EFC_BOARD/updateBoard.do",
                         loadingbar:true,
                         data : {
                             "header" : $m.header,
                             "body" : {
                            	 "BOARD_TYPE":$m.EFC_BOARD_POP._boardType,
                            	 "BOARD_SUPPORT":$m.EFC_BOARD_POP.getSearchCombo('cmb_board').value,
                                 "BOARD_IDX":$m.getValue($m.EFC_BOARD_POP.getObj('widx')),
                                 "BOARD_PIDX":$m.EFC_BOARD_POP._boardPIdx,
                                 "BOARD_TITLE":$m.getValue($m.EFC_BOARD_POP.getObj("wtitle")),
                                 "BOARD_CONT":CKEDITOR.instances.editor.getData(),
                                 "BOARD_WRITER":$m.getSs("USER_ID"),
                                 "BOARD_PHONE":$m.getValue($m.EFC_BOARD_POP.getObj("wphone")),
 	                             "BOARD_EMAIL":$m.getValue($m.EFC_BOARD_POP.getObj("wemail")),
                                 "fileList":$m.EFC_BOARD_POP.getFilteredList("grd_file","status","C")
                                 }
                         },          
                         callback : function(response){
                        	 if(response.cnt > 0){
 	                            $m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:"성공적으로 저장하였습니다."});
 	                        }
                         }
                     });
	            }
	        }
	    });
	}else{
		//답변저장
		$m.confirm('답변을 저장하시겠습니까?',function(result){
	        if(result == 'Y'){
	        	
	            var _ReplyIdx = $m.getValue($m.EFC_BOARD_POP.getObj("wreplyidx"));
	            for(var i=0; i<grd_reply_file.list.length;i++){
	            	if(grd_reply_file.list[i]._system.status != "D"){
	            		grd_reply_file.list[i]._system.status = "C";
	            	}
	            };
	            
	            var wtitle = $m.getValue($m.EFC_BOARD_POP.getObj("wreplytitle"));
            	if(wtitle == ''){
            		wtitle = $('#'+CKEDITOR.instances.reply_editor.id+'_contents iframe').contents().find('body').text().substring(0,40);
            	}
            	
	            if(_ReplyIdx == null || _ReplyIdx == ""){
	    			//답변등록
	        		$m.EFC_BOARD_POP.exe({
	                    url : $m._domain+$m._contextRoot+"/EFC_BOARD/insertBoard.do",
	                    loadingbar:true,
	                    data : {
	                        "header" : $m.header,
	                        "body" : {
	                        	"BOARD_DELYN":'N',
	                        	"BOARD_SUPPORT":$m.EFC_BOARD_POP.getSearchCombo('cmb_board').value,
	                        	"BOARD_TYPE":$m.EFC_BOARD_POP._boardType,
	                        	"BOARD_PIDX":$m.EFC_BOARD_POP._boardIdx,
	                            "BOARD_TITLE":wtitle,
	                            "BOARD_CONT":CKEDITOR.instances.reply_editor.getData(),
	                            "GET_CONT_TXT":CKEDITOR.instances.reply_editor.document.getBody().getText(),
	                            "BOARD_WRITER":$m.getValue($m.EFC_BOARD_POP.getObj("wreplyid")),
	                            "fileList":$m.EFC_BOARD_POP.getFilteredList("grd_reply_file","status","C"),
	                            "CORP_CD":$m.getSs("CORP_CD"),
	                            "CORP_NM":$m.getSs("CORP_NM")
	                            }
	                    },          
	                    callback : function(response){
	                    	if(response.cnt > 0){
	                    		$m.EFC_BOARD_POP._boardReplyStatus = "C";
	                    		$m.EFC_BOARD_POP.fn_replyCnt(null,"성공적으로 저장하였습니다.");
	                         }
	                    }
	                });
	        	}else{
	        		//답변수정
	        		$m.EFC_BOARD_POP._boardReplyStatus = "U";
	        		 $m.EFC_BOARD_POP.exe({
	                     url : $m._domain+$m._contextRoot+"/EFC_BOARD/updateBoard.do",
	                     loadingbar:true,
	                     data : {
	                         "header" : $m.header,
	                         "body" : {
	                        	 "BOARD_SUPPORT":$m.EFC_BOARD_POP.getSearchCombo('cmb_board').value,
	                        	 "BOARD_TYPE":$m.EFC_BOARD_POP._boardType,
	                        	 "BOARD_PIDX":$m.EFC_BOARD_POP._boardPIdx,
	                         	 "BOARD_IDX":$m.EFC_BOARD_POP._boardIdx,
	                             "BOARD_TITLE":$m.getValue($m.EFC_BOARD_POP.getObj("wreplytitle")),
	                             "BOARD_CONT":CKEDITOR.instances.reply_editor.getData(),
	                             "BOARD_WRITER":$m.getSs("USER_ID"),
	                             "fileList":$m.EFC_BOARD_POP.getFilteredList("grd_reply_file","status","C")
	                             }
	                     },          
	                     callback : function(response){
	                         if(response.cnt > 0){
	                             $m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:"성공적으로 저장하였습니다."});
	                         }
	                     }
	                 });
	        	}
	        }
	    });
		
	}
    
};
$m.EFC_BOARD_POP.fn_adminDel = function(_thisObj){
	['게시글물리삭제 관리자삭제']
	if(_thisObj.id == 'btn_del_admin'){
		_msg = '삭제하시면 데이터를 더이상 복구하실 수 없습니다.<br/>또한 원글을 삭제하실경우 답글까지도 삭제됩니다.<br/>그래도 삭제하시겠습니까?';
	}else{
		_msg = '삭제하시면 데이터를 더이상 복구하실 수 없습니다.<br/>그래도 삭제하시겠습니까?';
	}
	var _idx;
	var _pid;
	if($m.EFC_BOARD_POP._boardIdx == $m.EFC_BOARD_POP._boardPIdx){ //원글
		_idx = $m.EFC_BOARD_POP._boardPIdx;
		_pid = $m.EFC_BOARD_POP._boardPIdx;
	}else{
		_idx = $m.EFC_BOARD_POP._boardIdx;
	}
	$m.confirm(_msg,function(result){
        if(result == 'Y'){
            //삭제
            $m.EFC_BOARD_POP.exe({
                url : $m._domain+$m._contextRoot+"/EFC_BOARD/deleteBoard.do",
                loadingbar:true,
                data : {
                    "header" : $m.header,
                    "body" : {
                    	"BOARD_IDX":_idx,
                        "BOARD_PIDX":_pid,
                        "BOARD_TYPE":$m.EFC_BOARD_POP._boardType
                        }
                },          
                callback : function(response){
                    if(response.cnt > 0){
                        if($m.EFC_BOARD_POP._boardIdx != $m.EFC_BOARD_POP._boardPIdx){ //답글삭제
                        	$m.EFC_BOARD_POP._boardReplyStatus = "D";
                            $m.EFC_BOARD_POP.fn_replyCnt();
                            $m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:"삭제가 완료되었습니다."});
                        }else{//원글삭제
                        	$m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:"삭제가 완료되었습니다."});
                        }
                    }
                }
            });
        }
    });
};
$m.EFC_BOARD_POP.fn_del = function(_thisObj){
	['게시글논리삭제 delYN :Y']
	var _idx;
	var _pid;
	
	if(_thisObj.id == 'btn_del'){
		_msg = '원글을 삭제하실경우 답글까지도 삭제됩니다.<br/>삭제하시겠습니까?';
	}else{
		_msg = '삭제하시겠습니까?';
	}
	if($m.EFC_BOARD_POP._boardIdx == $m.EFC_BOARD_POP._boardPIdx){ //원글
		_idx = $m.EFC_BOARD_POP._boardPIdx;
		_pid = $m.EFC_BOARD_POP._boardPIdx;
	}else{
		_idx = $m.EFC_BOARD_POP._boardIdx;
	}
	 $m.confirm(_msg,function(result){
        if(result == 'Y'){
        	//게시글삭제
         	$m.EFC_BOARD_POP.exe({
                 url : $m._domain+$m._contextRoot+"/EFC_BOARD/deleteStatusBoard.do",
                 loadingbar:true,
                 data : {
                     "header" : $m.header,
                     "body" : {
                         "BOARD_IDX":_idx,
                         "BOARD_PIDX":_pid,
                         "BOARD_TYPE":$m.EFC_BOARD_POP._boardType
                         }
                 },          
                 callback : function(response){
                     if(response.cnt > 0){
                    	 
                     	if($m.EFC_BOARD_POP._boardIdx != $m.EFC_BOARD_POP._boardPIdx){ //답글삭제
                        	$m.EFC_BOARD_POP._boardReplyStatus = "D";
                            $m.EFC_BOARD_POP.fn_replyCnt();
                        }else{//원글삭제
                        	$m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:"삭제가 완료되었습니다."});
                            
                        }
                     }
                 }
             });
        }
	 });
};
$m.EFC_BOARD_POP.fn_searchfile = function(_grd,_idx,tdObj,_thisObj){
    if($m.EFC_BOARD_POP._boardIdx != null){
        $m.EFC_BOARD_POP.exe({
            url : $m._domain+$m._contextRoot+"/EFC_BOARD/selectBoardFileList.do",
            loadingbar:false,
            data : {
                "header" : $m.header,
                "body" : {
                    "BOARD_IDX":$m.EFC_BOARD_POP._boardIdx,
                    "BOARD_TYPE":$m.EFC_BOARD_POP._boardType
                    }
            },          
            callback : function(response){
            	$m.EFC_BOARD_POP.drawGrid('grd_file',$m.getResList(response,"selectBoardFileList"));
            }
        });
    }
};
$m.EFC_BOARD_POP._openFileUpload = function(_thisObj) {
	 var o = {};
	 	o.url = '/moca/comp/COMP_UPLD.html';
	 	//o.id = "COMP_UPLD";
	    o.type = "POPUP";
	    o.modal = "false";
	    o.title = '파일업로드';
	    o.callback = function(result){
	    	if(result != null){
	    		//업로드완료후 리턴업로드된파일정보를 받아서
	            //이후 파일관련테이블에 insert하는 로직을 추가한다.
	            var fileSize = result.fileSize;
	            var fileLength = result.fileLength;
	            var originalFilename = result.originalFilename;
	            var physicalFilename = result.physicalFilename;
	            var physicalFilepath = result.physicalFilepath;
	            var subDir = result.subDir;
	            var uploadDir = result.uploadDir;
	            if(_thisObj.id == "btn_add"){
	            	
	            	 var arr = $m.EFC_BOARD_POP.getObj("grd_file").list;
	            }else{
	            	 var arr = $m.EFC_BOARD_POP.getObj("grd_reply_file").list;
	            }
	            var row = {BOARDFILE_NAME:originalFilename,BOARDFILE_SIZE:fileSize,BOARDFILE_NAMESERVER:physicalFilename,BOARDFILE_PATH:physicalFilepath,BOARDFILE_ID:result.id}; 
	            row._system = {"status":""};
	            var sn = arr.length;
	            arr[sn] =  row;
	            if(_thisObj.id == "btn_add"){
	            	$m.EFC_BOARD_POP.drawGrid('grd_file',arr);
	            }else{
	            	$m.EFC_BOARD_POP.drawGrid('grd_reply_file',arr);
	            }
	            
	            //grd_file.list[sn]._system.status = "C";
	    	}
        },
	    o.scopeId = $m.EFC_BOARD_POP.pageId;
	    o.data = {
	    		subDir:"EFC_BOARD_POP",
	            onFileSelected:"$m.EFC_BOARD_POP.onFileSelected"
	    };
	    $m.popup(o,_thisObj);
};

$m.EFC_BOARD_POP.showFileURL = function(_grd,rowIndex,colIndex,colId){
	var _list;
	if(_grd.id != 'grd_reply_file'){
		_list = $m.EFC_BOARD_POP.getObj('grd_file').list;
	}else{
		_list = $m.EFC_BOARD_POP.getObj('grd_reply_file').list;
	}
	var id = _list[rowIndex].BOARDFILE_ID;
	var _html = $(_grd).find('.grid_total').html();
	_html =_html.replace(/\[.*?\]/g,'');

	if($('.file_link').is(':visible')){
		_html = _html.replace(/\<em class="file_link".*$/g,'');
	}
	_html = _html+"<em class='file_link' onclick='$m.EFC_BOARD_POP.fn_copy(this)'>";
	_html = _html +"[&nbsp;https://drive.google.com/uc?id="+ id+"&nbsp;]";
	_html = _html + "</em>";	
	
	$(_grd).find('.grid_total').html(_html);
};

$m.EFC_BOARD_POP.fn_copy = function(_this){
	var _text = $(_this).text().replace(/\[|\]|' '/g,'').trim();
	var _clipboard = $('#input_clipboard');
	_clipboard.val(_text);
	_clipboard[0].focus();
	_clipboard[0].select();
	document.execCommand("copy");
	$m.alert('클립보드에 복사되었습니다');
}

$m.EFC_BOARD_POP.grd_fileDownload = function(_grd,rowIndex,colIndex,colId){
	$m.EFC_BOARD_POP.grd_fileDownload_google(_grd,rowIndex,colIndex,colId);
};
$m.EFC_BOARD_POP.grd_fileDownload_teammoca = function(_grd,rowIndex,colIndex,colId){
	if(_grd.id != 'grd_reply_file'){
		var _list = $m.EFC_BOARD_POP.getObj('grd_file').list;
	}else{
		var _list = $m.EFC_BOARD_POP.getObj('grd_reply_file').list;
	}
    $m.fileDownloadAjax({
        url:$m._contextRoot+"/moca/fileDownload.do",
        param:{originalFilename:_list[rowIndex]["BOARDFILE_NAME"],physicalFilename:_list[rowIndex]["BOARDFILE_NAMESERVER"],subDir:$m.EFC_BOARD_POP.srcId}
    });
};


$m.EFC_BOARD_POP.grd_fileDownload_google = async function(_grd,rowIndex,colIndex,colId){
	if(_grd.id != 'grd_reply_file'){
		var _list = $m.EFC_BOARD_POP.getObj('grd_file').list;
	}else{
		var _list = $m.EFC_BOARD_POP.getObj('grd_reply_file').list;
	}
	var id = _list[rowIndex].BOARDFILE_ID;
      try {
      	  await gapi.client.load('drive','v3');
	      const request = gapi.client.drive.files.get({
		      fileId: id,
		      fields: 'webContentLink,id,name'
	      });
		  //console.log("--->",request);
	      request.execute(function (resp) {
	    	  //console.log("2--->",resp);
		      if (resp.webContentLink) {
		      	window.location.assign(resp.webContentLink);
		      } else {
		      	var formattedJson = JSON.stringify(resp.result, null, 2);
		      }
	      });

      } catch (e) {
      	console.log('Error getting files', e);
      }
    
};



$m.EFC_BOARD_POP.onFileSelected = function(filename,filesize,_e,_this) {
    //filename이나 filesize를 활용하여 업로드여부를 체크할수있다.
    
    return true;//or false
};
$m.EFC_BOARD_POP.popId = "EFC_BOARD_ANS_POP";
$m.EFC_BOARD_POP.fn_reply = function(_thisObj){
    ['답변달기']
    if($m.getDevice() != 'pc'){
     $('.mShow.reply').hide();
   	 $m.hide($($m.EFC_BOARD_POP.getObj("form_board")).find(".moca_addtion_area"));
   	 $($m.EFC_BOARD_POP.getObj("form_board")).addClass('maxRow');
   }
    $m.EFC_BOARD_POP._boardReplyStatus = "C";
    $($m.EFC_BOARD_POP.getObj("cke_editor")).find('#cke_1_top').hide();
    $m.setReadOnly($m.EFC_BOARD_POP.getObj("wreplytitle"),false);
    $($m.EFC_BOARD_POP.getObj("reply_area")).show();
    $m.hide($m.EFC_BOARD_POP.getObj("btn_reply"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_update"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_reply_update"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_del"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_reply_del"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_del_admin"));
    $m.hide($m.EFC_BOARD_POP.getObj("btn_reply_del_admin"));
    $m.hide($m.EFC_BOARD_POP.getObj("tr_replyidx"))
    $m.hide($m.EFC_BOARD_POP.getObj("tr_createDt"));
    $m.hide($m.EFC_BOARD_POP.getObj("tr_writer"));
    //$($m.EFC_BOARD_POP.getObj('colPhone')).attr('style','display:none');
    //$($m.EFC_BOARD_POP.getObj('colEmail')).attr('style','display:none');
    $m.setValue($m.EFC_BOARD_POP.getObj("wreplyid"),$m.getSs("USER_ID"));
    if(
    		//접수자 null 아니면서 접수자가 세션아이디랑 다를때 
    		//접수자가 null이 아니면서 관리자가 아닐때
    	($m.getSs("authorCode") != "ROLE_SUPER_ADMIN")	
    ){
    		$m.hide($m.EFC_BOARD_POP.getObj("btn_receipt"));
        	$m.hide($m.EFC_BOARD_POP.getObj("btn_success"));
        	$m.hide($m.EFC_BOARD_POP.getObj("btn_reject"));
	}
};

$m.EFC_BOARD_POP._boardSupport ;
$m.EFC_BOARD_POP.fn_status = function(_thisObj){
	var _completeid;
	var _receiptid = $m.getValue($m.EFC_BOARD_POP.getObj('wreceiptid')) != ""?$m.getValue($m.EFC_BOARD_POP.getObj('wreceiptid')):$m.getSs("USER_ID");
	if(_thisObj.innerText == "접수"){
		$m.EFC_BOARD_POP._boardSupport = "R";
		_receiptid = $m.getSs("USER_ID");
	}else if(_thisObj.innerText == "완료"){
		$m.EFC_BOARD_POP._boardSupport = "Y";
		_completeid = $m.getSs("USER_ID");
	}else if(_thisObj.innerText == "반려"){
		$m.EFC_BOARD_POP._boardSupport = "B";
	}
	$m.confirm(_thisObj.innerText+'하시겠습니까?',function(result){
        if(result == 'Y'){
        	$m.EFC_BOARD_POP.exe({
        		url : $m._domain+$m._contextRoot+"/EFC_BOARD/receiptBoard.do",
        		loadingbar:true,
        		data : {
        			"header" : $m.header,
        			"body" : {
        				"BOARD_SUPPORT":$m.EFC_BOARD_POP._boardSupport,
        				"BOARD_IDX":$m.EFC_BOARD_POP._boardPIdx,
        				"BOARD_RECEIPTIONER":_receiptid,
        				"BOARD_COMPLETER": _completeid,
        				"BOARD_WRITERPHONE": $m.getValue($m.EFC_BOARD_POP.getObj('wphone')),
        				"BOARD_WRITER":$m.getValue($m.EFC_BOARD_POP.getObj('wid')),
        				"BOARD_CONT":CKEDITOR.instances.editor.getData(),
        				"BOARD_TYPE":$m.EFC_BOARD_POP._boardType
        				}
        		},			
        		callback : function(response){
        			if(response.cnt > 0){
                        $m.popClose($m.EFC_BOARD_POP.pageId,{callback:"true",message:_thisObj.innerText+'되었습니다.'});
                    }else{
                    	$m.error(response.error);
                    }
        		}
        	});
        	
        }
	});
};

$m.EFC_BOARD_POP.dispCnt= function(_thisVal){
	if(_thisVal !=null && _thisVal != 0){
		return _thisVal;
	}else{
		_thisVal = '';
		return _thisVal;
	}
};

$m.EFC_BOARD_POP.grd_btnShowHide = function(_foldBtnObj,_grdObj){
	//해당 버튼,그리드
    var g_jq = _grdObj;
    var b_jq = _foldBtnObj;
    var g_id = g_jq.attr('id');
    var idx;
    var attachBtnId;
    var boardStatus;
    
    if(g_id == 'grd_file'){//원글첨부파일
    	idx = $m.trim($m.EFC_BOARD_POP._boardIdx);
    	attachBtnId = "btn_add";
    	boardStatus = $m.EFC_BOARD_POP._boardStatus;
    }else if(g_id == 'grd_reply_file'){//답글첨부파일
    	idx = $m.trim($m.getValue($m.EFC_BOARD_POP.getObj("wreplyidx")));
    	attachBtnId = "btn_reply_add";
    	boardStatus = $m.EFC_BOARD_POP._boardReplyStatus;
    	
    }
	if(boardStatus == "C" || boardStatus == "U"){
		var _btn = $m.getGridObj(g_jq,attachBtnId);
		if($m.isShowFoldBtn(_foldBtnObj)){
			$m.show(_btn);
        }else{
        	$m.hide(_btn);
        }
    }
}

</script>
<style>
</style>
</head>
<body>
	<div class="moca_pop_cont_wrap flex mobile" style="display:none;" id="contents">
        <div class="lybox flex fauto">
            <div class="ly_column col_5 fauto">
                <div class="ly_col_cont flex fcol">
				<div type="form" id="form_board" class="moca_table toolbar" style="display:none"
	                label=""
	                onFoldClick="$m.EFC_BOARD_POP.grd_btnShowHide"
	                showRowSelection="false"
	                addition='[
	                {"type":"button","position":"right","id":"btn_reply","label":"답변작성","onclick":"$m.EFC_BOARD_POP.fn_reply","innerStyle":"background:#97a2ba"},
	                {"type":"button","position":"right","id":"btn_update","label":"수정","onclick":"$m.EFC_BOARD_POP.fn_update","innerStyle":"background:#97a2ba"},
	                {"type":"button","position":"right","id":"btn_del","label":"삭제","onclick":"$m.EFC_BOARD_POP.fn_del","innerStyle":"background:#97a2ba"},
	                {"type":"button","position":"right","id":"btn_save","label":"저장","onclick":"$m.EFC_BOARD_POP.fn_save","innerStyle":"background:#97a2ba"},
	                {"type":"button","position":"right","id":"btn_del_admin","label":"물리삭제","onclick":"$m.EFC_BOARD_POP.fn_adminDel","innerStyle":"background:#6d7993", "addClass":""},
	                {"type":"button","position":"right","id":"btn_fold","onclick":"$m.EFC_BOARD_POP._foldForm","innerClass":"button grid_unfold"}
	                    ]'
	                >
				          	<div class="moca_table_cont" type="table">
				          		<div type="tbody" class="tbody_flex">
				          			<div type="tr" class="mShow writeHide">
				          				<div type="th" class="tar">게시물</div>
		                                <div type="td">
		                                    <div type="input" id="wboardinfo" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
		                                </div>
		                            </div>
				          			<div type="tr" class="mHide writeHide">
				          				<div type="th" class="tar">게시물번호</div>
		                                <div type="td">
		                                    <div type="input" id="widx" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
		                                </div>
		                            </div>
		                            <div type="tr" class="mHide">
		                                <div type="th" class="tar">작성일시</div>
		                                <div type="td">
		                                    <div type="input" id="wdate" class="mocaInput" style="width:100%;" innerStyle="" displayFunction="$m.dateFormat"  readonly="true"
		                                        defaultValue="" 
		                                        selecterItem=""
		                                        showRadioOption="false"
		                                    ></div>
		                                </div>
		                            </div>
				          			<div type="tr" class="mHide">
		                                <div type="th" class="tar">작성자</div>
		                                <div type="td">
		                                    <div type="input" class="mocaInput" style="width:100%;" innerStyle="" id="wid" displayFormat=""  readonly="true"
		                                        defaultValue="" 
		                                        selecterItem=""
		                                        showRadioOption="false"
		                                    ></div>
		                                </div>
		                            </div>
		                            <div type="tr" id="tr_completeid" class="mHide writeHide">
		                                <div type="th" class="tar">완료자</div>
		                                <div type="td">
		                                    <div type="input" class="mocaInput" style="width:100%;" innerStyle="" id="wcompleteid" displayFunction=""  readonly="true"
		                                        defaultValue="" 
		                                        selecterItem=""
		                                        showRadioOption="false"
		                                    ></div>
		                                </div>
		                            </div>
				          			<div type="tr" id="tr_status" class="mHide">
		                                <div type="th" class="tar">상태</div>
		                                <div type="td">
		                                	<!-- <div type="combo" id="cmb_board" class="moca_combo" readonly="true" displayFormat="[label]" cdField="code" nmField="codeNm" ></div> -->
		                                	<div type="searchCombo" 
											id="cmb_board" 
											class="moca_searchCombo" 
											inneronchange="" 
											style="width:100%" 
											readOnly="true"
											displayFormat="[label]" 
											cdField="code" 
											nmField="codeNm"   
											itemset='[{"cd":"0","nm":"해당없음 "},{"cd":"1","nm":"(%)비율"}]'>
											</div>
		                                </div>
		                            </div>
				          			
				          			<div type="tr" id="tr_phone" class="mHide">
		                                <div type="th" class="tar">휴대폰번호</div>
		                                <div type="td">
		                                    <div type="input" class="mocaInput" style="width:100%; " innerStyle="" id="wphone" displayFormat=""  readonly="true"
		                                        defaultValue="" 
		                                        keyMask="onlyNumber" displayFunction="$m.phoneWithDashFormatter"
		                                        showRadioOption="false"
		                                    ></div>
		                                </div>
		                            </div>
				          			<div type="tr" id="tr_email" class="mHide">
		                                <div type="th" class="tar">이메일</div>
		                                <div type="td">
		                                    <div type="input" class="mocaInput" style="width:100%" innerStyle="" id="wemail" displayFormat=""  readonly="true"
		                                        defaultValue="" 
		                                        selecterItem=""
		                                        showRadioOption="false"
		                                    ></div>
		                                </div>
		                            </div>
		                            <div type="tr">
		                                <div type="th" class="tar">제목</div>
		                                <div type="td">
		                                    <div type="input" class="mocaInput" style="width:100%;" innerStyle="" id="wtitle" displayFormat=""  readonly="true"
		                                        defaultValue="" 
		                                        selecterItem=""
		                                        showRadioOption="false"
		                                    ></div>
		                                </div>
		                            </div>
		                            <!-- 
				          			<div type="tr">
		                                <div type="th">접수자</div>
		                                <div type="td">
		                                    <div type="input" class="mocaInput" style="width:100%;" innerStyle="" id="wreceiptid" displayFunction=""  readonly="true"
		                                        defaultValue="" 
		                                        selecterItem=""
		                                        showRadioOption="false"
		                                    ></div>
		                                </div>
		                            </div>
		                             -->
				          			
				          		</div>
				          	</div>
                	</div>
			        <div class="edit fit"  style="top:0">
			        	<a id="edit_zoomBtn" style="display:none" class="edit_zoom" onclick="$m.editorPopChange($m.EFC_BOARD_POP.pageId,'editor',{uri:'/uat/uia/actionMain_link_zoom.do'},'')"></a>
			            <div contenteditable="true" placeholder="" id="editor"></div>
			        </div>
			        <div type="grid" class="moca_grid toolbar sc_row1 mt10 fold" default_cell_height="26px" id="grd_file" style="display:none; top:0; height:112px" rowSelectedColor="#434e5f"
			        
			                            toolbar_search_size="false"
			                            toolbar_detail="false"
			                            toolbar_exup="false"
			                            toolbar_exdn="false"
			                            toolbar_addrow="false"
			                            toolbar_delrow="true"
			                            toolbar_nextbtn="false"
			                            toolbar_full="false"
			                            toolbar_fold="true"
			                            onFoldClick="$m.EFC_BOARD_POP.grd_btnShowHide"
			                            toolbar_grid_button2='{"position":"left","id":"btn_add","label":"파일찾기","onclick":"$m.EFC_BOARD_POP._openFileUpload","addClass":"","innerDisabled":"false"}'
			                            onDblClick = "$m.EFC_BOARD_POP.grd_fileDownload"
			                            onRowSelected="$m.EFC_BOARD_POP.showFileURL"
			                            subLabel="첨부파일"
			        
			        >
			                <table style="width: 100%">
			                    <colgroup>
			                            <col style="width:50px" mobileHide="true" columnKey="status" thKey="H_status">
			                            <col style="width:50px">
			                            <col style="width:50px">
			                            <col style="">
			                            <col style="width:70px">       
			                    </colgroup>
			                    <thead>
			                        <tr>
			                            <th scope="col" id="H_status">상태</th>
			                            <th scope="col" id="H_BOARDFILE_IDX">IDX</th>
			                            <th scope="col" id="H_BOARDFILE_ID">ID</th>
			                            <th scope="col" id="H_BOARDFILE_NAME">파일명</th>
			                            <th scope="col" id="H_BOARDFILE_SIZE">파일크기</th>
			                        </tr>
			                    </thead>
			                    <tbody>
			                        <tr>
			                            <td id="status" celltype="input" style="" readOnly="true" name="상태"></td>
			                            <td id="BOARDFILE_IDX" celltype="input" style="" readOnly="true" name="IDX"></td>
			                            <td id="BOARDFILE_ID" celltype="input" style="" readOnly="true" name="파일ID"></td>
			                            <td id="BOARDFILE_NAME" celltype="input" style="text-align:left" name="파일명" readOnly="true"></td>
			                            <td id="BOARDFILE_SIZE" celltype="input" style="" name="파일크기" readOnly="true" displayFunction="$m.util.bytesToLabel"></td>
			                        </tr>
			                    </tbody>
			                </table>                
			        </div>
			        <div id="contourBar" class="contour" style="display:none;top:5px"></div>
					<div type="grid" class="moca_grid toolbar sc_row1 mt10 fold" default_cell_height="26px" style="display:none;height:112px" id="grd_reply_list" rowSelectedColor="#434e5f"
								toolbar_search_size="false"
								toolbar_detail="true"
								toolbar_exup="false"
								toolbar_exdn="true"
								toolbar_addrow="false"
								toolbar_delrow="false"
								toolbar_nextbtn="false"
								toolbar_full="true"
								toolbar_fold="true"
                                onRowSelected="$m.EFC_BOARD_POP.grd_1__onDblClick"
								subLabel="게시물답변"
								pagingType = "scrollbar"
					>
							<table style="width: 100%">
								<colgroup>
										<col style="width:30px">
										<col style="width:60px">
										
										<col style="min-width:220px">
										<col style="width:40px">
										<col style="width:100px">
										<col style="width:150px">
										<!--<col style="width:100px">-->	
								</colgroup>
								<thead>
									<tr>
										<th scope="col" celltype="checkbox" id="H_chk" targetId="chk">선택</th>
										<th scope="col" id="H_BOARD_IDX">ID</th>
										<th scope="col" id="H_BOARD_TITLE">제목</th>
										<th scope="col" id="H_BOARD_FILECNT">첨부</th>
										<th scope="col" id="H_BOARD_WRITER"  filterable="true" filterableId="BOARD_WRITER">작성자</th>
										<th scope="col" id="H_BOARD_DATE">작성일시</th>
										<!--<th scope="col" id="H_BOARD_BTN">버튼</th>-->
									</tr>
								</thead>
								<tbody>
									<tr>
										<td id="chk" celltype="checkbox" style="" trueValue="1" falseValue="0" name="선택" ></td>
										<td id="BOARD_IDX" celltype="input" style="text-align:center" name="ID" readOnly="true"></td>
										<td id="BOARD_TITLE" celltype="input" style="text-align:left" name="제목" readOnly="true"></td>
										<td id="CNT" celltype="input" style="" name="첨부" readOnly="true" displayFunction="$m.EFC_BOARD_POP.dispCnt"></td>
										<td id="BOARD_WRITER" celltype="input" style="text-align:center" name="작성자" readOnly="true"></td>
										<td id="BOARD_DATE" celltype="input" style="" name="작성일" readOnly="true" displayFunction="$m.longToDate"></td>
										<!--<td id="delBtn" name="삭제"  celltype="button" readonly="false" required="false" addRowEditable="false" callFunction="$m.TO_000P01.fn_onBtnClick" btnLabel="삭제"></td>-->
									</tr>
								</tbody>
							</table>				
					</div>
                </div>
            </div>
            <div class="ly_column col_5 fauto" id="reply_area" style="display:none;">
                <div class="ly_col_cont pl15 flex fcol">
                     <div type="form" id="form_reply" class="moca_table toolbar" style=""
						label="답변작성"
						showRowSelection="false"
						addition='[
						{"type":"button","position":"right","id":"btn_receipt","label":"접수","onclick":"$m.EFC_BOARD_POP.fn_status","innerStyle":"background:#81bcb3"},
						 {"type":"button","position":"right","id":"btn_success","label":"완료","onclick":"$m.EFC_BOARD_POP.fn_status","innerStyle":"background:#81bcb3"},
						  {"type":"button","position":"right","id":"btn_reject","label":"반려","onclick":"$m.EFC_BOARD_POP.fn_status","innerStyle":"background:#81bcb3"},
						{"type":"button","position":"right","id":"btn_reply_update","label":"답변수정","onclick":"$m.EFC_BOARD_POP.fn_update","innerStyle":"background:#81bcb3"},
						{"type":"button","position":"right","id":"btn_reply_del","label":"답변삭제","onclick":"$m.EFC_BOARD_POP.fn_del","innerStyle":"background:#81bcb3"},
						{"type":"button","position":"right","id":"btn_reply_save","label":"답변저장","onclick":"$m.EFC_BOARD_POP.fn_save","innerStyle":"background:#81bcb3"},
						{"type":"button","position":"right","id":"btn_reply_del_admin","label":"물리삭제","onclick":"$m.EFC_BOARD_POP.fn_adminDel","innerStyle":"background:#638f88", "addClass":""}
							]'
						>
						
						
						<div class="moca_table_cont" type="table">
							<div type="tbody">
								<div type="tr" class="mShow reply">
			          				<div type="th" class="tar">답변게시물</div>
	                                <div type="td">
	                                    <div type="input" id="wboardreplyinfo" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
	                                </div>
	                            </div>
								<div type="tr" id="tr_replyidx" class="mHide">
									<div type="th" class="tar">답변ID</div>
									<div type="td">
										 <div type="input" id="wreplyidx" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
									</div>
								</div>
								<div type="tr">
									<div type="th" class="tar">제목</div>
									<div type="td">
										<div type="input" class="mocaInput req" style="width:100%;" innerStyle="" id="wreplytitle" displayFormat=""  readonly="true"
											defaultValue="" 
											selecterItem=""
											showRadioOption="false"
										></div>
									</div>
								</div>
								<div type="tr" id="tr_createDt" class="mHide">
									<div type="th" class="tar">작성일시</div>
									<div type="td">
										<div type="input" class="mocaInput" style="width:100%; " innerClass="" id="wreplydate" displayFunction="$m.dateFormat"  readonly="true"
											defaultValue="" 
											selecterItem=""
											showRadioOption="false"
										></div>
									</div>
								</div>
								<div type="tr" id="tr_writer" class="mHide">
									<div type="th" class="tar">작성자</div>
									<div type="td">
										<div type="input" class="mocaInput" style="width:100%;" innerStyle="" id="wreplyid" displayFormat=""  readonly="true"
											defaultValue="" 
											selecterItem=""
											showRadioOption="false"
										></div>
									</div>
								</div>    
							</div>
						</div>
					</div>
                    <div class="mt5 edit fit"  style="top:0">
                	    <a id="reply_edit_zoomBtn" style="display:none" class="edit_zoom" onclick="$m.editorPopChange($m.EFC_BOARD_POP.pageId,'reply_editor',{uri:'/uat/uia/actionMain_link_zoom.do'},'')"></a>
                        <div contenteditable="true" placeholder="" id="reply_editor"></div>
                    </div>
                    <div type="grid" class="moca_grid toolbar mt10 fold" default_cell_height="26px" id="grd_reply_file" style="top:0; height:112px" rowSelectedColor="#434e5f"
                    
                                        toolbar_search_size="false"
                                        toolbar_detail="false"
                                        toolbar_exup="false"
                                        toolbar_exdn="false"
                                        toolbar_addrow="false"
                                        toolbar_delrow="true"
                                        toolbar_nextbtn="false"
                                        toolbar_full="false"
                                        toolbar_fold="true"
                                        onFoldClick="$m.EFC_BOARD_POP.grd_btnShowHide"
                                        toolbar_grid_button2='{"position":"left","id":"btn_reply_add","label":"파일찾기","onclick":"$m.EFC_BOARD_POP._openFileUpload","addClass":"","innerDisabled":"false"}'
                                        onDblClick = "$m.EFC_BOARD_POP.grd_fileDownload"
                                        onRowSelected="$m.EFC_BOARD_POP.showFileURL"
                                        subLabel="답변 첨부파일"
                    
                    >
                            <table style="width: 100%">
                                <colgroup>
                                        <col style="width:50px" mobileHide="true" columnKey="status" thKey="H_status">
                                        <col style="width:50px">
                                        <col style="width:50px">
                                        <col style="">
                                        <col style="width:60px">       
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th scope="col" class="bg_green" id="H_status">상태</th>
                                        <th scope="col" class="bg_green" id="H_BOARDFILE_IDX">IDX</th>
                                        <th scope="col" class="bg_green" id="H_BOARDFILE_ID">ID</th>
                                        <th scope="col" class="bg_green" id="H_BOARDFILE_NAME">파일명</th>
                                        <th scope="col" class="bg_green" id="H_BOARDFILE_SIZE">파일크기</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td id="status" celltype="input" style="" readOnly="true" name="상태"></td>
                                        <td id="BOARDFILE_IDX" celltype="input" style="" readOnly="true" name="파일IDX"></td>
                                        <td id="BOARDFILE_ID" celltype="input" style="" readOnly="true" name="ID"></td>
                                        <td id="BOARDFILE_NAME" celltype="input" style="text-align:left" name="파일명" readOnly="true"></td>
                                        <td id="BOARDFILE_SIZE" celltype="input" style="" name="파일크기" readOnly="true" displayFunction="$m.util.bytesToLabel"></td>
                                    </tr>
                                </tbody>
                            </table>                
                    </div>
                </div>
            </div>
            <div class="reply_bg"></div>
            <div type="input" id="clipboard" class="mocaInput" innerClass="input_clipboard" style="" onclick="" style="" value="" readonly="false"></div>
        </div>
	</div>
</body>
</html>