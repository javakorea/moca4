<!DOCTYPE html>
<html lang="ko">
<head>
<script>
	$m.EFC_CODE.___ready = function(args){
		$m.EFC_CODE.code({
			"grd_1.useAt":{code:'EFC001'},
			"grd_2.useAt":{code:'EFC001'}
		},function(){
			$m.EFC_CODE.fn_search();
		});
	};
	
	$m.EFC_CODE.fn_search = function(){
		$m.EFC_CODE.exe({
			url : $m._domain+$m._contextRoot+"/sym/ccm/cca/EgovCcmCmmnCodeList_json.do",
            data : {
            	"header" : $m.header,
            	"body" : {searchKeyword:$m.getValue($m.EFC_CODE.getObj( "searchKeyword"))}
            },			
			callback : function(response){
				$m.EFC_CODE.drawGrid('grd_1', $m.EFC_CODE.getResList(response,"list"));
				$m.EFC_CODE.fn_detail_search();
			}
		});
	};
	$m.EFC_CODE.fn_detail_search = function(codeGrpId){
		$m.EFC_CODE.exe({
			url : $m._domain+$m._contextRoot+"/sym/ccm/cde/EgovCcmCmmnDetailCodeList_json.do",
			loadingbar : false,
            data : {
            	"header" : $m.header,
            	"body" : {"codeGrpId":codeGrpId}
            },			
			callback : function(response){
				$m.EFC_CODE.drawGrid('grd_2', $m.EFC_CODE.getResList(response,"list"));
			}
		});
	};
	
		
	$m.EFC_CODE.fn_exe = function(codeGrpId){
		if($m.EFC_CODE.validate("grd_1","status","C,U,D")){
			$m.confirm('저장하시겠습니까?',function(result){
				if(result == 'Y'){
					$m.EFC_CODE.exe({
						url : $m._domain+$m._contextRoot+"/sym/ccm/cca/EgovCcmCmmnCodeMModify_json.do",
			            data : {
			            	"header" : $m.header,
			            	"body" : {
			            		paramList:$m.EFC_CODE.getFilteredList("grd_1","status","C,U,D")
			            	}
			            },		
						callback : function(){
			        	   $m.alert('성공적으로 저장되었습니다!',function(){
			        		   $m.EFC_CODE.fn_search();
			        	   	   return;
			        	   });	
						}
					});
				}
			});
		}		

	};
	
	$m.EFC_CODE.fn_detail_exe = function(codeGrpId){
		var codeId;
		var grd = $m.EFC_CODE.getObj("grd_1");
		var selectedRowIndex = grd.getAttribute('selectedRealRowIndex');
		if(selectedRowIndex != undefined){
			codeId = $m.EFC_CODE.getCellData(grd,selectedRowIndex,'codeId');
		}
		
		if($m.EFC_CODE.validate("grd_2","status","C,U,D")){
			$m.confirm('저장하시겠습니까?',function(result){
				if(result == 'Y'){
					$m.EFC_CODE.exe({
						url : $m._domain+$m._contextRoot+"/sym/ccm/cca/EgovCcmCmmnCodeDModify_json.do",
			            data : {
			            	"header" : $m.header,
			            	"body" : {
			            		paramList_D:$m.EFC_CODE.getFilteredList("grd_2","status","C,U,D"),
			            		"codeId":codeId
			            	}
			            },		
						callback : function(){
			        	   $m.alert('성공적으로 저장되었습니다!',function(){
			        			var codeGrpId;
			        			var grd = $m.EFC_CODE.getObj("grd_1");
			        			var selectedRowIndex = grd.getAttribute('selectedRealRowIndex');
			        			if(selectedRowIndex != undefined){
			        				codeGrpId = $m.EFC_CODE.getCellData(grd,selectedRowIndex,'codeId');
			        			}
			        			$m.EFC_CODE.fn_detail_search(codeGrpId);
			        	   	   return;
			        	   });	
						}
					});
				}
			});
		}		

	};
	
	
	
	
	
	$m.EFC_CODE.fn_codeGrpSelect = function(_grd,_idx){
		var codeGrpId = $m.EFC_CODE.getCellData(_grd,_idx,'codeId');
		$m.EFC_CODE.fn_detail_search(codeGrpId);
	};
	
	
	
	
</script>

</head>
<body>
	
<div id="moca_tab_bridge1" class="moca_tab_panel" role="mdipanel" style="display:block;visibility:visible;">
	<div class="moca_tab_cont" style="height:100%">
		<div class="moca_cont_wrap flex fcol">
			<div type="include" class="moca_titbox cm" id="titbox" tag="moca:titbox" 
				src="/html/titlebox.html"
				data = '{"sreenCd":"MOCA_CODE","sreenNm":"공통코드관리","sreenPath":"기준정보관리,공통코드관리"}'
			></div>
			
			<div class="moca_shbox">
				<div class="shbox_inner">
					<div class="flex fwrap">
						<div class="tb">
							<span class="tb_th">코드그룹명</span>
							<span class="tb_td">
								<div type="input" id="searchKeyword" keyMask="enterSearchEvt" class="mocaInput sh"  style=""  disabled="false" readonly="false"></div>
							</span>
						</div>
					</div>
				</div>
				<div class="btn_shbox">
					<button type="button" class="button btn_sc" onclick="$m.EFC_CODE.fn_search(this)"><i class="fas fa-search"></i><span>조회</span></button>
				</div>
			</div>
			
			<div class="lybox fauto mt12">
				<div class="ly_column col_5">
					<div class="ly_col_cont pr7_5">
						<div type="grid" class="moca_grid toolbar" default_cell_height="26px" id="grd_1" rowSelectedColor="#434e5f" onRowSelected="$m.EFC_CODE.fn_codeGrpSelect"
									rendering_div = "true"
									toolbar_search_size="false"
									toolbar_detail="false"
									toolbar_exup="false"
									toolbar_exdn="false"
									toolbar_addrow="true"
									toolbar_delrow="true"
									toolbar_nextbtn="false"
									toolbar_full="true"
									toolbar_grid_button1='{"position":"right","id":"btn_save","label":"저장","onclick":"$m.EFC_CODE.fn_exe","addClass":""}'
									
									label="코드그룹"
						>
								<table style="width: 100%">
									<colgroup>
										<col style="width:60px" mobileHide="true" hide="false" columnKey="status" thKey="H_status" >
										<col style="width:90px" mobileHide="false" hide="false" columnKey="codeId" thKey="H_codeId" >
										<col style="" mobileHide="false" hide="false" columnKey="codeIdNm" thKey="H_codeIdNm" >		
										<col style="width:110px" mobileHide="true" hide="false" columnKey="useAt" thKey="H_useAt" >								
									</colgroup>
									<thead>
										<tr>
											<th scope="col" id="H_status">상태</th>
											<th scope="col" id="H_codeId">코드그룹아이디</th>
											<th scope="col" id="H_codeIdNm">코드그룹명</th>
											<th scope="col" id="H_useAt">사용여부</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td id="status" celltype="input" style="" readOnly="true" name="상태"></td>
											<td id="codeId" celltype="input" style="" readOnly="true" required="true" name="코드그룹아이디"></td>
											<td id="codeIdNm" celltype="input" style=""  required="true" name="코드그룹명"></td>
											<td id="useAt" celltype="select" style="" readOnly="false"  displayFormat="[value] [label]"  required="true" name="사용여부"></td>
										</tr>
									</tbody>
								</table>				
						</div>
					</div>
				</div>
				<div class="ly_column col_5">
					<div class="ly_col_cont pl7_5">
						<div type="grid" class="moca_grid toolbar sc_row" default_cell_height="26px" id="grd_2" rowSelectedColor="#434e5f"
									rendering_div = "true"
									toolbar_detail="false"
									toolbar_exup="false"
									toolbar_exdn="false"
									toolbar_addrow="true"
									toolbar_delrow="true"
									toolbar_nextbtn="false"
									toolbar_full="true"
									toolbar_grid_button1='{"position":"right","id":"btn_save2","label":"저장","onclick":"$m.EFC_CODE.fn_detail_exe","addClass":""}'
									
									label="코드목록"
						>
								<table style="width: 100%">
									<colgroup>
											<col style="width:60px" mobileHide="true" hide="false" columnKey="status" thKey="H_status" >
											<col style="width:60px" mobileHide="false" hide="false" columnKey="code" thKey="H_code" >
											<col style="" mobileHide="false" hide="false" columnKey="codeNm" thKey="H_codeNm" >		
											<col style="width:110px" mobileHide="true" hide="false" columnKey="useAt" thKey="H_useAt" >								
									</colgroup>
									<thead>
										<tr>
											<th scope="col" id="H_status">상태</th>
											<th scope="col" id="H_code">코드</th>
											<th scope="col" id="H_codeNm">코드명</th>
											<th scope="col" id="H_useAt">사용여부</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td id="status" celltype="input" style="" readOnly="true" name="상태"></td>
											<td id="code" celltype="input" style="" readOnly="true" required="true" name="코드"></td>
											<td id="codeNm" celltype="input" style="" required="true" name="코드명"></td>
											<td id="useAt" celltype="select" style="" readOnly="false"  displayFormat="[value] [label]"  required="true" name="사용여부"></td>
										</tr>
									</tbody>
								</table>				
						</div>
					</div>
				</div>				
			</div>
		</div>	
	</div>
</div>
</body>
</html>