<!DOCTYPE html>
<html lang="ko">
<head>
<script>
	moca.EFC_AUTH.___ready = function(args){
		moca.EFC_AUTH.code({
			"grd_3.depth":{code:'EFC003'}
		},function(){
			moca.EFC_AUTH.fn_search();
		});
	};

	moca.EFC_AUTH.fn_search = function(){
		moca.EFC_AUTH.exe({
			url : moca._domain+moca._contextRoot+"/sec/ram/EgovAuthorList_json.do",
            data : {
            	"header" : moca.header,
            	"body" : {authorNm:moca.EFC_AUTH.getInput("authorNm")}
            },			
			callback : function(response){
				moca.EFC_AUTH.drawGrid('grd_3',[]);
				moca.EFC_AUTH.drawGrid('grd_1', moca.EFC_AUTH.getResList(response,"list"));
			}
		});
	};
	
	moca.EFC_AUTH.fn_menu_search = function(authorCode){
		moca.EFC_AUTH.exe({
			url : moca._domain+moca._contextRoot+"/sym/mnu/mcm/EgovMenuCreatSelect_json.do",
			loadingbar:true,
            data : {
            	"header" : moca.header,
            	"body" : {"authorCode":authorCode}
            },			
			callback : function(response){
				var list = moca.EFC_AUTH.getResList(response,"list");
				moca.EFC_AUTH.drawGrid('grd_3', list);
			}
		});
	};
	
	
	moca.EFC_AUTH.fn_grd1_add = function(){
		if(moca.EFC_AUTH.validate("grd_1","status","C,U,D")){
			moca.confirm('저장하시겠습니까?',function(result){
				if(result == 'Y'){
					moca.EFC_AUTH.exe({
						url : moca._domain+moca._contextRoot+"/sec/ram/EgovAuthorModify_json.do",
			            data : {
			            	"header" : moca.header,
			            	"body" : {
			            		paramList:moca.EFC_AUTH.getFilteredList("grd_1","status","C,U,D")
			            	}
			            },		
						callback : function(){
			        	   moca.alert('성공적으로 저장되었습니다!',function(){
			        		   moca.EFC_AUTH.fn_search();
			        	   	   return;
			        	   });	
						}
					});
				}
			});
		}
	};
	
	moca.EFC_AUTH.fn_add = function(){
		if(moca.EFC_AUTH.validate("grd_1","status","C,U,D")){
			moca.confirm('저장하시겠습니까?',function(result){
				if(result == 'Y'){
					moca.EFC_AUTH.exe({
						url : moca._domain+moca._contextRoot+"/sec/ram/EgovAuthorModify_json.do",
			            data : {
			            	"header" : moca.header,
			            	"body" : {
			            		paramList:moca.EFC_AUTH.getFilteredList("grd_1","status","C,U,D")
			            	}
			            },		
						callback : function(){
			        	   moca.alert('성공적으로 저장되었습니다!',function(){
			        		   moca.EFC_AUTH.fn_search();
			        	   	   return;
			        	   });	
						}
					});
				}
			});
		}
	};
	
	moca.EFC_AUTH.fn_grd3_add = function(){
		if(moca.EFC_AUTH.validate("grd_3","status","C,U,D")){
			moca.confirm('저장하시겠습니까?',function(result){
				if(result == 'Y'){
					moca.EFC_AUTH.exe({
						url : moca._domain+moca._contextRoot+"/sym/mnu/mcm/EgovMenuCreatInsert_json.do",
			            data : {
			            	"header" : moca.header,
			            	"body" : {
			            		"authorCode":moca.EFC_AUTH.getSelectedRowJson("grd_1")['authorCode'],
			            		paramList:grd_3.list
			            	}
			            },		
						callback : function(){
			        	   moca.alert('성공적으로 저장되었습니다!',function(){
								moca.EFC_AUTH.drawGrid('grd_3', []);
			        			var authorCode = moca.EFC_AUTH.getSelectedRowJson("grd_1")['authorCode'];
			        			moca.EFC_AUTH.fn_menu_search(authorCode);
			        	   		return;
			        	   });	
						}
					});
				}
			});
		}
	};
	
	
	
	moca.EFC_AUTH.fn_codeGrpSelect = function(_grd,_idx){
		var authorCode = moca.getCellData(_grd,_idx,'authorCode');
		//moca.EFC_AUTH.fn_detail_search(authorCode);
		moca.EFC_AUTH.fn_menu_search(authorCode);
	};
	
	moca.EFC_AUTH.fn_detail_search = function(authorCode){
		moca.EFC_AUTH.exe({
			url : moca._domain+moca._contextRoot+"/sec/ram/EgovAuthorRoleList_json.do",
			loadingbar : false,
            data : {
            	"header" : moca.header,
            	"body" : {"searchKeyword":authorCode}
            },			
			callback : function(response){
				moca.EFC_AUTH.drawGrid('grd_2', moca.EFC_AUTH.getResList(response,"list"));
			}
		});
	};
	
	
</script>

</head>
<body>
	
<div id="moca_tab_bridge1" class="moca_tab_panel" role="mdipanel" style="display:block;visibility:visible;">
	<div class="moca_tab_cont" style="height:100%">
		<div class="moca_cont_wrap flex fcol">
			<div type="wframe" class="moca_titbox cm" id="titbox" tag="moca:titbox" 
				src="/html/titlebox.html"
				data = '{"sreenCd":"EFC_AUTH","sreenNm":"권한관리","sreenPath":"기준정보관리,권한관리"}'
			></div>
			
			<div class="moca_shbox">
				<div class="shbox_inner">
					<div class="flex fwrap">
						<div class="tb">
							<span class="tb_th">시스템명권한명</span>
							<span class="tb_td">
								<input type="text" class="moca_input sh" style="width:150px" id="authorNm" autocomplete="off" onkeyup="moca.default_keyup(this)">
							</span>
						</div>
					</div>
				</div>
				<div class="btn_shbox">
					<button type="button" class="button btn_sc" onclick="moca.EFC_AUTH.fn_search(this)"><i class="fas fa-search"></i><span>조회</span></button>
				</div>
			</div>
			
			<div class="lybox fauto mt12 flex fcol">
				<div class="ly_row row_3_7_3">
					<div class="ly_row_cont">
						<div type="grid" class="moca_grid toolbar sc_row" default_cell_height="26px" id="grd_1"  onRowSelected="moca.EFC_AUTH.fn_codeGrpSelect"
							toolbar_search_size="false"
							toolbar_detail="true"
							toolbar_exup="false"
							toolbar_exdn="true"
							toolbar_addrow="true"
							toolbar_delrow="true"
							toolbar_nextbtn="false"
							toolbar_full="true"
							toolbar_grid_button1='{"position":"right","id":"btn_save","label":"저장","onclick":"moca.EFC_AUTH.fn_grd1_add","addClass":""}'
									
							label="권한목록"
						>
								<table style="width: 100%">
									<colgroup>
											<col style="width:60px">
											<col style="width:150px">	
											<col style="width:200px">
											<col style="">	
											<col style="width:150px">							
									</colgroup>
									<thead>
										<tr>
											<th scope="col" id="lv0">상태</th>
											<th scope="col" id="lv1">권한코드</th>
											<th scope="col" id="lv2">권한명</th>
											<th scope="col" id="lv3">설명</th>
											<th scope="col" id="lv4">등록일자</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td id="status" celltype="input" style="" readOnly="true" name="상태" ></td>
											<td id="authorCode" celltype="input"  readOnly="true" required="true" name="권한코드" style="text-align:left"></td>
											<td id="authorNm" celltype="input" readOnly="true" required="true" name="권한명" style="text-align:left"></td>
											<td id="authorDc" celltype="input" style="" readOnly="false" name="설명"></td>
											<td id="authorCreatDe" celltype="input" style="" readOnly="true" addRowEditable="false" name="등록일자"></td>
										</tr>
									</tbody>
								</table>				
						</div>
					</div>
				</div>
				<div class="ly_row row_3_7_7 fauto">

							<div type="grid" class="moca_grid toolbar sc_row1" default_cell_height="26px" id="grd_3"
								toolbar_search_size="false"
								toolbar_detail="true"
								toolbar_exup="false"
								toolbar_exdn="true"
								toolbar_addrow="false"
								toolbar_delrow="false"
								toolbar_nextbtn="false"
								toolbar_full="true"
								toolbar_grid_button1='{"position":"right","id":"btn_save2","label":"저장","onclick":"moca.EFC_AUTH.fn_grd3_add","addClass":""}'
								
								label="메뉴목록"					
							>
									<table style="width: 100%">
										<colgroup>
												<col style="width:60px">
												<col style="width:60px">
												<col style="width:180px">
												<col style="width:120px">
												<col style="width:80px">
												<col style="width:80px">
												<col style="width:180px">
												<col style="width:40px">
												<col style="width:180px">
<!--  												<col style="width:170px">
												<col style="width:170px"> -->
												<col style="">
										</colgroup>
										<thead>
											<tr>
												<th scope="col" id="lv0">상태</th>
												<th scope="col" id="lv1">선택</th>
												<th scope="col" id="lv1">TREE</th>
												<th scope="col" id="lv2">LEVEL</th>
												<th scope="col" id="lv3">상위메뉴</th>
												<th scope="col" id="lv4">메뉴번호</th>
												<th scope="col" id="lv5">메뉴명</th>
												<th scope="col" id="lv6">순서</th>
												<th scope="col" id="lv7">프로그램파일명</th>
<!--  												<th scope="col" id="lv6">이미지명</th>
												<th scope="col" id="lv7">이미지경로</th> -->
												<th scope="col" id="lv8">설명</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td id="status" celltype="input" style="" readOnly="true" name="상태"></td>
												<td id="chk" celltype="checkbox" style="" trueValue="1" falseValue="0" name="선택"></td>
												<td id="treeDepth" celltype="tree" levelId="depth" labelId="menuNm" parentNodeId="upperMenuId" nodeId="menuNo" style="text-align:left" name="TREE"></td>
												<td id="depth" celltype="select" style=""  readOnly="true" name="LEVEL"></td>
												<td id="upperMenuId" celltype="input" style=""  readOnly="true" name="상위메뉴"></td>
												<td id="menuNo" celltype="input" style="" readOnly="true"  readOnly="true" name="메뉴번호"></td>
												<td id="menuNm" celltype="input" style="text-align:left"  readOnly="true" name="메뉴명"></td>
												<td id="menuOrdr" celltype="input" style="text-align:center"   readOnly="true" name="순서"></td>
												<td id="progrmFileNm" celltype="input" readOnly="true" style="text-align:left" required="true" name="프로그램파일명"></td>
<!-- 												<td id="relateImageNm" celltype="input" style="" name="이미지명"></td>
												<td id="relateImagePath" celltype="input" style="" name="이미지경로"></td> -->
												<td id="menuDc" celltype="input" readOnly="true" style="text-align:left" name="설명"></td>
											</tr>
										</tbody>
									</table>				
							</div>
				</div>				
			</div>
		</div>	
	</div>
</div>
</body>
</html>