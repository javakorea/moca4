<!DOCTYPE html>
<html lang="ko">
<head>
<script>
	moca.EFC_BOARD_WS.boardType ='WS';
	moca.EFC_BOARD_WS.___ready = function(args){
	    moca.EFC_BOARD_WS.code({
            "chkg_1":{code:'boardStatus'}
        },function(result){
        	
        	//test
        	//moca.setDisabled(moca.EFC_BOARD_WS.getObj("rePurchaseBtn"), true);
        	
        	
        	if(moca.getSs("authorCode") != "ROLE_SUPER_ADMIN"){
    	    	moca.hide(moca.EFC_BOARD_WS.getObj("btn_del_admin"));
    	    }
        	var list = result['chkg_1'];
        	moca.setCheckboxGroupList(
        			moca.EFC_BOARD_WS.getObj('chkg_1'),
        			list,
        			{label:"codeNm",value:"code",checked:true},
        			{"Y":"unchecked"}
        	);
        	moca.EFC_BOARD_WS.fn_search();
        });
	};
	moca.EFC_BOARD_WS.grdList ;
	moca.EFC_BOARD_WS.fn_search = function(_pageNum){
		if(_pageNum == null) _pageNum = 1;
		var _lcpp = moca.getAttrObj(moca.EFC_BOARD_WS.getObj('grd_1'),'paging').listCntPerPage;
	    moca.EFC_BOARD_WS.exe({
	        url : moca._domain+moca._contextRoot+"/EFC_BOARD/selectBoardList.do",
	        loadingbar:true,
	        data : {
	            "header" : moca.header,
	            "body" : {
	            	"limitFrom" : String((_pageNum-1)*_lcpp),
	        		"limitPerPage" : _lcpp+'',
	            	"BOARD_TYPE":moca.EFC_BOARD_WS.boardType,
	            	"BOARD_WRITER":moca.getValue(moca.EFC_BOARD_WS.getObj( "ipt_WRITER")),
	            	"BOARD_TITLE":moca.getValue(moca.EFC_BOARD_WS.getObj( "ipt_TITLE")),
	            	"FROM":moca.EFC_BOARD_WS.getFrom("CREATE_DTTM").replace(/-/g,''),
                    "TO":moca.EFC_BOARD_WS.getTo("CREATE_DTTM").replace(/-/g,''),
                    "BOARD_SUPPORT":moca.getCheckboxGroupCheckedList(moca.EFC_BOARD_WS.getObj('chkg_1'))
	            }
	        },          
	        callback : function(response){
	        	moca.EFC_BOARD_WS.grdList = moca.getResList(response,"selectBoardList");
	            moca.EFC_BOARD_WS.drawGrid('grd_1',moca.EFC_BOARD_WS.grdList,response);
	            var _supportB = (response.selectBoardStatusCnt.B != null)? response.selectBoardStatusCnt.B : 0;
	            var _supportN = (response.selectBoardStatusCnt.N != null)? response.selectBoardStatusCnt.N : 0;
	            var _supportR = (response.selectBoardStatusCnt.R != null)? response.selectBoardStatusCnt.R : 0;
	            var _supportY = (response.selectBoardStatusCnt.Y != null)? response.selectBoardStatusCnt.Y : 0;

	         
	            moca.setLabelValue(moca.EFC_BOARD_WS.getObj('supportB'),moca.comma(_supportB));//반려
	            moca.setLabelValue(moca.EFC_BOARD_WS.getObj('supportN'),moca.comma(_supportN));//요청
	            moca.setLabelValue(moca.EFC_BOARD_WS.getObj('supportR'),moca.comma(_supportR));//접수
	            moca.setLabelValue(moca.EFC_BOARD_WS.getObj('supportY'),moca.comma(_supportY));//완료
	        }
	    });
	};
	
	moca.EFC_BOARD_WS.popId = "EFC_BOARD_POP";
	moca.EFC_BOARD_WS.fn_pop = function(_thisObj){
	    ['글쓰기 팝업']
	    var o = {};
	    o.id = moca.EFC_BOARD_WS.popId2;
	    o.url = '/html/EFC/EFC_BOARD_POP.html';
	    o.type = "POPUP";
	    o.modal = "false";
	    o.title = '게시물작성';
	    o.callback = moca.EFC_BOARD_WS.fn_pop_callback;
	    o.scopeId = moca.EFC_BOARD_WS.pageId;
	    o.data = {popTitle:"게시물작성","BOARD_TYPE":moca.EFC_BOARD_WS.boardType};
	    moca.popup(o,_thisObj);
	};
	moca.EFC_BOARD_WS.grd_1__onDblClick = function(_grd,rowIndex,colIndex,colId){
	    ['게시글상세']
	    var _BoardTitle = _grd.list[rowIndex].BOARD_TITLE;
	    var _BoardIdx = moca.getCellData(_grd,rowIndex,'BOARD_IDX');
	    var __BoardParentIdx;
	    if( moca.getCellData(_grd,rowIndex,'BOARD_PIDX') != null){
	    	 __BoardParentIdx = moca.getCellData(_grd,rowIndex,'BOARD_PIDX');
	    }else{
	    	__BoardParentIdx = '';
	    }
	    var o = {};
	    o.id = moca.EFC_BOARD_WS.popId;
	    o.url = '/html/EFC/EFC_BOARD_POP.html';
	    o.type = "POPUP";
	    o.modal = "false";
	    o.title = '게시글상세';
	    o.callback = moca.EFC_BOARD_WS.fn_pop_callback;
	    o.scopeId = moca.EFC_BOARD_WS.pageId;
	    o.data = {"BOARD_IDX":_BoardIdx+'',"BOARD_PIDX":__BoardParentIdx+'',"BOARD_TITLE":_BoardTitle,"BOARD_TYPE":moca.EFC_BOARD_WS.boardType};
	    moca.popup(o,_grd);
	};
	moca.EFC_BOARD_WS.fn_adminDelList = function(){
		['게시글 물리삭제 관리자삭제']
        if(moca.EFC_BOARD_WS.validate("grd_1","status","C,U,D")){
       		moca.confirm('삭제하시면 데이터를 더이상 복구하실 수 없습니다.<br/>또한 원글을 삭제하실경우 답글까지도 삭제됩니다.<br/>그래도 삭제하시겠습니까?',function(result){
                   if(result == 'Y'){
                       moca.EFC_BOARD_WS.exe({
                           url : moca._domain+moca._contextRoot+"/EFC_BOARD/deleteBoardList.do",
                           data : {
                               "header" : moca.header,
                               "body" : {
                                   paramList:moca.getCheckedData(moca.EFC_BOARD_WS.getObj("grd_1"),"chk")
                               }
                           },      
                           callback : function(){
                              moca.alert('성공적으로 삭제되었습니다!',function(){
                                  moca.EFC_BOARD_WS.fn_search();
                                  return;
                              });  
                           }
                       });
                   }
               });
        }
    };
    moca.EFC_BOARD_WS.fn_delList = function(){
		['게시글 삭제']
        if(moca.EFC_BOARD_WS.validate("grd_1","status","C,U,D")){
       		moca.confirm('원글을 삭제하실경우 답글까지도 삭제됩니다.<br/>선택된 목록들을 삭제하시겠습니까?',function(result){
                   if(result == 'Y'){
                       moca.EFC_BOARD_WS.exe({
                           url : moca._domain+moca._contextRoot+"/EFC_BOARD/deleteStatusBoardList.do",
                           data : {
                               "header" : moca.header,
                               "body" : {
                                   paramList:moca.getCheckedData(moca.EFC_BOARD_WS.getObj("grd_1"),"chk")
                               }
                           },      
                           callback : function(){
                              moca.alert('성공적으로 삭제되었습니다!',function(){
                                  moca.EFC_BOARD_WS.fn_search();
                                  return;
                              });  
                           }
                       });
                   }
               });
        }
    };
    moca.EFC_BOARD_WS.dispCnt= function(_thisVal){
    	if(_thisVal !=null && _thisVal != 0){
    		return _thisVal;
    	}else{
    		_thisVal = '';
    		return _thisVal;
    	}
    }
    
    moca.EFC_BOARD_WS.dispReply= function(_thisVal, _grd, _realrow){
    	var _showVal = '';
    	var _replyCnt = (_grd.list[_realrow].BOARD_REPLYCNT > 0)?_grd.list[_realrow].BOARD_REPLYCNT:'';
    	var _thisValStr = (_grd.list[_realrow].BOARD_REPLYCNT > 0)?_thisVal+ '<span class="txt_red">[' +_replyCnt+ ']</span>':_thisVal;
			if(_grd.list[_realrow].BOARD_SUPPORT == "N"){
				_showVal = "<i class='msg txt_sky mr5'>요청</i>"+ _thisValStr;
			}else if(_grd.list[_realrow].BOARD_SUPPORT == "R"){
				_showVal = "<i class='msg txt_green mr5'>접수</i>"+ _thisValStr;
			}else if(_grd.list[_realrow].BOARD_SUPPORT == "B"){
				_showVal = "<i class='msg txt_orange mr5'>반려</i>"+ _thisValStr;
			}else{
				_showVal = _thisValStr;
			}
		return _showVal;
    }
    
    moca.EFC_BOARD_WS.disabled= function(_thisVal, _grd, _realrow){
    	if(_grd.list[_realrow].BOARD_WRITER != moca.getSs("USER_ID") && moca.getSs("authorCode") != "ROLE_SUPER_ADMIN"){
    		return true;
    	}else{
    		return false;
    	}
    }
    moca.EFC_BOARD_WS.fn_check_before = function(_grd,_rowIndex,_colId){
    	/*
    	var pro = Promise.resolve();
    	if(_colId == 'chk'){
        	pro = pro.then(function(re){
        		return new Promise(function(resolve,reject){
            	    moca.EFC_BOARD_WS.exe({
            	        url : moca._domain+moca._contextRoot+"/EFC_BOARD/selectBoardList.do",
            	        loadingbar:true,
            	        data : {
            	            "header" : moca.header,
            	            "body" : {
            	            	"BOARD_TYPE":moca.EFC_BOARD_WS.boardType,
            	            	"BOARD_WRITER":moca.EFC_BOARD_WS.getInput("ipt_WRITER"),
            	            	"BOARD_TITLE":moca.EFC_BOARD_WS.getInput("ipt_TITLE"),
            	            	"FROM":moca.EFC_BOARD_WS.getFrom("CREATE_DTTM").replace(/-/g,''),
                                "TO":moca.EFC_BOARD_WS.getTo("CREATE_DTTM").replace(/-/g,''),
                                "BOARD_SUPPORT":moca.getCheckboxGroupCheckedList(moca.EFC_BOARD_WS.getObj('chkg_1'))
            	            }
            	        },          
            	        callback : function(response){resolve(response);}
            	    });
        		});
        	});
        	pro = pro.then(function(response){
            	var money = '200,000'
        	});    	
    	}
    	return pro;
    	*/
    };
    moca.EFC_BOARD_WS.fn_check_after = function(_grd,_rowIndex,_colId){
    	if(_colId == 'chk'){
    		var checkedId = moca.getCellData(_grd,_rowIndex,'BOARD_IDX');
    		var checkedValue = moca.getCellData(_grd,_rowIndex,'chk');
    		for(var i=_rowIndex+1; i < moca.EFC_BOARD_WS.grdList.length ;i++){
    		    if(moca.EFC_BOARD_WS.grdList[i].BOARD_PIDX == checkedId){
    		    	moca.EFC_BOARD_WS.setCellData(moca.EFC_BOARD_WS.getObj("grd_1"),i,'chk',checkedValue);
    		    }else{
    		    	break;
    		    }
    		}
    		moca.EFC_BOARD_WS.redrawGrid(moca.EFC_BOARD_WS.getObj("grd_1"));
    	}
    };
    
    moca.EFC_BOARD_WS.fn_rePurchase = function(_grd,_rowIndex,_colId){
    	alert('발생')
    }
    
</script>

</head>
<body>
	
<div id="moca_tab_bridge1" class="moca_tab_panel" role="mdipanel" style="display:block;visibility:visible;">
	<div class="moca_tab_cont" style="height:100%">
		<div class="moca_cont_wrap flex fcol">
			<div type="wframe" class="moca_titbox cm" id="titbox" tag="moca:titbox" 
				src="/html/titlebox.html"
				data = '{"sreenCd":"MOCA_BOARD_WS","sreenNm":"웹스퀘어게시판","sreenPath":"시스템설정,웹스퀘어게시판"}'
			></div>
			<div class="moca_shbox">
				<div class="shbox_inner">
					<div class="flex fwrap">
						<div class="tb">
							<span class="tb_th">기간</span>
							<span class="tb_td">
								<div type="inputMultiCalendar" class="moca_ica fl" style="width:auto" id="CREATE_DTTM" displayFormat="####-##-##" 
		                               defaultValue="12개월전" 
		                               selecterItem="오늘,3일전,6일전"
		                               showRadioOption="false"
		                         ></div>
							</span>
						</div>
						<div class="tb">
							<span class="tb_th">상태</span>
							<span class="tb_td">
								<div type="checkboxGroup" class="fl bd" style="width:207px" direction="vertical" id="chkg_1"
	                                itemset='[
	                                    {"id":"chk1","label":"완료","value":"Y","checked":"true"}
	                                ]'>
	                            </div>
							</span>
						</div>
						<div class="tb">
							<span class="tb_th">이름</span>
							<span class="tb_td">
								<div type="input" id="ipt_WRITER" keyMask="enterSearchEvt" class="mocaInput sh"  style="width:207px"  disabled="false" readonly="false"></div>
							</span>
						</div>
						<div class="tb">
							<span class="tb_th">제목</span>
							<span class="tb_td">
								<div type="input" id="ipt_TITLE" keyMask="enterSearchEvt" class="mocaInput sh"  style="width:207px"  disabled="false" readonly="false"></div>
							</span>
						</div>
						<!-- 
						<div class="tb">
							<div class="buttonGroup">				
								<div type="button" id="rePurchaseBtn" class="mocaButton imgBtn fl mr5 btn_ts" onclick="moca.EFC_BOARD_WS.fn_rePurchase(this)" style="" innerStyle="padding-left:32px" value="실행할 기능 없음" label="실행할 기능 없음" ></div>
							</div>
						</div>
						 -->​
					</div>
				</div>
				<div class="btn_shbox">
					<button type="button" class="button btn_sc" onclick="moca.EFC_BOARD_WS.fn_search(this)"><i class="fas fa-search"></i><span>조회</span></button>
				</div>
			</div>
			<div type="grid" class="moca_grid toolbar fauto mt12" default_cell_height="26px" id="grd_1" rowSelectedColor="#434e5f"
			
								toolbar_search_size="false"
								toolbar_detail="true"
								toolbar_exup="false"
								toolbar_exdn="true"
								toolbar_addrow="false"
								toolbar_delrow="false"
								toolbar_nextbtn="false"
								toolbar_full="true"
								toolbar_grid_button1='{"position":"right","id":"btn_add","label":"글쓰기","onclick":"moca.EFC_BOARD_WS.fn_pop","addClass":"","innerDisabled":"false"}'
								toolbar_grid_button2='{"position":"right","id":"btn_del","label":"선택삭제","onclick":"moca.EFC_BOARD_WS.fn_delList","addClass":"","innerDisabled":"false"}'
								toolbar_grid_button3='{"position":"right","id":"btn_del_admin","label":"선택물리삭제","onclick":"moca.EFC_BOARD_WS.fn_adminDelList","innerStyle":"background:#5c83a6","innerDisabled":"false", mobileHide="true"}'
                                toolbar_grid_label_span1='{"position":"left","id":"supportN","label":"요청","value":"","valueClass":"txt_green","unit":"건"}'
								toolbar_grid_label_span2='{"position":"left","id":"supportR","label":"접수","value":"","valueClass":"txt_green","unit":"건"}'
								toolbar_grid_label_span3='{"position":"left","id":"supportY","label":"완료","value":"","valueClass":"txt_green","unit":"건"}'
								toolbar_grid_label_span4='{"position":"left","id":"supportB","label":"반려","value":"","valueClass":"txt_green","unit":"건"}'
                                onBeforeClick="moca.EFC_BOARD_WS.fn_check_before"
                                onAfterClick="moca.EFC_BOARD_WS.fn_check_after"
                                onDblClick = "moca.EFC_BOARD_WS.grd_1__onDblClick"
								label="게시물"
			
			>
					<table style="width: 100%">
						<colgroup>
								<col style="width:30px" mobileHide="true" hide="false" columnKey="chk" thKey="H_chk" >
								<col style="width:60px" mobileHide="true" hide="false" columnKey="BOARD_PIDX" thKey="H_BOARD_PIDX">
								<col style="min-width:300px" mobileHide="false"  hide="false" columnKey="BOARD_TITLE" thKey="H_BOARD_TITLE">
								<col style="width:40px" mobileHide="true"  hide="false" columnKey="CNT" thKey="H_BOARD_FILECNT">
								<col style="width:100px" mobileHide="true"  hide="false" columnKey="BOARD_WRITER" thKey="H_BOARD_WRITER">
								<col style="width:150px" mobileHide="true"  hide="false" columnKey="BOARD_DATE" thKey="H_BOARD_DATE">
								<col style="width:100px" mobileHide="true"  hide="false" columnKey="BOARD_RECEIPTIONER" thKey="H_BOARD_RECEIPTIONER">	
						</colgroup>
						<thead>
							<tr>
								<th scope="col" celltype="checkbox" id="H_chk" targetId="chk">선택</th>
								<th scope="col" id="H_BOARD_PIDX">ID</th>
								<th scope="col" id="H_BOARD_TITLE">제목</th>
								<th scope="col" id="H_BOARD_FILECNT">첨부</th>
								<th scope="col" id="H_BOARD_WRITER"  filterable="true" filterableId="BOARD_WRITER">작성자</th>
								<th scope="col" id="H_BOARD_DATE">작성일시</th>
								<th scope="col" id="H_BOARD_RECEIPTIONER"  filterable="true" filterableId="BOARD_RECEIPTIONER">접수자</th>
								<!--<th scope="col" id="H_BOARD_BTN">버튼</th>-->
							</tr>
						</thead>
						<tbody>
							<tr>
								<td id="chk" celltype="checkbox" style="" trueValue="1" falseValue="0" name="선택" disabledFunction="moca.EFC_BOARD_WS.disabled" ></td>
								<!--<td id="BOARD_TYPE" celltype="input" style="text-align:center" name="ID" readOnly="true"></td> -->
								<!--
								<td id="BOARD_PHONE" 
								celltype="input" 
								keyMask="onlyPhone" style="text-align:left" name="연락처테스트" readOnly="false"
								displayFunction="moca.cellPhone" 
								displayFunctionApply="realtime"
								maxLength="13"
								></td>-->
								<td id="BOARD_PIDX" celltype="input" style="text-align:center" name="부모ID" readOnly="true"></td>
								<td id="BOARD_TITLE" celltype="input" style="text-align:left" name="제목" readOnly="true" displayFunction="moca.EFC_BOARD_WS.dispReply"></td>
								<td id="CNT" celltype="input" style="" name="첨부" readOnly="true" displayFunction="moca.EFC_BOARD_WS.dispCnt"></td>
								<td id="BOARD_WRITER" celltype="input" style="text-align:center" name="작성자" readOnly="true"></td>
								<td id="BOARD_DATE" celltype="input" style="" name="작성일" readOnly="true" displayFunction="moca.longToDate"></td>
								<td id="BOARD_RECEIPTIONER" celltype="input" style="text-align:center" name="접수자" readOnly="true"></td>
								<!--<td id="delBtn" name="삭제"  celltype="button" readonly="false" required="false" addRowEditable="false" callFunction="moca.TO_000P01.fn_onBtnClick" btnLabel="삭제"></td>-->
							</tr>
						</tbody>
					</table>				
			</div>
		</div>	
	</div>
</div>
</body>
</html>