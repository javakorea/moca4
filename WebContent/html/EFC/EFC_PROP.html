<!DOCTYPE html>
<html lang="ko">
<head>
<script>
	
	$m.EFC_PROP.___ready = function(){
		$m.EFC_PROP.code({
			"grd_1.useAt":{code:'EFC001'},
			"cmb_1":{code:'boardStatus'},
			"scmb_1":{code:'boardStatus'}
		},function(){
			$m.EFC_PROP.exe({
				url : $m._domain+$m._contextRoot+"/efms/EFC_CORP/list_json.do",
				loadingbar:true,
	            data : {
	            	"header" : $m.header,
	            	"body" : {aaa:'111',bbb:'222'}
	            },			
				callback : function(response){
					var g_obj = $m.EFC_PROP.getObj('grd_1');
					if(g_obj['CORP_CD'] == undefined){
						g_obj['CORP_CD'] = {};
						g_obj['CORP_CD']['codeOpt'] = {allOption:{label:'-선택-',value:''},metaInfo:{codeCd:"CORP_CD",codeNm:"CORP_NM"}};
					} 
					g_obj['CORP_CD']['list'] = response.list;
					$m.EFC_PROP.fn_search();
				}
			});				
		});
	};
	
	$m.EFC_PROP.fn_search = function(){
		$m.EFC_PROP.exe({
			url : $m._domain+$m._contextRoot+"/efms/EFGPROP/list_json.do",
            data : {
            	"header" : $m.header,
            	"body" : {PROP_KEY:$m.getValue($m.EFC_PROP.getObj( "PROP_KEY"))}
            },			
			callback : function(response){
				$m.EFC_PROP.drawGrid('grd_1', $m.EFC_PROP.getResList(response,"list"));
			}
		});
	};
	$m.EFC_PROP.fn_exe = function(){
		if($m.EFC_PROP.validate("grd_1","status","C,U,D")){
			$m.confirm('저장하시겠습니까?',function(result){
				if(result == 'Y'){
					$m.EFC_PROP.exe({
						url : $m._domain+$m._contextRoot+"/efms/EFGPROP/modify_json.do",
			            data : {
			            	"header" : $m.header,
			            	"body" : {
			            		paramList:$m.EFC_PROP.getFilteredList("grd_1","status","C,U,D")
			            	}
			            },		
						callback : function(){
			        	   $m.alert('성공적으로 저장되었습니다!',function(){
			        		   $m.EFC_PROP.fn_search();
			        	   	   return;
			        	   });	
						}
					});
				}
			});
		}
	};
	
	
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	
	$m.EFC_PROP._openFileUpload = function() {
		$m.popup({
			type:"POPUP",
			modal:"false",
			url:'/moca/comp/COMP_UPLD.html',
			title:"파일업로드",
			callback:function(result){
				var fileSize = result.fileSize
				var fileLength = result.fileLength
				var originalFilename = result.originalFilename
				var physicalFilename = result.physicalFilename
				var physicalFilepath = result.physicalFilepath
				var subDir = result.subDir
				var uploadDir = result.uploadDir
			},
			data:{
				subDir:"EFC_PROP",
				onFileSelected:"$m.EFC_PROP.onFileSelected"
			}
		});
	};
	$m.EFC_PROP.onFileSelected = function(filename,filesize,_e,_this) {
		return true;//or false
	};	

	
	$m.EFC_PROP.selectSetter = function(prev_v,prev_t,after_v,after_t) {

	};	
	
</script>

</head>
<body>
	
<div id="moca_tab_bridge1" class="moca_tab_panel" role="mdipanel" style="display:block;visibility:visible;">
	<div class="moca_tab_cont" style="height:100%">
		<div class="moca_cont_wrap flex fcol">
			<div type="include" class="moca_titbox cm" id="titbox" tag="moca:titbox" 
				src="/html/titlebox.html"
				data = '{"sreenCd":"MOCA_PROP","sreenNm":"시스템설정","sreenPath":"시스템관리,시스템설정"}'
			></div>

			<div class="moca_shbox">
				<div class="shbox_inner">
					<div class="flex fwrap">
						<div class="tb">
							<span class="tb_th">설정키값</span>
							<span class="tb_td">
								<div type="input" id="PROP_KEY" keyMask="enterSearchEvt" class="mocaInput sh"  style=""  disabled="false" readonly="false"></div>
							</span>
						</div>
						<div class="tb">
							<span class="tb_th">모카콤보</span>
							<span class="tb_td">
								<div type="combo" 
									id="cmb_1" 
									class="moca_combo" 
									style="width:165px" 
									displayFormat="[label]" 
									cdField="code" 
									nmField="codeNm"
								>
								</div>
								
							</span>
						</div>
						<div class="tb">
							<span class="tb_th">서치콤보</span>
							<span class="tb_td">
								<div type="searchCombo" 
									id="scmb_1" 
									class="moca_searchCombo" 
									inneronchange="$m.EFC_PROP.selectSetter(this)" 
									style="width:165px" 
									readOnly="false"
									displayFormat="[label]" 
									cdField="code" 
									nmField="codeNm"   
									itemset='[{"cd":"0","nm":"해당없음 "},{"cd":"1","nm":"(%)비율"},{"cd":"2","nm":"(원)금액"},{"cd":"3","nm":"(원)금액3"},{"cd":"4","nm":"(원)금액4"},{"cd":"5","nm":"(원)금액5"},{"cd":"6","nm":"(원)금액6"},{"cd":"7","nm":"(원)금액7"},{"cd":"8","nm":"(원)금액8"},{"cd":"9","nm":"(원)금액9"},{"cd":"10","nm":"(원)금액10"},{"cd":"11","nm":"(원)금액11"},{"cd":"12","nm":"(원)금액12"}]'>
								</div>
							</span>
						</div>
					</div>
				</div>
				<div class="btn_shbox">
					<button type="button" class="button btn_sc" onclick="$m.EFC_PROP.fn_search(this)"><i class="fas fa-search"></i><span>조회</span></button>
					<button type="button" class="button btn_sc" style="display:none" onclick="$m.EFC_PROP._openFileUpload(this)"><i class="fas fa-search"></i><span>파일첨부</span></button>
				</div>
			</div>
			<div type="grid" class="moca_grid toolbar fauto mt12" default_cell_height="26px" id="grd_1" rowSelectedColor="#434e5f"
			
								toolbar_search_size="false"
								toolbar_detail="true"
								toolbar_exup="false"
								toolbar_exdn="true"
								toolbar_addrow="true"
								toolbar_delrow="false"
								toolbar_nextbtn="false"
								toolbar_full="true"
								
								toolbar_grid_button1='{"position":"right","id":"btn_save","label":"저장","onclick":"$m.EFC_PROP.fn_exe","addClass":"","innerDisabled":"false"}'

								label="시스템설정목록"
			
			>
					<table style="width: 100%">
						<colgroup>
								<col style="width:60px" mobileHide="true" hide="false" columnKey="status" thKey="H_status" >
								<col style="width:20%" mobileHide="false" hide="false" columnKey="CORP_CD" thKey="H_CORP_CD" >
								<col style="width:30%" mobileHide="false" hide="false" columnKey="PROP_KEY" thKey="H_PROP_KEY" >
								<col style="width:45%" mobileHide="false" hide="false" columnKey="PROP_VALUE" thKey="H_PROP_VALUE" >		
								<col style="" mobileHide="true" hide="false" columnKey="ETC" thKey="H_ETC" >								
						</colgroup>
						<thead>
							<tr>
								<th scope="col" id="H_status">상태</th>
								<th scope="col" id="H_CORP_CD">법인</th>
								<th scope="col" id="H_PROP_KEY">key</th>
								<th scope="col" id="H_PROP_VALUE">value</th>
								<th scope="col" id="H_ETC">설명</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td id="status" celltype="input" style="" readOnly="true" name="상태"></td>
								<td id="CORP_CD" celltype="select" style="text-align:center" required="true" name="법인" readOnly="true"></td>
								<td id="PROP_KEY" celltype="input" style="text-align:left" required="true" name="key" readOnly="true"></td>
								<td id="PROP_VALUE" celltype="input" style="" required="true" name="value"></td>
								<td id="ETC" celltype="input" style="" name="설명"></td>
							</tr>
						</tbody>
					</table>				
			</div>
		</div>	
	</div>
</div>
</body>
</html>