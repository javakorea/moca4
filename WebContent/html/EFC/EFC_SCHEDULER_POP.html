<!DOCTYPE html>
<html lang="ko">
<head meta_width="800px" meta_height="600px">
<script>
moca.EFC_SCHEDULER_POP.start;
moca.EFC_SCHEDULER_POP.end;
moca.EFC_SCHEDULER_POP.allDay;
moca.EFC_SCHEDULER_POP.schIdx;
moca.EFC_SCHEDULER_POP.___ready = function(args){
	moca.hide(moca.EFC_SCHEDULER_POP.getObj("form_schedule"));
	moca.hide(moca.EFC_SCHEDULER_POP.getObj("btn_update"));
	moca.hide(moca.EFC_SCHEDULER_POP.getObj("btn_save"));
	$(moca.EFC_SCHEDULER_POP.getObj("form_schedule")).find("#createInfo").hide();
    if(args != null){
    	moca.EFC_SCHEDULER_POP.args = args;
        moca.EFC_SCHEDULER_POP.start = args.parent.data.start;
        moca.EFC_SCHEDULER_POP.end = args.parent.data.end;
        moca.EFC_SCHEDULER_POP.setFrom('schDate',args.parent.data.start);
        moca.EFC_SCHEDULER_POP.setTo('schDate',args.parent.data.end);
        moca.EFC_SCHEDULER_POP.schIdx = args.parent.data.schIdx;
	}
    CKEDITOR.replace( 'editor',{uiColor:'#deecea',on:{
        'instanceReady':function(ev){
        	moca.EFC_SCHEDULER_POP.editor = ev.editor;
        	if(moca.trim(moca.EFC_SCHEDULER_POP.schIdx) != ''){
        		moca.EFC_SCHEDULER_POP.editor.setReadOnly(true);
        		$(moca.EFC_SCHEDULER_POP.getObj("cke_editor")).find("[id$='_top']").hide();
        		moca.setReadOnly(moca.EFC_SCHEDULER_POP.getObj("wtitle"),true);
        		moca.setReadOnly(moca.EFC_SCHEDULER_POP.getObj("schDate"),true);
        		moca.show(moca.EFC_SCHEDULER_POP.getObj("btn_update"));
        		$(moca.EFC_SCHEDULER_POP.getObj("form_schedule")).find("#createInfo").show();
        		moca.show(moca.EFC_SCHEDULER_POP.getObj("form_schedule"));
        		moca.EFC_SCHEDULER_POP.fn_search();
        	}else{
        		moca.show(moca.EFC_SCHEDULER_POP.getObj("btn_save"));
        		moca.show(moca.EFC_SCHEDULER_POP.getObj("form_schedule"));
        	}
        	
    }}} );
};

moca.EFC_SCHEDULER_POP.fn_search = function(_grd,_idx,tdObj,_thisObj){
	moca.EFC_SCHEDULER_POP.exe({
		url : moca._domain+moca._contextRoot+"/EFC_SCHEDULER/selectScheduleInfo.do",
		loadingbar:true,
		data : {
			"header" : moca.header,
			"body" : {
				"SCH_IDX":moca.EFC_SCHEDULER_POP.schIdx
				}
		},			
		callback : function(response){
			if(response.selectScheduleInfo != null){
				var data = response.selectScheduleInfo;
				CKEDITOR.instances.editor.setData(data.SCH_CONT);
				moca.setValue(moca.EFC_SCHEDULER_POP.getObj("wtitle"),data.SCH_TITLE);
				moca.setValue(moca.EFC_SCHEDULER_POP.getObj("createDate"),data.SCH_CREATE_DTTM);
				moca.setValue(moca.EFC_SCHEDULER_POP.getObj("wid"),data.SCH_WRITER);
			}else{
				moca.error(response.error);
			}
		}
	});
};



moca.EFC_SCHEDULER_POP.fn_update = function(_thisObj){
	moca.show(moca.EFC_SCHEDULER_POP.getObj("btn_save"));
	moca.hide(moca.EFC_SCHEDULER_POP.getObj("btn_update"));
	
	moca.EFC_SCHEDULER_POP.editor.setReadOnly(false);
	$(moca.EFC_SCHEDULER_POP.getObj("cke_editor")).find("[id$='_top']").show();
	moca.setReadOnly(moca.EFC_SCHEDULER_POP.getObj("wtitle"),false);
	moca.setReadOnly(moca.EFC_SCHEDULER_POP.getObj("schDate"),false);

}
moca.EFC_SCHEDULER_POP.fn_save = function(_thisObj){
	if(_thisObj.id == 'btn_save'){
		moca.confirm('저장하시겠습니까?',function(result){
	        if(result == 'Y'){
	        	var wtitle = moca.getValue(moca.EFC_SCHEDULER_POP.getObj("wtitle"));
            	if(wtitle == ''){
            		wtitle = $('#'+CKEDITOR.instances.editor.id+'_contents iframe').contents().find('body').text().substring(0,20);
            	}
            	
            	if(moca.trim(moca.EFC_SCHEDULER_POP.schIdx) == ''){
            		//스케줄등록
    	        	moca.EFC_SCHEDULER_POP.exe({
    	        	    url : moca._domain+moca._contextRoot+"/EFC_SCHEDULER/insertSchedule.do",
    	        	    loadingbar:true,
    	        	    data : {
    	        	        "header" : moca.header,
    	        	        "body" : {
    	        	        	"SCH_CATEGORY":"PRIVATE",
    	        	        	"SCH_WRITER":moca.getSs("USER_ID"),
    	        	        	"SCH_TITLE":wtitle,
    	        	            "SCH_CONT":CKEDITOR.instances.editor.getData(),
    	        	            "SCH_CURRENTMONTH":dateLib.getToday().substr(4,2),
    	        	        	"SCH_START":moca.EFC_SCHEDULER_POP.getFrom('schDate'),
    	        	        	"SCH_END":moca.EFC_SCHEDULER_POP.getTo('schDate'),
    	        	        }
    	        	    },          
    	        	    callback : function(response){
    	        	        if(response.cnt > 0){
    	        	            moca.popClose(moca.EFC_SCHEDULER_POP.pageId,{callback:"true",message:"성공적으로 저장하였습니다."});
    	        	        }
    	        	    }
    	        	});
            	}else{
            		//스케줄수정
    	        	moca.EFC_SCHEDULER_POP.exe({
    	        	    url : moca._domain+moca._contextRoot+"/EFC_SCHEDULER/updateScheduleInfo.do",
    	        	    loadingbar:true,
    	        	    data : {
    	        	        "header" : moca.header,
    	        	        "body" : {
    	        	        	"SCH_IDX":moca.EFC_SCHEDULER_POP.schIdx,
    	        	        	"SCH_CATEGORY":"PRIVATE",
    	        	        	"SCH_WRITER":moca.getSs("USER_ID"),
    	        	        	"SCH_TITLE":wtitle,
    	        	            "SCH_CONT":CKEDITOR.instances.editor.getData(),
    	        	        	"SCH_START":moca.EFC_SCHEDULER_POP.getFrom('schDate'),
    	        	        	"SCH_END":moca.EFC_SCHEDULER_POP.getTo('schDate'),
    	        	        	"SCH_DELYN":"N"
    	        	        }
    	        	    },          
    	        	    callback : function(response){
    	        	        if(response.cnt > 0){
    	        	            moca.popClose(moca.EFC_SCHEDULER_POP.pageId,{callback:"true",message:"성공적으로 저장하였습니다."});
    	        	        }
    	        	    }
    	        	});
            	}
	        }
		})
	}
};
moca.EFC_SCHEDULER_POP.fn_del = function(_thisObj){
	['스케줄러논리삭제 delYN :Y']
	 moca.confirm('삭제하시겠습니까?',function(result){
        if(result == 'Y'){
        	//게시글삭제
         	moca.EFC_SCHEDULER_POP.exe({
                 url : moca._domain+moca._contextRoot+"/EFC_SCHEDULER/deleteScheduleInfo.do",
                 loadingbar:true,
                 data : {
                     "header" : moca.header,
                     "body" : {
                    	 "SCH_IDX":moca.EFC_SCHEDULER_POP.schIdx,
                         }
                 },          
                 callback : function(response){
                     if(response.cnt > 0){
                        moca.popClose(moca.EFC_SCHEDULER_POP.pageId,{callback:"true",message:"삭제가 완료되었습니다."});
                     }
                 }
             });
        }
	 });
};
</script>
<style>
</style>
</head>
<body>
	<div class="moca_pop_cont_wrap flex mobile" style="min-width:unset" id="contents">
        <div class="lybox flex fauto">
            <div class="ly_column col_5 fauto">
                <div class="ly_col_cont flex fcol">
			         <div type="form" id="form_schedule" class="moca_table toolbar" style=""
			                label=""
			                showRowSelection="false"
			                addition='[
			              		{"type":"button","position":"right","id":"btn_save","label":"저장","onclick":"moca.EFC_SCHEDULER_POP.fn_save","innerStyle":"background:#97a2ba"},
			              		{"type":"button","position":"right","id":"btn_update","label":"수정","onclick":"moca.EFC_SCHEDULER_POP.fn_update","innerStyle":"background:#97a2ba"},
			              		{"type":"button","position":"right","id":"btn_del","label":"삭제","onclick":"moca.EFC_SCHEDULER_POP.fn_del","innerStyle":"background:#6d7993"}
			                ]'
			         >
			                <div class="scrollX_area">
			                    <table class="moca_table_cont" style="">
			                    	<caption style="display:none;visibility:hidden; overflow:hidden; width:0;height:0;font-size:0;line-height:0"></caption>
			                        <colgroup>
			                                <col style="width:50px">
			                                <col style="min-width:140px">
			                                <col style="width:50px">
			                                <col style="min-width:140px">
			                        </colgroup>
			                        <tbody>
			                        	<tr id="createInfo">
			                            	<th>작성일</th>
			                                <td>
			                                	<div type="input" id="createDate" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
			                                </td>
			                                <th>작성자</th>
			                                <td>
			                                	<div type="input" id="wid" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
			                                </td>
			                            </tr>
			                            <tr>
			                            	<th>기간</th>
			                                <td colspan="3">
			                                	<div type="inputMultiCalendar" class="moca_ica fl" style="width:auto" id="schDate" displayFormat="####-##-## ##:##" 
						                               defaultValue="12개월전" 
						                               selecterItem="오늘,3일전,6일전"
						                               showRadioOption="false"
						                               maxTermByDay="365"
						                         ></div>
			                                </td>
			                            </tr>
			                            <tr>
			                            	<th>제목</th>
			                                <td colspan="3">
			                                    <div type="input" id="wtitle" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="false"></div>
			                                </td>
			                            </tr> 
			                        </tbody>
			                    </table>
			              </div>      
			        </div>
			        <div class="mt5 edit fit"  style="top:0">
			            <div contenteditable="true" placeholder="" id="editor"></div>
			        </div>
                </div>
            </div>
        </div>
	</div>
</body>
</html>