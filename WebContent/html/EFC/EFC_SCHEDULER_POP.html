<!DOCTYPE html>
<html lang="ko">
<head meta_width="807px" meta_height="600px">
<script>
$m.EFC_SCHEDULER_POP.start;
$m.EFC_SCHEDULER_POP.end;
$m.EFC_SCHEDULER_POP.allDay;
$m.EFC_SCHEDULER_POP.schIdx;
$m.EFC_SCHEDULER_POP.___ready = function(args){
	if($m.getDevice() == "mobile"){
		$m.hide($m.EFC_SCHEDULER_POP.getObj("schTitle"));
		//$('#form_schedule').css('height','57px');
		$($m.EFC_SCHEDULER_POP.getObj("wtitle")).css('width','calc(100% - 45px)');
	}
	$m.hide($m.EFC_SCHEDULER_POP.getObj("form_schedule"));
	$m.hide($m.EFC_SCHEDULER_POP.getObj("btn_update"));
	$m.hide($m.EFC_SCHEDULER_POP.getObj("btn_save"));
	$m.hide($m.EFC_SCHEDULER_POP.getObj("btn_del"));
	$m.hide($m.EFC_SCHEDULER_POP.getObj("wcolor"));
	//$($m.EFC_SCHEDULER_POP.getObj("form_schedule")).find("#createInfo").hide();
    if(args != null){
    	$m.EFC_SCHEDULER_POP.args = args;
        $m.EFC_SCHEDULER_POP.start = args.parent.data.start;
        $m.EFC_SCHEDULER_POP.end = args.parent.data.end;
        $m.EFC_SCHEDULER_POP.setFrom('schDate',args.parent.data.start);
        $m.EFC_SCHEDULER_POP.setTo('schDate',args.parent.data.end);
        $m.EFC_SCHEDULER_POP.schIdx = args.parent.data.schIdx;
        $m.EFC_SCHEDULER_POP.viewType = args.parent.data.viewType;
        $m.EFC_SCHEDULER_POP.bgcolor =  args.parent.data.bgcolor;
	}
    CKEDITOR.replace( 'editor',{uiColor:'#deecea',on:{
        'instanceReady':function(ev){
        	$m.EFC_SCHEDULER_POP.editor = ev.editor;
        	if($m.trim($m.EFC_SCHEDULER_POP.schIdx) != ''){
        		$m.EFC_SCHEDULER_POP.editor.setReadOnly(true);
        		$($m.EFC_SCHEDULER_POP.getObj("cke_editor")).find("[id$='_top']").hide();
        		$m.setReadOnly($m.EFC_SCHEDULER_POP.getObj("wtitle"),true);
        		$m.setReadOnly($m.EFC_SCHEDULER_POP.getObj("schDate"),true);
        		$m.show($m.EFC_SCHEDULER_POP.getObj("btn_update"));
        		//$($m.EFC_SCHEDULER_POP.getObj("form_schedule")).find("#createInfo").show();
        		$m.show($m.EFC_SCHEDULER_POP.getObj("form_schedule"));
        		$m.show($m.EFC_SCHEDULER_POP.getObj("btn_del"));
        		$m.EFC_SCHEDULER_POP.fn_search();
        		$m.setValue($m.EFC_SCHEDULER_POP.getObj('wcolor'),$m.EFC_SCHEDULER_POP.bgcolor);
        	}else{
        		$m.show($m.EFC_SCHEDULER_POP.getObj("btn_save"));
        		$m.show($m.EFC_SCHEDULER_POP.getObj("form_schedule"));
        		$m.show($m.EFC_SCHEDULER_POP.getObj("wcolor"));
        		var _today = new Date();
        		var _todayStr = $m.dateToString(_today).fullFormat;
        		$m.setValue($m.EFC_SCHEDULER_POP.getObj("createDate"),_todayStr);
				$m.setValue($m.EFC_SCHEDULER_POP.getObj("wid"),$m.getSs("USER_ID"));
        	}
        	
    }}} );
};

$m.EFC_SCHEDULER_POP.fn_search = function(_grd,_idx,tdObj,_thisObj){
	$m.EFC_SCHEDULER_POP.exe({
		url : $m._domain+$m._contextRoot+"/EFC_SCHEDULER/selectScheduleInfo.do",
		loadingbar:true,
		data : {
			"header" : $m.header,
			"body" : {
				"SCH_IDX":$m.EFC_SCHEDULER_POP.schIdx,
				"CORP_CD":$m.getSs("CORP_CD")
				}
		},			
		callback : function(response){
			if(response.selectScheduleInfo != null){
				var data = response.selectScheduleInfo;
				CKEDITOR.instances.editor.setData(data.SCH_CONT);
				$m.setValue($m.EFC_SCHEDULER_POP.getObj("wtitle"),data.SCH_TITLE);
				$m.setValue($m.EFC_SCHEDULER_POP.getObj("createDate"),data.SCH_CREATE_DTTM);
				$m.setValue($m.EFC_SCHEDULER_POP.getObj("wid"),data.SCH_WRITER);
			}else{
				$m.error(response.error);
			}
		}
	});
};



$m.EFC_SCHEDULER_POP.fn_update = function(_thisObj){
	$m.show($m.EFC_SCHEDULER_POP.getObj("btn_save"));
	$m.hide($m.EFC_SCHEDULER_POP.getObj("btn_update"));
	$m.show($m.EFC_SCHEDULER_POP.getObj("wcolor"));
	$m.EFC_SCHEDULER_POP.editor.setReadOnly(false);
	$($m.EFC_SCHEDULER_POP.getObj("cke_editor")).find("[id$='_top']").show();
	$m.setReadOnly($m.EFC_SCHEDULER_POP.getObj("wtitle"),false);
	$m.setReadOnly($m.EFC_SCHEDULER_POP.getObj("schDate"),false);

}
$m.EFC_SCHEDULER_POP.fn_save = function(_thisObj){
	if(_thisObj.id == 'btn_save'){
		$m.confirm('저장하시겠습니까?',function(result){
	        if(result == 'Y'){
	        	var wtitle = $m.getValue($m.EFC_SCHEDULER_POP.getObj("wtitle"));
            	if(wtitle == ''){
            		wtitle = $('#'+CKEDITOR.instances.editor.id+'_contents iframe').contents().find('body').text().substring(0,20);
            	}
            	
            	if($m.trim($m.EFC_SCHEDULER_POP.schIdx) == ''){
            		//스케줄등록
    	        	$m.EFC_SCHEDULER_POP.exe({
    	        	    url : $m._domain+$m._contextRoot+"/EFC_SCHEDULER/insertSchedule.do",
    	        	    loadingbar:true,
    	        	    data : {
    	        	        "header" : $m.header,
    	        	        "body" : {
    	        	        	"SCH_CATEGORY":"PRIVATE",
    	        	        	"SCH_WRITER":$m.getSs("USER_ID"),
    	        	        	"SCH_TITLE":wtitle,
    	        	            "SCH_CONT":CKEDITOR.instances.editor.getData(),
    	        	            "SCH_CREATE_DTTM":$m.getValue($m.EFC_SCHEDULER_POP.getObj("createDate")),
    	        	            "SCH_CURRENTMONTH":$m.EFC_SCHEDULER_POP.getFrom('schDate').substr(5,2),
    	        	        	"SCH_START":$m.EFC_SCHEDULER_POP.getFrom('schDate'),
    	        	        	"SCH_END":$m.EFC_SCHEDULER_POP.getTo('schDate'),
    	        	        	"SCH_COLOR":$m.getValue($m.EFC_SCHEDULER_POP.getObj('wcolor')),
    	        	        	"CORP_CD":$m.getSs("CORP_CD")
    	        	        }
    	        	    },          
    	        	    callback : function(response){
    	        	        if(response.cnt > 0){
    	        	            $m.popClose($m.EFC_SCHEDULER_POP.pageId,{callback:"true",message:"성공적으로 저장하였습니다.",viewType:$m.EFC_SCHEDULER_POP.viewType,startDt:$m.EFC_SCHEDULER_POP.getFrom('schDate')});
    	        	        }
    	        	    }
    	        	});
            	}else{
            		//스케줄수정
    	        	$m.EFC_SCHEDULER_POP.exe({
    	        	    url : $m._domain+$m._contextRoot+"/EFC_SCHEDULER/updateScheduleInfo.do",
    	        	    loadingbar:true,
    	        	    data : {
    	        	        "header" : $m.header,
    	        	        "body" : {
    	        	        	"SCH_IDX":$m.EFC_SCHEDULER_POP.schIdx,
    	        	        	"SCH_CATEGORY":"PRIVATE",
    	        	        	"SCH_WRITER":$m.getSs("USER_ID"),
    	        	        	"SCH_TITLE":wtitle,
    	        	            "SCH_CONT":CKEDITOR.instances.editor.getData(),
    	        	        	"SCH_START":$m.EFC_SCHEDULER_POP.getFrom('schDate'),
    	        	        	"SCH_END":$m.EFC_SCHEDULER_POP.getTo('schDate'),
    	        	        	"SCH_DELYN":"N",
    	        	        	"SCH_COLOR":$m.getValue($m.EFC_SCHEDULER_POP.getObj('wcolor'))
    	        	        }
    	        	    },          
    	        	    callback : function(response){
    	        	        if(response.cnt > 0){
    	        	            $m.popClose($m.EFC_SCHEDULER_POP.pageId,{callback:"true",message:"성공적으로 저장하였습니다.",viewType:$m.EFC_SCHEDULER_POP.viewType,startDt:$m.EFC_SCHEDULER_POP.getFrom('schDate')});
    	        	        }
    	        	    }
    	        	});
            	}
	        }
		})
	}
};
$m.EFC_SCHEDULER_POP.fn_del = function(_thisObj){
	['스케줄러논리삭제 delYN :Y']
	 $m.confirm('삭제하시겠습니까?',function(result){
        if(result == 'Y'){
        	//게시글삭제
         	$m.EFC_SCHEDULER_POP.exe({
                 url : $m._domain+$m._contextRoot+"/EFC_SCHEDULER/deleteScheduleInfo.do",
                 loadingbar:true,
                 data : {
                     "header" : $m.header,
                     "body" : {
                    	 "SCH_IDX":$m.EFC_SCHEDULER_POP.schIdx,
                         }
                 },          
                 callback : function(response){
                     if(response.cnt > 0){
                        $m.popClose($m.EFC_SCHEDULER_POP.pageId,{callback:"true",message:"삭제가 완료되었습니다."});
                     }
                 }
             });
        }
	 });
};
</script>
<style>
</style>
</head>
<body>
	<div class="moca_pop_cont_wrap flex mobile" style="min-width:unset" id="contents">
        <div class="lybox flex fauto">
            <div class="ly_column col_5 fauto">
                <div class="ly_col_cont flex fcol">
			         <div type="form" id="form_schedule" class="moca_table toolbar" style=""
							label=""
							showRowSelection="false"
							addition='[
								{"type":"button","position":"right","id":"btn_save","label":"저장","onclick":"$m.EFC_SCHEDULER_POP.fn_save","innerStyle":"background:#97a2ba"},
								{"type":"button","position":"right","id":"btn_update","label":"수정","onclick":"$m.EFC_SCHEDULER_POP.fn_update","innerStyle":"background:#97a2ba"},
								{"type":"button","position":"right","id":"btn_del","label":"삭제","onclick":"$m.EFC_SCHEDULER_POP.fn_del","innerStyle":"background:#6d7993"}
							]'
					 >
						
						
						<div class="moca_table_cont" type="table">
							<div type="tbody">
								<div type="tr">
									<div type="th">일정기간</div>
									<div type="td">
										 <div type="inputMultiCalendar" class="moca_ica fl" style="width:calc(100% - 2px)" id="schDate" displayFormat="####-##-## ##:##" 
											   defaultValue="12개월전" 
											   selecterItem="오늘,3일전,6일전"
											   showRadioOption="false"
											   maxTermByDay="365"
										 ></div>
									</div>
								</div>
								<div type="tr">
									<div type="th">작성일시</div>
									<div type="td">
										<div type="input" id="createDate" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
									</div>
								</div>
								<div type="tr">
									<div type="th">작성자명</div>
									<div type="td">
										<div type="input" id="wid" class="mocaInput" innerClass="" onclick="" style="" value="" readonly="true"></div>
									</div>
								</div>
								<div type="tr">
									<div type="th">일정제목</div>
									<div type="td">
										<div type="input" id="wtitle" class="mocaInput fl" innerClass="" onclick="" style="width:300px;" value="" readonly="false"></div>
								        <input type="color" id="wcolor" class="moca_input_color" value="#3788d8">
									</div>
								</div>    
							</div>
						</div>
					</div>
			        <div class="mt5 edit fit"  style="top:0">
			            <div contenteditable="true" placeholder="" id="editor"></div>
			        </div>
                </div>
            </div>
        </div>
	</div>
</body>
</html>