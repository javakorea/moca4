<!DOCTYPE html>
<html lang="ko">
<head>
<script>
moca.TO_001.defaultTabIndex = 1;
moca.TO_001.___ready = function(args){
	moca.TO_001.separatedMapClear();
	clearInterval(moca.TO_001.polling_id);
	moca.TO_001.sendParam('t0',moca.TO_001.defaultTabIndex);
	moca.TO_001.audio =  new Audio(moca._domain+moca._contextRoot+'/sound/sound.mp3');
};




moca.TO_001.getTabText = function(_tabContentId){
	var a = $(moca.TO_001.getObj("tab_TO001")).find("#"+_tabContentId +">button").text();
	var b = $(moca.TO_001.getObj("tab_TO001")).find("#"+_tabContentId +">button>i").text();
	var rg = new RegExp(b);
	return a.replace(rg,"");
};

moca.TO_001.separatedMapClear = function(){
	moca.TO_001.separatedMap = {};
	moca.TO_001.separatedMap["전체"] = [];
	moca.TO_001.separatedMap["취소"] = [];
	moca.TO_001.separatedMap["고객정보오류"] = [];
	moca.TO_001.separatedMap["이전신청오류"] = [];
	moca.TO_001.separatedMap["인증오류"] = [];
	moca.TO_001.separatedMap["인증진행중"] = [];
	moca.TO_001.separatedMap["인증통합"] = [];
	moca.TO_001.separatedMap["고객결제"] = [];
	moca.TO_001.separatedMap["공단입금"] = [];
	moca.TO_001.separatedMap["결제준비중"] = [];
	moca.TO_001.separatedMap["이전등록대기"] = [];
	moca.TO_001.separatedMap["이전등록오류"] = [];
	moca.TO_001.separatedMap["환급대상"] = [];
	moca.TO_001.separatedMap["환급처리완료"] = [];
	moca.TO_001.separatedMap["환급통합"] = [];
	moca.TO_001.separatedMap["결제오류"] = [];
};

moca.TO_001.sendParam = function(_tabContentId,_tabContentIndex,_tabContentObj){
	var tabIdIndex = _tabContentId.replace(/t/g,'');
	moca["TO_001S"+comLib.gfn_toTwoChar(tabIdIndex)].code({
		"grd_0.Stage":{code:"Stage",allOption:{label:'',value:''}}
	},function(){
		moca.TO_001.fn_search(_tabContentId);
		clearInterval(moca.TO_001.polling_id);
		moca.TO_001.polling_id = setInterval(function(){
			moca.TO_001.fn_search(null,'noshow');
		},10000);
	});
};

moca.TO_001.fn_search = function(_tabContentId,_progressbar){
	//var selectedIndex = moca.getSelectedTabIndex(moca.TO_001.getObj("tab_TO001"));
	var selectedId='';
	var inqType;
	if(_tabContentId != null){
		selectedId = _tabContentId;
	}else{
		selectedId = moca.getSelectedTabId(moca.TO_001.getObj("tab_TO001"));
	}
	var progressbar = true;
	if(_progressbar == 'noshow'){
		progressbar = false;
	}
	if(selectedId == null){
		return;
	}
	inqType = selectedId.substring(1);
	
	var chkg_1_val = moca.TO_001.getCheckbox("chkg_1").value;
	var chkg_2_val = moca.TO_001.getCheckbox("chkg_2").value;
	if(chkg_1_val == 0 && chkg_2_val ==0){
		return;
	}
	moca.TO_001.exe({
		url : moca._domain+moca._contextRoot+"/TO_001/admMngList.do",
		loadingbar:progressbar,
		data : {
			"header" : moca.header,
			"body" : {
				"inqType":inqType,
				"chkg_1":chkg_1_val+"",
				"chkg_2":chkg_2_val+"",
				"from":moca.TO_001.getFrom("CREATE_DTTM").replace(/-/g,''),
				"to":moca.TO_001.getTo("CREATE_DTTM").replace(/-/g,''),
				"searchTxt":moca.getValue(moca.TO_001.getObj("RegNumber"))
			}
		},			
		callback : function(response){
			var changeFlag = false;
			var redrawFlag = false;
			if(response.admMngList.length > 0){
				var a = JSON.stringify(moca.TO_001.separatedMap["전체"].slice(0,10));
				var b = JSON.stringify(response.admMngList.slice(0,10));
				if(a != b){
					changeFlag = true;
				}
			}
			if(response.admMngList != null 
					&& (moca.TO_001.separatedMap["전체"].length != response.admMngList.length || changeFlag) ){
				moca.TO_001.audio.play(); 
				moca.TO_001.separatedMapClear();
				var leng = response.admMngList.length;
				for(var i=0; i < leng; i++){
					var o = response.admMngList[i];
					moca.TO_001.separatedMap["전체"].push(o);
					if(o.Stage == '26'){
						moca.TO_001.separatedMap["취소"].push(o);
					}
					if(o.Stage == '126'){
						moca.TO_001.separatedMap["취소"].push(o);
					}
					if(o.Stage == '226'){
						moca.TO_001.separatedMap["취소"].push(o);
					}
					if(o.Stage == '8'){
						moca.TO_001.separatedMap["고객정보오류"].push(o);
					}
					if(o.Stage == '9'){
						moca.TO_001.separatedMap["고객정보오류"].push(o);
					}					
					if(o.Stage == '112'){
						moca.TO_001.separatedMap["이전신청오류"].push(o);
					}
					if(o.Stage == '212'){
						moca.TO_001.separatedMap["이전등록오류"].push(o);
					}						
					if(o.Stage == '1'){
						moca.TO_001.separatedMap["인증진행중"].push(o);
						moca.TO_001.separatedMap["인증통합"].push(o);
					}	
					if(o.Stage == '5'){//인증오류
						moca.TO_001.separatedMap["인증오류"].push(o);
						moca.TO_001.separatedMap["인증통합"].push(o);
					}	
					if(o.Stage == '10'){//고객미결제
						moca.TO_001.separatedMap["고객결제"].push(o);
					}
					if(o.Stage == '15'){//공단미입금
						moca.TO_001.separatedMap["공단입금"].push(o);
					}		
					if(o.Stage == '13'){//결제준비중
						moca.TO_001.separatedMap["결제준비중"].push(o);
					}						
					if(o.Stage == '27'){//결제준비중
						moca.TO_001.separatedMap["이전등록대기"].push(o);
					}
					if(o.Stage == '16'){//결제준비중
						moca.TO_001.separatedMap["이전등록대기"].push(o);
					}									
					if(o.Stage == '113'){//이전등록오류
						moca.TO_001.separatedMap["이전등록오류"].push(o);
					}		
					
					
					
					
					if(o.Stage == '17'){//환급(취소)
						moca.TO_001.separatedMap["환급처리완료"].push(o);
						moca.TO_001.separatedMap["환급통합"].push(o);
					}	
					if(o.Stage == '18'){//환급(완료)
						moca.TO_001.separatedMap["환급처리완료"].push(o);
						moca.TO_001.separatedMap["환급통합"].push(o);
					}	
					if(o.Stage == '19'){//환급(없음)
						moca.TO_001.separatedMap["환급처리완료"].push(o);
						moca.TO_001.separatedMap["환급통합"].push(o);
					}	
					if(o.Stage == '20'){//고객입금부족
						moca.TO_001.separatedMap["환급처리완료"].push(o);
						moca.TO_001.separatedMap["환급통합"].push(o);
					}				
					if(o.Stage == '21'){//카방계좌부족
						moca.TO_001.separatedMap["환급대상"].push(o);
						moca.TO_001.separatedMap["환급통합"].push(o);
					}	
					if(o.Stage == '22'){//환급오류
						moca.TO_001.separatedMap["환급대상"].push(o);
						moca.TO_001.separatedMap["환급통합"].push(o);
					}	
					if(o.Stage == '23'){//환급준비중
						moca.TO_001.separatedMap["환급대상"].push(o);
						moca.TO_001.separatedMap["환급통합"].push(o);
					}	
					if(o.Stage == '24'){
						moca.TO_001.separatedMap["결제오류"].push(o);
					}
					if(o.Stage == '25'){
						moca.TO_001.separatedMap["결제오류"].push(o);
					}			
				}
				if(moca.TO_001.separatedMap["전체"].length > 0){
					$(moca.TO_001.getObj("t0")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["전체"].length));
				}else{
					$(moca.TO_001.getObj("t0")).find('.tab_badge').css("visibility","hidden");
				}
				if(moca.TO_001.separatedMap["취소"].length > 0){
					$(moca.TO_001.getObj("t1")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["취소"].length));
				}else{
					$(moca.TO_001.getObj("t1")).find('.tab_badge').css("visibility","hidden");
				}	
				if(moca.TO_001.separatedMap["고객정보오류"].length > 0){
					$(moca.TO_001.getObj("t2")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["고객정보오류"].length));
				}else{
					$(moca.TO_001.getObj("t2")).find('.tab_badge').css("visibility","hidden");
				}
				if(moca.TO_001.separatedMap["이전신청오류"].length > 0){
					$(moca.TO_001.getObj("t3")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["이전신청오류"].length));
				}else{
					$(moca.TO_001.getObj("t3")).find('.tab_badge').css("visibility","hidden");
				}
				
				var error_cnt = 0;
				var ok_cnt = 0;
				if(moca.TO_001.separatedMap["인증진행중"].length > 0){
					ok_cnt = moca.TO_001.separatedMap["인증진행중"].length;
				}
				if(moca.TO_001.separatedMap["인증오류"].length > 0){
					error_cnt = moca.TO_001.separatedMap["인증오류"].length;
				}
				if(moca.TO_001.separatedMap["인증오류"].length == 0 && moca.TO_001.separatedMap["인증진행중"].length == 0 ){
					$(moca.TO_001.getObj("t4")).find('.tab_badge').css("visibility","hidden");

				}else{
					$(moca.TO_001.getObj("t4")).find('.tab_badge').css("visibility","visible").html(moca.comma(error_cnt)+"/"+moca.comma(ok_cnt));
				}			
				
				if(moca.TO_001.separatedMap["고객결제"].length > 0){
					$(moca.TO_001.getObj("t5")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["고객결제"].length));
				}else{
					$(moca.TO_001.getObj("t5")).find('.tab_badge').css("visibility","hidden");
				}
				if(moca.TO_001.separatedMap["공단입금"].length > 0){
					$(moca.TO_001.getObj("t6")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["공단입금"].length));
				}else{
					$(moca.TO_001.getObj("t6")).find('.tab_badge').css("visibility","hidden");
				}
				if(moca.TO_001.separatedMap["결제준비중"].length > 0){
					$(moca.TO_001.getObj("t7")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["결제준비중"].length));
				}else{
					$(moca.TO_001.getObj("t7")).find('.tab_badge').css("visibility","hidden");
				}	
				if(moca.TO_001.separatedMap["이전등록대기"].length > 0){
					$(moca.TO_001.getObj("t8")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["이전등록대기"].length));
				}else{
					$(moca.TO_001.getObj("t8")).find('.tab_badge').css("visibility","hidden");
				}
				if(moca.TO_001.separatedMap["이전등록오류"].length > 0){
					$(moca.TO_001.getObj("t9")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["이전등록오류"].length));
				}else{
					$(moca.TO_001.getObj("t9")).find('.tab_badge').css("visibility","hidden");
				}
				if(moca.TO_001.separatedMap["환급처리완료"].length > 0 || moca.TO_001.separatedMap["환급대상"].length > 0){
					$(moca.TO_001.getObj("t10")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["환급대상"].length) +"/"+ moca.comma(moca.TO_001.separatedMap["환급처리완료"].length));
				}else{
					$(moca.TO_001.getObj("t10")).find('.tab_badge').css("visibility","hidden");
				}
				if(moca.TO_001.separatedMap["결제오류"].length > 0 ){
					$(moca.TO_001.getObj("t12")).find('.tab_badge').css("visibility","visible").html(moca.comma(moca.TO_001.separatedMap["결제오류"].length));
				}else{
					$(moca.TO_001.getObj("t12")).find('.tab_badge').css("visibility","hidden");
				}	
				
				redrawFlag = true;
			}
			
			if(_tabContentId != null){
				redrawFlag = true;
			}

			if(redrawFlag){
				var scope = moca['TO_001S'+comLib.gfn_toTwoChar(inqType)];
				var g = scope.getObj('grd_0');
				var keyName = moca.TO_001.getTabText(selectedId);
				var arrObj;
				if(keyName == '환급'){
					arrObj = {"admMngList":moca.TO_001.separatedMap["환급통합"]};
				}else if(keyName == '인증진행중'){
						arrObj = {"admMngList":moca.TO_001.separatedMap["인증통합"]};					
				}else{
					arrObj = {"admMngList":moca.TO_001.separatedMap[keyName]};
				}
				scope.drawGrid(g.id,moca.getResList(arrObj,"admMngList"));
				g.setAttribute("selectedRealRowIndex","0");
				moca._setRowSelection(g);
				moca.setFocus(moca.TO_001.getObj("sellerNameAndbuyerName"));
			}
		}
	});
};
moca.TO_001.grd_0__onDblClick = function(_grd,rowIndex,colIndex,colId){
	var o = {};
	o.id = moca.TO_001.popId;
	o.url = '/html/TO/TO_000P01.html';
	o.type = "POPUP";
	o.modal = "false";
	o.title = '운영관리 상세';
	o.callback = moca.TO_001.fn_pop_callback;
	o.scopeId = moca.TO_001.pageId;
	o.data = {"idx":_grd.list[rowIndex].Idx,"RegistrationIndex":_grd.list[rowIndex].RegistrationIndex};
	moca.popup(o,_grd);
};
moca.TO_001.fn_pop = function(_thisObj){
	['운영관리상세']
	var _grd = moca.TO_001.getObj("grd_0");
	var selectedRealRowIndex = _grd.getAttribute('selectedRealRowIndex');
	if(selectedRealRowIndex == null){
		selectedRealRowIndex = "0";
	}
	moca.TO_001.grd_0__onDblClick(_grd,selectedRealRowIndex,null,null);
};

moca.TO_001.popId = 'TO_001P01';

moca.TO_001.fn_pop_callback = function(_json){
	if(_json != null){
		alert(_json);
	}
};
moca.TO_001.fn_toolkit_purcharse = function(_json){
	moca.openWindowPopup({
		id:	'NP_FIRMSFILTERING_PopResult',
		title:	'매수주체별 지수 가/감산 가중치 설정',
		width:"500px",
		height:"400px",
		url : "http://dev-mycar.carbang365.co.kr:9090/ets-hub-connect-window/ToolkitIssuePurcharseUrlExample.jsp",
		fullscreen : 'no',
		param : {
			contractNo : "1"
		}
	});
};
</script>
</head>
<body>
	<div id="moca_tab_bridge1" class="moca_tab_panel" role="mdipanel" style="display:block;visibility:visible;">
	<div class="moca_tab_cont" style="height:100%">
		<div class="moca_cont_wrap">
			<div type="wframe" class="moca_titbox cm" id="titbox" tag="moca:titbox" 
				src="/html/titlebox.html"
				data = '{"sreenCd":"TO_001","sreenNm":"운영관리","sreenPath":"운영관리"}'
				addition='[
					{"type":"button","position":"right","id":"btn_charge","label":"수입인지충전","onclick":"moca.TO_001.fn_toolkit_purcharse","addClass":""},
					{"type":"label","position":"right","id":"lbl_charge_money","value":"300,000","addClass":"stampcost_charge"},
					{"type":"label","position":"right","id":"lbl_charge_unit","value":"원","addClass":"","style":""}
				]'
			></div>
			<div class="moca_shbox">
				<div class="shbox_inner">
					<table class="tb">
						<tbody>
							<tr>
								<th class="tb_th pr10">상태</th>
								<td class="tb_td">
									<div type="checkboxGroup" class="fl mr15" direction="vertical" id="chkg_1"
										itemset='[{"id":"chk1","label":"진행중","value":"1","checked":"true"}]'>
									</div>
									<div type="checkboxGroup" class="fl mr5" direction="vertical" id="chkg_2"
											itemset='[{"id":"chk2","label":"완료","value":"0","checked":"false"}]'>
									</div>
									<div type="inputMultiCalendar" class="moca_ica fl" style="width:auto" id="CREATE_DTTM" displayFormat="####-##-##" 
										defaultValue="6일전" 
										selecterItem="오늘,3일전,6일전"
										showRadioOption="false"
									></div>
								</td>
								<th class="tb_th pr10">차량번호/양수인명/양도인명</th>
								<td class="tb_td">
									<div type="input" id="RegNumber" keyMask="enterSearchEvt" class="mocaInput"  style=""  readonly="false" ></div>
								</td>
<!-- 								<th class="tb_th pr10">양수인명/양도인명</th>
								<td class="tb_td">
									<div type="input" id="sellerNameAndbuyerName" keyMask="enterSearchEvt" class="mocaInput"  style=""  readonly="false" ></div>
								</td> -->
							</tr>
						</tbody>
					</table>
				</div>
				<div class="btn_shbox">
					<button type="button" class="button btn_sc" onclick="moca.TO_001.fn_search()"><i class="fas fa-search"></i><span>조회</span></button>
				</div>
			</div>
			<!-- 결제준비KSNET미요청 -> 결제준비중 -->
<!-- 							{"position":"left","id":"t2","label":"이전신청대기중","src":"/html/TO/TO_001S02.html"},
				{"position":"left","id":"t8","label":"이전신청완료 to 공단","src":"/html/TO/TO_001S08.html"}, -->
			<div type="tab" id="tab_TO001" class="moca_layer_tab TO_001" style="" onTabHeaderclick="moca.TO_001.sendParam"
			list='[
				{"position":"left","id":"t0","label":"전체","src":"/html/TO/TO_001S00.html","active":"true"},
				{"position":"left","id":"t1","label":"취소","src":"/html/TO/TO_001S01.html"},
				{"position":"left","id":"t2","label":"고객정보오류","src":"/html/TO/TO_001S02.html"},
				{"position":"left","id":"t3","label":"이전신청오류","src":"/html/TO/TO_001S03.html"},
				{"position":"left","id":"t4","label":"인증진행중","src":"/html/TO/TO_001S04.html"},
				{"position":"left","id":"t5","label":"고객결제","src":"/html/TO/TO_001S05.html"},
				{"position":"left","id":"t6","label":"공단입금","src":"/html/TO/TO_001S06.html"},
				{"position":"left","id":"t7","label":"결제준비중","src":"/html/TO/TO_001S07.html"},
				{"position":"left","id":"t8","label":"이전등록대기","src":"/html/TO/TO_001S08.html"},
				{"position":"left","id":"t9","label":"이전등록오류","src":"/html/TO/TO_001S09.html"},
				{"position":"left","id":"t10","label":"환급","src":"/html/TO/TO_001S10.html"},
				{"position":"left","id":"t12","label":"결제오류","src":"/html/TO/TO_001S12.html"}
			]'
			 >
			</div>
		</div>	
	</div>
</div>
</body>
</html>