<!DOCTYPE html>
<html lang="ko">
<head meta_width="1400px" meta_height="700px">
<script>
moca.TO_000P77.___ready = function(args){
	if(args != null){
		moca.TO_000P77.args = args;
	}

	moca.TO_000P77.fn_search();
};
moca.TO_000P77.fn_search = function(_grd,_idx,tdObj,_thisObj){
	var _termsId = moca.TO_000P77.args.parent.data.termsId;
	var _TermsUpCd = moca.TO_000P77.args.parent.data.TermsUpCd;
	if(_termsId != null){
		moca.TO_000P77.exe({
			url : moca._domain+moca._contextRoot+"/TO_012/gonggiInfo.do",
			loadingbar:false,
			data : {
				"header" : moca.header,
				"body" : {
					"idx":_termsId
					}
			},			
			callback : function(response){
				if(response.gonggiInfo != null && response.gonggiInfo.length > 0){
					var data = response.gonggiInfo[0];
					CKEDITOR.replace( 'editor',{uiColor:'#fff9da',on:{
						'instanceReady':function(evt){
							//CKEDITOR.instances.editor.focus();
					}}}	);
					CKEDITOR.instances.editor.setData(data.TermsContents);
					moca.setValue(moca.TO_000P77.getObj("title"),data.TermsTitle);
					moca.setValue(moca.TO_000P77.getObj("wdate"),data.RegisterTime);
					moca.setValue(moca.TO_000P77.getObj("wid"),data.Wid);
					moca.setValue(moca.TO_000P77.getObj("idx"),data.idx);
					moca.TO_000P77.setFrom("fromto",data.fromDt);
					moca.TO_000P77.setTo("fromto",data.toDt);
				}else{
					moca.error(response.error);
				}
			}
		});
	}else{
		moca.setValue(moca.TO_000P77.getObj("wid"),moca.getSs("USER_ID"));
		moca.setValue(moca.TO_000P77.getObj("wdate"),dateLib.getToday());
		moca.setValue(moca.TO_000P77.getObj("idx"),"등록후채번됨");
		
		
		
		CKEDITOR.replace( 'editor',{uiColor:'#fff9da',on:{
			'instanceReady':function(evt){
				CKEDITOR.instances.editor.focus();
		}}}	);
	}
};


moca.TO_000P77.fn_save = function(_grd,_idx,tdObj,_thisObj){
	moca.confirm('저장하시겠습니까?',function(result){
		if(result == 'Y'){
			var _termsId = moca.TO_000P77.args.parent.data.termsId;
			var _TermsUpCd = moca.TO_000P77.args.parent.data.TermsUpCd;
			var _TermsTitle = moca.TO_000P77.args.parent.data.TermsTitle;
			if(_termsId == null){
				//새이력저장
				moca.TO_000P77.exe({
					url : moca._domain+moca._contextRoot+"/TO_012/isnertGonggi.do",
					loadingbar:true,
					data : {
						"header" : moca.header,
						"body" : {
							"TermsTitle":moca.getValue(moca.TO_000P77.getObj("title")),
							"TermsContents":CKEDITOR.instances.editor.getData(),
							"fromDt":moca.TO_000P77.getFrom("fromto"),
							"toDt":moca.TO_000P77.getTo("fromto")
							}
					},			
					callback : function(response){
						if(response.cnt > 0){
							moca.alert('성공적으로 저장하였습니다.');
							moca.popClose(moca.TO_000P77.pageId);
							moca.TO_012.fn_search_gonggi();
						}
					}
				});
			}else{
				//이력수정
				moca.TO_000P77.exe({
					url : moca._domain+moca._contextRoot+"/TO_012/updateGonggi.do",
					loadingbar:true,
					data : {
						"header" : moca.header,
						"body" : {
							"idx":moca.TO_000P77.args.parent.data.termsId+"",
							"TermsTitle":moca.getValue(moca.TO_000P77.getObj("title")),
							"TermsContents":CKEDITOR.instances.editor.getData(),
							"fromDt":moca.TO_000P77.getFrom("fromto"),
							"toDt":moca.TO_000P77.getTo("fromto")
							}
					},			
					callback : function(response){
						if(response.cnt > 0){
							moca.alert('성공적으로 저장하였습니다.');
							moca.popClose(moca.TO_000P77.pageId);
							moca.TO_012.fn_search_gonggi();
						}
					}
				});
			}
		}
	});
};
</script>
<style>
</style>
</head>
<body>
	<div class="moca_pop_cont_wrap">
		<div type="form" id="form_3" class="moca_table toolbar" style=""
				label="공지작성(수정)"
				showRowSelection="false"
				addition='[
				{"type":"button","position":"right","id":"btn_save","label":"저장","onclick":"moca.TO_000P77.fn_save","addClass":""}
					]'
				>
					<table class="moca_table_cont" style="">
						<colgroup>
								<col style="width:80px">
								<col style="width:212px">
								<col style="">
								<col style="width:120px">
								<col style="width:120px">
						</colgroup>
						<thead>
							<tr>
								<th>ID</th>
								<th>공지기간</th>
								<th>제목</th>
								<th>작성일(시)</th>
								<th>작성자</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<div type="input" id="idx" class="mocaInput" innerClass="tac" onclick="" style="" value="" readonly="true"></div>
								</td>
								<td>
									<div type="inputMultiCalendar" class="moca_ica fl" style="width:100%;" id="fromto" displayFormat="####-##-##" 
										defaultValue="15일후" 
										selecterItem="오늘,7일후,15일후,30일후"
										showRadioOption="false"
									></div>
								</td>
								<td>
									<div type="input" class="mocaInput req" style="width:100%;" innerStyle="" id="title" displayFormat=""  readonly="false"
										defaultValue="" 
										selecterItem=""
										showRadioOption="false"
									></div>
								</td>
								<td>
									<div type="input" class="mocaInput" style="width:100%;text-align:center;" innerStyle="text-align:center;" id="wdate" displayFunction="moca.dateFormat"  readonly="true"
										defaultValue="" 
										selecterItem=""
										showRadioOption="false"
									></div>
								</td>
								<td>
									<div type="input" class="mocaInput" style="width:100%;text-align:center;" innerStyle="text-align:center;" id="wid" displayFormat=""  readonly="true"
										defaultValue="" 
										selecterItem=""
										showRadioOption="false"
									></div>
								</td>
							</tr>  
						</tbody>
					</table>
					<div class="mt10 terms_edit">
						<div contenteditable="true" placeholder="" id="editor"  style="height:150px"></div>
					</div>
		</div>

		
	</div>
</body>
</html>