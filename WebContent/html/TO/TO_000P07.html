<!DOCTYPE html>
<html lang="ko">
<head meta_width="1200px" meta_height="600px">
<script>
moca.TO_000P07.___ready = function(args){
	if(args != null){
		moca.TO_000P07.args = args;
	}
	var _TermsTitle = moca.TO_000P07.args.parent.data.TermsTitle;
	moca.setValue(moca.TO_000P07.getObj("title"),_TermsTitle);
	moca.TO_000P07.fn_search();
};
moca.TO_000P07.fn_search = function(_grd,_idx,tdObj,_thisObj){
	var _termsId = moca.TO_000P07.args.parent.data.termsId;
	var _TermsUpCd = moca.TO_000P07.args.parent.data.TermsUpCd;
	if(_termsId != null){
		moca.TO_000P07.exe({
			url : moca._domain+moca._contextRoot+"/TO_012/termsInfo.do",
			loadingbar:false,
			data : {
				"header" : moca.header,
				"body" : {
					"termsId":_termsId,
					"TermsUpCd":_TermsUpCd
					}
			},			
			callback : function(response){
				if(response.termsInfo != null && response.termsInfo.length > 0){
					var data = response.termsInfo[0];
					moca.setValue(moca.TO_000P07.getObj("idx"),data.idx);
					moca.setValue(moca.TO_000P07.getObj("RegisterTime"),data.RegisterTime);
					moca.setValue(moca.TO_000P07.getObj("EnableTime"),data.EnableTime);
					moca.setValue(moca.TO_000P07.getObj("Selected"),data.Selected);
					moca.setValue(moca.TO_000P07.getObj("Enable"),data.Enable);
					
					
					
					
					if(data.IsPassed == 'Y'){
						//$(moca.TO_000P07.getObj("form_3")).find("#button_btn_save").hide();
						/*
						if(data.Selected == 'Y'){
							$(moca.TO_000P07.getObj("Selected")).find('input[value=N]').prop("disabled", true);
						}else{
							$(moca.TO_000P07.getObj("Selected")).find('input[value=Y]').prop("disabled", true);
						}
						*/
						
						//$(moca.TO_000P07.getObj("EnableTime")).find('#sub_EnableTime').prop("disabled", true);
						//$(moca.TO_000P07.getObj("EnableTime")).find('button').prop("disabled", true);
					}
					CKEDITOR.replace( 'editor',{uiColor:'#cdd4e1',on:{
						'instanceReady':function(evt){
					}}}	);
					CKEDITOR.instances.editor.setData(data.TermsContents);
				}else{
					moca.error(response.error);
				}
			}
		});
	}else{
		moca.setValue(moca.TO_000P07.getObj("RegisterTime"),dateLib.getToday('-'));
		moca.setValue(moca.TO_000P07.getObj("idx"),'저장후표시됨');
		moca.setValue(moca.TO_000P07.getObj("EnableTime"),dateLib.addToDay(15));
		
		
		//$(moca.TO_000P07.getObj("Selected")).find('input[value=Y]').prop("disabled", true);
		//$(moca.TO_000P07.getObj("TermsUpCd")).find('option').prop('disabled',true);
		CKEDITOR.replace( 'editor',{uiColor:'#cdd4e1',on:{
			'instanceReady':function(evt){
				CKEDITOR.instances.editor.focus();
		}}}	);
	}
};


moca.TO_000P07.fn_save = function(_grd,_idx,tdObj,_thisObj){
	moca.confirm('저장하시겠습니까?',function(result){
		if(result == 'Y'){
			var _termsId = moca.TO_000P07.args.parent.data.termsId;
			var _TermsUpCd = moca.TO_000P07.args.parent.data.TermsUpCd;
			var _TermsTitle = moca.TO_000P07.args.parent.data.TermsTitle;
			if(_termsId == null){
				//새이력저장

				moca.TO_000P07.exe({
					url : moca._domain+moca._contextRoot+"/TO_012/isnertTerm.do",
					loadingbar:true,
					data : {
						"header" : moca.header,
						"body" : {
							"EnableTime":dateLib.makeDateFormat(moca.getValue(moca.TO_000P07.getObj("EnableTime")),"-"),
							"Selected":moca.TO_000P07.getRadio('Selected').value,
							"TermsTitle":_TermsTitle,
							"TermsContents":CKEDITOR.instances.editor.getData(),
							"TermsUpCd":_TermsUpCd
							}
					},			
					callback : function(response){
						if(response.cnt > 0){
							moca.alert('성공적으로 저장하였습니다.');
							moca.popClose(moca.TO_000P07.pageId);
							moca.TO_012.fn_search2();
						}
					}
				});
			}else{
				//이력수정
				moca.TO_000P07.exe({
					url : moca._domain+moca._contextRoot+"/TO_012/updateTerm.do",
					loadingbar:true,
					data : {
						"header" : moca.header,
						"body" : {
							"EnableTime":moca.getValue(moca.TO_000P07.getObj("EnableTime")),
							"Selected":moca.TO_000P07.getRadio('Selected').value,
							"TermsTitle":_TermsTitle,
							"TermsContents":CKEDITOR.instances.editor.getData(),
							"idx":_termsId,
							"TermsUpCd":_TermsUpCd
							}
					},			
					callback : function(response){
						if(response.cnt > 0){
							moca.alert('성공적으로 저장하였습니다.');
							moca.popClose(moca.TO_000P07.pageId);
							moca.TO_012.fn_search2();
						}
					}
				});
			}
		}
	});
};
</script>
<style>
</style>
</head>
<body>
	<div class="moca_pop_cont_wrap">
		<div type="form" id="form_3" class="moca_table toolbar" style=""
				label="약관상세"
				showRowSelection="false"
				addition='[
				{"type":"button","position":"right","id":"btn_save","label":"저장","onclick":"moca.TO_000P07.fn_save","addClass":""}
					]'
				>
					<table class="moca_table_cont" style="">
						<colgroup>
								<col style="width:80px">
								<col style="">
								<col style="width:120px">
								<col style="width:120px">
								<col style="width:140px">
								<col style="width:100px">
						</colgroup>
						<thead>
							<tr>
								<th>관리번호</th>
								<th>약관</th>
								<th>등록일시</th>
								<th>적용일</th>
								<th>대상여부</th>
								<th>적용상태</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<div type="input" id="idx" class="mocaInput" innerClass="tac" onclick="" style="" value="" readonly="true"></div>
								</td>
								<td>
									<div type="input" class="mocaInput" style="width:100%;" innerStyle="" id="title" displayFormat=""  readonly="true"
										defaultValue="" 
										selecterItem=""
										showRadioOption="false"
									></div>
								</td>
								<td>
									<div type="input" class="mocaInput" style="width:100%;text-align:center;" innerStyle="text-align:center;" id="RegisterTime" displayFormat=""  readonly="true"
										defaultValue="" 
										selecterItem=""
										showRadioOption="false"
									></div>
								</td>
								<td>
									<div type="inputCalendar" class="moca_ica fc" style="width:100%;"  id="EnableTime" displayFormat="####-##-##" 
										defaultValue="" 
										selecterItem=""
										showRadioOption="false"
									></div>
								</td>

								<td>
									<div type="radio" class="mocaRadio" style="width:100%" id="Selected" itemset='[{"label":"대상","value":"Y"},{"label":"미대상","value":"N","checked":"true"}]'></div>
								</td>
								<td>
									<div type="input" class="mocaInput" style="width:100%;" innerStyle="text-align:center" id="Enable" displayFormat=""  readonly="true"
										defaultValue="" 
										selecterItem=""
										showRadioOption="false"
									></div>
								</td>
							</tr>  
						</tbody>
					</table>
					<div class="mt10 terms_edit">
						<div contenteditable="true" placeholder="" id="editor"  style="height:150px"></div>
					</div>
		</div>

		
	</div>
</body>
</html>