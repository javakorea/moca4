<!DOCTYPE html>
<html lang="ko">
<head>
<style>
</style>
<script>
moca.TO_008.___ready = function(args){
	moca.TO_008.bindCombo("HH",{metaInfo:{codeCd:"cd",codeNm:"nm"}},moca.getHHList());
	moca.TO_008.bindCombo("MM",{metaInfo:{codeCd:"cd",codeNm:"nm"}},moca.getMMList());
	moca.TO_008.fn_search();
};

moca.TO_008.fn_search = function(){
	moca.TO_008.exe({
		url : moca._domain+moca._contextRoot+"/TO_008/bondPriceInfo.do",
		loadingbar:true,
		data : {
			"header" : moca.header,
			"body" : {
				}
		},			
		callback : function(response){
			var addList = response.bondPriceInfo.bondAddPriceList;
			if(moca.TO_008.addMap == null){
				moca.TO_008.addMap = {};
			}
			for(var i=0; i < addList.length; i++){
				var data = addList[i];
				moca.TO_008.addMap[data.Today] = data;
			}
			var _Today = moca.getValue(moca.TO_008.getObj("Today"));
			moca.TO_008.fn_setter1(_Today);
			
			
			
			var g = moca.TO_008.getObj('grd_08');
			g.list = moca.getResList(response.bondPriceInfo,"bondPriceList");
			if(g.list != null && g.list.length > 0){
				g.list[0]._system.status = 'C';
				moca.TO_008.drawGrid(g,g.list);
			}
		}
	});
};

moca.TO_008.fn_setter1 = function(_Today){
	if(_Today == null){
		_Today = moca.getValue(moca.TO_008.getObj("Today"));
	}
	var addData = moca.TO_008.addMap[_Today];
	if(addData != null){
		moca.setValue(moca.TO_008.getObj("HH"),addData.HH);
		moca.setValue(moca.TO_008.getObj("MM"),addData.MM);
		moca.setValue(moca.TO_008.getObj("A_BondAddPrice_Basis"),addData.A_BondAddPrice_Basis);
		moca.setValue(moca.TO_008.getObj("B_BondAddPrice_Basis"),addData.B_BondAddPrice_Basis);
		moca.setValue(moca.TO_008.getObj("C_BondAddPrice_Basis"),addData.C_BondAddPrice_Basis);
	}else{
		moca.setValue(moca.TO_008.getObj("HH"),"00");
		moca.setValue(moca.TO_008.getObj("MM"),"00");
		moca.setValue(moca.TO_008.getObj("A_BondAddPrice_Basis"),"");
		moca.setValue(moca.TO_008.getObj("B_BondAddPrice_Basis"),"");
		moca.setValue(moca.TO_008.getObj("C_BondAddPrice_Basis"),"");	
	}
};

moca.TO_008.fn_getter1 = function(){//추가적용
	var _Today = moca.getValue(moca.TO_008.getObj("Today"));
	var obj = moca.TO_008.addMap[_Today];
	obj.HH = moca.getValue(moca.TO_008.getObj("HH"));
	obj.MM = moca.getValue(moca.TO_008.getObj("MM"));
	obj.Time = obj.HH+obj.MM;
	obj.A_BondAddPrice_Basis = moca.getValue(moca.TO_008.getObj("A_BondAddPrice_Basis")).replace(/,/g,'');
	obj.B_BondAddPrice_Basis = moca.getValue(moca.TO_008.getObj("B_BondAddPrice_Basis")).replace(/,/g,'');
	obj.C_BondAddPrice_Basis = moca.getValue(moca.TO_008.getObj("C_BondAddPrice_Basis")).replace(/,/g,'');
	return obj;	
};
moca.TO_008.fn_getter2 = function(){//단가
	//var _Today = moca.getValue(moca.TO_008.getObj("Today"));
	var obj = moca.TO_008.getObj("grd_08").list[0];
	obj.Today = obj.Today.replace(/-/g,'');
	obj.idx = obj.idx+"";
	obj.A_BondPrice_Basis = obj.A_BondPrice_Basis+"";
	obj.B_BondPrice_Basis = obj.B_BondPrice_Basis+"";
	obj.C_BondPrice_Basis = obj.C_BondPrice_Basis+"";
	return obj;	
};
moca.TO_008.fn_save1 = function(){
	if(moca.confirm('채권단가 추가적용을 저장하시겠습니까?',function(result){
		if(result == 'Y'){
			var map = moca.TO_008.fn_getter1();
			map.inqType = "2";
			moca.TO_008.exe({
				url : moca._domain+moca._contextRoot+"/TO_008/updateBondPrice.do",
				loadingbar:true,
				data : {
					"header" : moca.header,
					"body" : map
				},			
				callback : function(response){
					if(response.cnt == 0){
						moca.error("업데이트 실패하였습니다<br>관리자에거 문의바랍니다.");
					}else if(response.cnt){
						moca.alert('차량감가적용율 <br>성공적으로 저장하였습니다');
						moca.TO_008.fn_search();
					}else if(response.error){
						moca.error(response.error);
					}else{
						moca.error(response.message);
					}
				}
			});
		}
	}));
};

moca.TO_008.fn_save2 = function(){
	if(moca.confirm('채권단가를 저장하시겠습니까?',function(result){
		if(result == 'Y'){
			var map = moca.TO_008.fn_getter2();
			map.inqType = "1";
			moca.TO_008.exe({
				url : moca._domain+moca._contextRoot+"/TO_008/updateBondPrice.do",
				loadingbar:true,
				data : {
					"header" : moca.header,
					"body" : map
				},			
				callback : function(response){
					if(response.cnt){
						moca.alert('차량 시세 추가적용율율 <br>성공적으로 저장하였습니다');
						moca.TO_008.fn_search();
					}else{
						moca.alert(response.message);
					}
				}
			});
		}
	}));
};

moca.TO_008.fn_display_gubun = function(_value,_grd,_rowIndex){
	return arguments[1].list[_rowIndex].Today + " (" +arguments[1].list[_rowIndex].DAY.replace(/요일/g,'') +") " + arguments[1].list[_rowIndex].Daysection;
}
moca.TO_008.fn_ondateSelected = function(_value){
	moca.TO_008.fn_setter1();
}	

</script>
</head>
<body>
<div id="moca_tab_bridge1" class="moca_tab_panel" role="mdipanel" style="display:block;visibility:visible;">
	<div class="moca_tab_cont" style="height:100%">
		<div class="moca_cont_wrap">
			<div type="wframe" class="moca_titbox cm noshbox" id="titbox" tag="moca:titbox" 
				src="/html/titlebox.html"
				data = '{"sreenCd":"TO_008","sreenNm":"채권단가 조회","sreenPath":"Quick Menu,채권단가 조회"}'
			></div>
			<div type="form" id="form_3" class="moca_table toolbar mt12" style=""
				label="채권단가 추가적용"
				addition='[
				{"type":"button","position":"right","id":"btn_save","label":"채권단가추가적용","onclick":"moca.TO_008.fn_save1","addClass":""}
					]'
				>
						<table class="moca_table_cont" style="">
							<colgroup>
									<col style=""><!-- 날짜적용 -->
									<col style=""><!-- 시간  -->
									<col style=""><!--서울도시철도 채권 -->
									<col style=""><!--지방도시철도 채권 -->
									<col style=""><!-- 지역개발 채권 -->
							</colgroup>
							<thead>
								<tr>
									<th>날짜적용</th>
									<th>시간</th>
									<th>서울도시철도 채권(원)</th>
									<th>지방도시철도 채권(원)</th>
									<th>지역개발 채권(원)</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										<div type="inputCalendar" class="moca_ica fl" style="width:100%" id="Today" displayFormat="####-##-##" 
											defaultValue="" 
											selecterItem=""
											ondateSelected="moca.TO_008.fn_ondateSelected"
											showRadioOption="false"
										></div>
									</td>
									<td>
										<div class="moca_input_group">
											<div type="combo" id="HH" class="moca_combo" style="width:calc(50% - 2px); margin-right:2px" displayFormat="[label]" cdField="cd" nmField="nm" ></div>
											<div type="combo" id="MM" class="moca_combo" style="width:50%" displayFormat="[label]" cdField="cd" nmField="nm" ></div>
										</div>
									</td>
									<td>
										<div type="input" id="A_BondAddPrice_Basis" class="mocaInput" innerClass="tac" keyMask="onlyMoney" displayFunction="moca.comma"></div>
									</td>
									<td>
										<div type="input" id="B_BondAddPrice_Basis" class="mocaInput" innerClass="tac" keyMask="onlyMoney" displayFunction="moca.comma"></div>
									</td>
									<td>
										<div type="input" id="C_BondAddPrice_Basis" class="mocaInput" innerClass="tac" keyMask="onlyMoney" displayFunction="moca.comma"></div>
									</td>
								</tr>  
							</tbody>
						</table>
			</div>
			<div type="grid" class="moca_grid toolbar mt10" id="grd_08" style="top:150px" 
					toolbar_search_size="false"
					toolbar_col_showhide="false"
					toolbar_detail="false"
					toolbar_exup="false"
					toolbar_exdn="true"
					toolbar_addrow="false"
					toolbar_delrow="false"
					toolbar_nextbtn="false"
					toolbar_full="true"
					toolbar_grid_button3='{"position":"right","id":"btn_save","label":"채권단가수정저장","onclick":"moca.TO_008.fn_save2"}'	
					default_cell_height="26px"
					label="총건수">
					<table style="width: 100%">
						<colgroup>
								<col style="width:200px"><!-- 구분 -->
								<col style="width:"><!-- 서울도시철도채권 원금액 -->
								<col style="width:"><!-- 서울도시철도채권 추가적용-->
								<col style="width:"><!-- 서울도시철도채권 적용금액-->
								<col style="width:"><!-- 지방도시철도 원금액-->
								<col style="width:"><!-- 지방도시철도 추가적용-->
								<col style="width:"><!-- 지방도시철도 적용금액-->
								<col style="width:"><!-- 지역개발 원금액-->
								<col style="width:"><!-- 지역개발 추가적용-->
								<col style="width:"><!-- 지역개발 적용금액-->
						</colgroup>
						<thead>
							<tr>
								<th id="H_date" rowspan="2">구분</th>
								<th id="H_A" colspan="3">서울도시철도 채권</th>
								<th id="H_B" colspan="3">지방도시철도 채권</th>
								<th id="H_C" colspan="3">지역개발 채권</th>
							</tr>
							<tr>
								<th id="H_A_BondPrice_Basis">원금액</th>
								<th id="H_ADD_A_BondAddPrice_Basis">추가적용금액</th>
								<th id="H_TOT_A_BondPrice_Basis">적용금액</th>
								<th id="H_B_BondPrice_Basis">원금액</th>
								<th id="H_ADD_B_BondAddPrice_Basis">추가적용금액</th>
								<th id="H_TOT_B_BondPrice_Basis">적용금액</th>
								<th id="H_C_BondPrice_Basis">원금액</th>
								<th id="H_ADD_C_BondAddPrice_Basis">추가적용금액</th>
								<th id="H_TOT_C_BondPrice_Basis">적용금액</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td id="Daysection" name="구분" addRowEditable="false" celltype="input" style="text-align:left" readonly="true"  displayFunction="moca.TO_008.fn_display_gubun"></td>
								<td id="A_BondPrice_Basis" name="원금액"  required="true" celltype="input" tooltip="true" style="text-align:right" readonly="true" keyMask="onlyMoney" displayFunction="moca.comma"></td>
								<td id="ADD_A_BondAddPrice_Basis" name="추가적용금액" addRowEditable="false"  celltype="input" tooltip="true" style="text-align:right" readonly="true" displayFunction="moca.comma"></td>
								<td id="TOT_A_BondPrice_Basis" name="적용금액" addRowEditable="false"  celltype="input" style="text-align:right" readonly="true" displayFunction="moca.comma"></td>
								<td id="B_BondPrice_Basis" name="원금액"  required="true" celltype="input" tooltip="true" style="text-align:right" readonly="true" keyMask="onlyMoney" displayFunction="moca.comma"></td>
								<td id="ADD_B_BondAddPrice_Basis" name="추가적용금액" addRowEditable="false" celltype="input" style="text-align:right" readonly="true" displayFunction="moca.comma"></td>
								<td id="TOT_B_BondPrice_Basis" name="적용금액" addRowEditable="false"  celltype="input" style="text-align:right" readonly="true" displayFunction="moca.comma"></td>	
								<td id="C_BondPrice_Basis" name="원금액"  required="true" celltype="input"  style="text-align:right" readonly="true" keyMask="onlyMoney" displayFunction="moca.comma"></td>	
								<td id="ADD_C_BondAddPrice_Basis" name="추가적용금액" addRowEditable="false"  celltype="input" style="text-align:right" readonly="true" displayFunction="moca.comma"></td>
								<td id="TOT_C_BondPrice_Basis" name="적용금액" addRowEditable="false"  celltype="input" style="text-align:right" readonly="true" displayFunction="moca.comma"></td>
							</tr>
						</tbody>
					</table>				
			</div>
		</div>	
	</div>
</div>
</body>
</html>